"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[787],{70349:function(e,n,i){var t,a,r,d;i.d(n,{FR:function(){return S},UO:function(){return f},Xx:function(){return m},YM:function(){return c},YR:function(){return N},Yi:function(){return t},bh:function(){return o},by:function(){return v},d3:function(){return p},fk:function(){return u},ib:function(){return k},qI:function(){return T},qq:function(){return s},wW:function(){return l},xj:function(){return a}}),(r=t||(t={})).Cuda="CUDA",r.Rocm="ROCM",(d=a||(a={})).Chat="CHAT",d.Completion="COMPLETION";let o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetRegistrationToken"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"registrationToken"}}]}}]},l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ResetRegistrationToken"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resetRegistrationToken"}}]}}]},u={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"MeQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"me"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authToken"}}]}}]}}]},s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ResetUserAuthToken"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resetUserAuthToken"}}]}}]},k={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateInvitation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"email"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createInvitation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"email"},value:{kind:"Variable",name:{kind:"Name",value:"email"}}}]}]}}]},m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ListInvitations"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"invitations"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}}]}}]}}]},c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteInvitation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteInvitation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}]}]}}]},v={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ListUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"isAdmin"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}}]}}]}}]},f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"tokenAuth"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"email"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"password"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tokenAuth"},arguments:[{kind:"Argument",name:{kind:"Name",value:"email"},value:{kind:"Variable",name:{kind:"Name",value:"email"}}},{kind:"Argument",name:{kind:"Name",value:"password"},value:{kind:"Variable",name:{kind:"Name",value:"password"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accessToken"}},{kind:"Field",name:{kind:"Name",value:"refreshToken"}}]}}]}}]},N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"register"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"email"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"password1"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"password2"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"invitationCode"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"register"},arguments:[{kind:"Argument",name:{kind:"Name",value:"email"},value:{kind:"Variable",name:{kind:"Name",value:"email"}}},{kind:"Argument",name:{kind:"Name",value:"password1"},value:{kind:"Variable",name:{kind:"Name",value:"password1"}}},{kind:"Argument",name:{kind:"Name",value:"password2"},value:{kind:"Variable",name:{kind:"Name",value:"password2"}}},{kind:"Argument",name:{kind:"Name",value:"invitationCode"},value:{kind:"Variable",name:{kind:"Name",value:"invitationCode"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accessToken"}},{kind:"Field",name:{kind:"Name",value:"refreshToken"}}]}}]}}]},p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetWorkers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"workers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"kind"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"addr"}},{kind:"Field",name:{kind:"Name",value:"device"}},{kind:"Field",name:{kind:"Name",value:"arch"}},{kind:"Field",name:{kind:"Name",value:"cpuInfo"}},{kind:"Field",name:{kind:"Name",value:"cpuCount"}},{kind:"Field",name:{kind:"Name",value:"accelerators"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uuid"}},{kind:"Field",name:{kind:"Name",value:"chipName"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"deviceType"}}]}}]}}]}}]},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"refreshToken"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"refreshToken"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"refreshToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"refreshToken"},value:{kind:"Variable",name:{kind:"Name",value:"refreshToken"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accessToken"}},{kind:"Field",name:{kind:"Name",value:"refreshToken"}}]}}]}}]},T={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetIsAdminInitialized"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isAdminInitialized"}}]}}]}},58835:function(e,n,i){i.d(n,{BX:function(){return r}});var t=i(70349);let a={"\n  query GetRegistrationToken {\n    registrationToken\n  }\n":t.bh,"\n  mutation ResetRegistrationToken {\n    resetRegistrationToken\n  }\n":t.wW,"\n  query MeQuery {\n    me {\n      authToken\n    }\n  }\n":t.fk,"\n  mutation ResetUserAuthToken {\n    resetUserAuthToken\n  }\n":t.qq,"\n  mutation CreateInvitation($email: String!) {\n    createInvitation(email: $email)\n  }\n":t.ib,"\n  query ListInvitations {\n    invitations {\n      id\n      email\n      code\n      createdAt\n    }\n  }\n":t.Xx,"\n  mutation DeleteInvitation($id: Int!) {\n    deleteInvitation(id: $id)\n  }\n":t.YM,"\n  query ListUsers {\n    users {\n      email\n      isAdmin\n      createdAt\n    }\n  }\n":t.by,"\n  mutation tokenAuth($email: String!, $password: String!) {\n    tokenAuth(email: $email, password: $password) {\n      accessToken\n      refreshToken\n    }\n  }\n":t.UO,"\n  mutation register(\n    $email: String!\n    $password1: String!\n    $password2: String!\n    $invitationCode: String\n  ) {\n    register(\n      email: $email\n      password1: $password1\n      password2: $password2\n      invitationCode: $invitationCode\n    ) {\n      accessToken\n      refreshToken\n    }\n  }\n":t.YR,"\n  query GetWorkers {\n    workers {\n      kind\n      name\n      addr\n      device\n      arch\n      cpuInfo\n      cpuCount\n      accelerators {\n        uuid\n        chipName\n        displayName\n        deviceType\n      }\n    }\n  }\n":t.d3,"\n  mutation refreshToken($refreshToken: String!) {\n    refreshToken(refreshToken: $refreshToken) {\n      accessToken\n      refreshToken\n    }\n  }\n":t.FR,"\n  query GetIsAdminInitialized {\n    isAdminInitialized\n  }\n":t.qI};function r(e){var n;return null!==(n=a[e])&&void 0!==n?n:{}}},88809:function(e,n,i){i.d(n,{Ho:function(){return N},X0:function(){return F},av:function(){return D},kP:function(){return g},zq:function(){return h},QJ:function(){return y}});var t,a,r=i(57437),d=i(2265),o=i(24033),l=i(53771),u=i(26566),s=i.n(u),k=i(58835),m=i(7820);function c(e,n){var i,t;let r=function(e,n){switch(n.type){case a.SignIn:case a.Refresh:return{status:"authenticated",data:n.data};case a.SignOut:return{status:"unauthenticated",data:null}}}(0,n);return e.status==r.status&&(i=e.data,t=r.data,(null==i?void 0:i.accessToken)===(null==t?void 0:t.accessToken)&&(null==i?void 0:i.refreshToken)===(null==t?void 0:t.refreshToken))?e:r}(t=a||(a={}))[t.SignIn=0]="SignIn",t[t.SignOut=1]="SignOut",t[t.Refresh=2]="Refresh";let v=d.createContext(null),f=(0,k.BX)("\n  mutation refreshToken($refreshToken: String!) {\n    refreshToken(refreshToken: $refreshToken) {\n      accessToken\n      refreshToken\n    }\n  }\n"),N=e=>{let{children:n}=e,[i,t]=d.useReducer(c,{status:"loading",data:null});return(0,r.jsxs)(v.Provider,{value:{authState:i,dispatch:t},children:[(0,r.jsx)(p,{}),n]})};function p(){let[e,n]=s()("_tabby_auth",null),{authState:i,dispatch:t}=T(),o=(0,m.Db)(f,{onCompleted(e){let{refreshToken:n}=e;t({type:a.Refresh,data:n})},onError(){t({type:a.SignOut})}}),l=d.useRef(!1);return d.useEffect(()=>{(null==e?void 0:e.refreshToken)?l.current?t({type:a.Refresh,data:e}):(l.current=!0,o(e)):t({type:a.SignOut})},[e]),d.useEffect(()=>{(null==i?void 0:i.data)?n(i.data):l.current||n((null==i?void 0:i.data)||null)},[i]),!function(e,n){let i=d.useRef(e),t=d.useRef(null);d.useEffect(()=>{i.current=e},[e]),d.useEffect(()=>("number"==typeof n&&(t.current=window.setInterval(()=>i.current(),6e4*n)),()=>{t.current&&window.clearTimeout(t.current)}),[n])}(async()=>{(null==i?void 0:i.status)==="authenticated"&&await o(i.data)},5),(0,r.jsx)(r.Fragment,{})}class S extends Error{constructor(){super("AuthProvider is missing. Please add the AuthProvider at root level")}}function T(){let e=d.useContext(v);if(!e)throw new S;return e}function h(){let{dispatch:e}=T();return async n=>(e({type:a.SignIn,data:n}),!0)}function y(){let{dispatch:e}=T();return async()=>{e({type:a.SignOut})}}function g(){var e;let{authState:n}=T();if((null==n?void 0:n.status)=="authenticated"){let{sub:e,is_admin:i}=(0,l.o)(n.data.accessToken);return{data:{email:e,isAdmin:i,accessToken:n.data.accessToken},status:n.status}}return{status:null!==(e=null==n?void 0:n.status)&&void 0!==e?e:"loading",data:null}}let b=(0,k.BX)("\n  query GetIsAdminInitialized {\n    isAdminInitialized\n  }\n");function D(){let{data:e}=(0,m.ak)(b),n=(0,o.useRouter)(),{data:i,status:t}=g();return d.useEffect(()=>{"loading"!==t&&"authenticated"!==t&&((null==e?void 0:e.isAdminInitialized)===!1?n.replace("/auth/signup?isAdmin=true"):"unauthenticated"===t&&n.replace("/auth/signin"))},[e,t]),i}function F(e){let{data:n,status:i}=g();return e&&"authenticated"===i?[e,n.accessToken]:null}},7820:function(e,n,i){i.d(n,{Db:function(){return u},J9:function(){return k},ak:function(){return s}});var t,a=i(95054),r=i(30713),d=i(88809),o=i(62601);let l=new a.g6("".concat(null!==(t=o.env.NEXT_PUBLIC_TABBY_SERVER_URL)&&void 0!==t?t:"","/graphql"));function u(e,n){var i;let{data:t}=(0,d.kP)(),a=(null==n?void 0:n.form)?(i=n.form,e=>{let{errors:n=[]}=e.response;for(let e of n)if(e.extensions&&e.extensions["validation-errors"]){let n=e.extensions["validation-errors"];for(let e of n.errors)i.setError(e.path,e)}else i.setError("root",e)}):void 0,r=async i=>{let r;try{r=await l.request({document:e,variables:i,requestHeaders:t?{authorization:"Bearer ".concat(t.accessToken)}:void 0})}catch(e){a&&a(e),(null==n?void 0:n.onError)&&n.onError(e);return}(null==n?void 0:n.onCompleted)&&n.onCompleted(r)};return r}function s(e,n,i){return(0,r.ZP)([e,n],e=>{let[n,i]=e;return l.request({document:n,variables:i})},i)}function k(e,n,i){let{data:t,status:a}=(0,d.kP)();return(0,r.ZP)("authenticated"===a?[e,n,null==t?void 0:t.accessToken]:null,e=>{let[n,i,t]=e;return l.request({document:n,variables:i,requestHeaders:{authorization:"Bearer ".concat(t)}})},i)}},39311:function(e,n,i){i.d(n,{aF:function(){return s},cn:function(){return l},uY:function(){return o},x0:function(){return u}});var t=i(50348),a=i(28481),r=i(23986),d=i(70349);let o={Cuda:d.Yi.Cuda,Rocm:d.Yi.Rocm};function l(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0,r.m)((0,t.W)(n))}let u=(0,a.kP)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function s(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/[ ,.:;\n，。：；]/;if(!e)return"";if(e.length<=n)return e;let t=e.slice(0,n),a=-1;for(let e=n-1;e>=0;e--)if(i.test(t[e])){a=e;break}return -1!==a&&(t=t.slice(0,a)),t+"..."}}}]);