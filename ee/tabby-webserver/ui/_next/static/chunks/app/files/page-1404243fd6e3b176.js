(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[357],{51848:function(e,t,l){Promise.resolve().then(l.bind(l,52528))},52528:function(e,t,l){"use strict";l.r(t),l.d(t,{SourceCodeBrowser:function(){return e_},SourceCodeBrowserContext:function(){return eC},getFileViewType:function(){return eR}});var n=l(57437),r=l(2265),s=l(91713),i=l(72999),a=l(16630),o=l(4091),c=l(71424),d=l(1589),u=l(52485),f=l(1592),x=l(39311),h=l(61574);let v=e=>{let{className:t,...l}=e;return(0,n.jsx)(h.eh,{className:(0,x.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...l})},m=h.s_,p=e=>{let{withHandle:t,className:l,...r}=e;return(0,n.jsx)(h.OT,{className:(0,x.cn)("border-bg relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",l),...r,children:t&&(0,n.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border"})})};var j=l(30522),g=l(23977),b=l(24043),y=l(60838),N=l(93023),w=l(84168);let k=e=>{var t;let{className:l,...s}=e,{pendingEvent:i,setPendingEvent:a}=r.useContext(eC),o=(0,b.o)(y.a,e=>e.activeChatId),c=r.useRef(null),d=e=>{let{action:t,code:l,language:n}=e,r="";switch(t){case"explain":r="Explain the following code:";break;case"generate_unittest":r="Generate a unit test for the following code:";break;case"generate_doc":r="Generate documentation for the following code:"}return"".concat(r,"\n","```").concat(null!=n?n:"","\n").concat(l,"\n","```","\n")};return r.useEffect(()=>{var e;let t=null===(e=c.current)||void 0===e?void 0:e.contentWindow;i&&(null==t||t.postMessage({action:"append",payload:d(i)}),a(void 0))},[i,null===(t=c.current)||void 0===t?void 0:t.contentWindow]),(0,n.jsxs)("div",{className:(0,x.cn)("flex h-full flex-col",l),...s,children:[(0,n.jsx)(C,{}),(0,n.jsx)("iframe",{src:"/playground",className:"w-full flex-1 border-0",ref:c},o)]})};function C(){let{setChatSideBarVisible:e}=r.useContext(eC);return(0,n.jsx)("div",{className:"sticky top-0 flex items-center justify-end px-2 py-1",children:(0,n.jsx)(N.z,{size:"icon",variant:"ghost",onClick:t=>e(!1),children:(0,n.jsx)(w.IconClose,{})})})}var S=l(33555),P=l(24144);function _(e){var t;return e?null===(t=e.split("/"))||void 0===t?void 0:t[0]:""}function E(e){return e?e.split("/").slice(1).join("/"):""}function R(e){if(!e)return"";let t=e.split("/");return t[t.length-1]}function Z(e,t){if((0,P.Z)(e))return[];let l=[""],n=e.split("/"),r=t?n.length:n.length-1;for(let e=0;e<r;e++)l.push(n.slice(0,e+1).join("/"));return l}async function F(e){if(!e)return[];let t=_(e),l=E(e),n=Z(l),r=n.map(e=>()=>(0,f.Z)("/repositories/".concat(t,"/resolve/").concat(e)).catch(e=>[])),s=await Promise.all(r.map(e=>e())),i=[];for(let e of s){var a;(null==e?void 0:null===(a=e.entries)||void 0===a?void 0:a.length)&&(i=[...i,...e.entries])}return i}let z=e=>{let{className:t}=e,{currentFileRoutes:l,setActivePath:s,activePath:i}=r.useContext(eC),a=r.useMemo(()=>E(i),[i]);return(0,n.jsxs)("div",{className:(0,x.cn)("flex flex-nowrap items-center gap-1",t),children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 overflow-x-auto leading-8",children:[(0,n.jsx)("div",{className:"cursor-pointer font-medium text-primary hover:underline",onClick:e=>s(void 0),children:"Repositories"}),(0,n.jsx)("div",{children:"/"}),null==l?void 0:l.map((e,t)=>{let i=0===t&&(null==l?void 0:l.length)>1,a=t===l.length-1;return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)("div",{className:(0,x.cn)("whitespace-nowrap",i||a?"font-bold":"font-medium",a?"":"cursor-pointer text-primary hover:underline",i?"hover:underline":void 0),onClick:t=>s(e.fullPath),children:e.name}),"file"!==e.file.kind&&(0,n.jsx)("div",{children:"/"})]},e.fullPath)})]}),!!(null==l?void 0:l.length)&&!!a&&(0,n.jsx)(S.q,{className:"shrink-0",value:a})]})};var I=l(83390),O=l(95376),D=l(36850),L=l(25645),M=l(32553),T=l(16691),V=l.n(T),A=l(66566),B=l(3882),U=l(20946),G=l(77723);let K=e=>{let[t,l]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let t=e.current,n=new IntersectionObserver(e=>{let[t]=e;l(t.intersectionRatio<1)},{threshold:[1]});return t&&n.observe(t),()=>{t&&n.unobserve(t)}},[e.current]),t};var J=l(19567),Q=l(16775),q=l(95482);let H=e=>{let{blob:t,className:l,canCopy:s,hideBlobActions:i,contentLength:a,children:o,...d}=e,u=(0,J.xG)(),{chatSideBarVisible:f,setChatSideBarVisible:h}=r.useContext(eC),[v]=(0,U.D)(),m=r.useRef(null),{activePath:p}=r.useContext(eC),{isCopied:j,copyToClipboard:g}=(0,G.m)({timeout:2e3}),b=K(m),y=u&&v.value&&!f,k=(0,P.Z)(a)?"":(0,B.Z)(a),C=async()=>{if(!j&&t)try{let e=await t.text();g(e)}catch(e){c.A.error("Something went wrong. Please try again.")}};return(0,n.jsxs)("div",{className:(0,x.cn)("sticky -top-1 z-10 border",!b&&"rounded-t-lg",l),ref:m,...d,children:[b&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"bg-secondary pl-4",children:(0,n.jsx)(z,{className:"py-2"})}),b&&(0,n.jsx)(Q.Z,{})]}),!i&&(0,n.jsxs)("div",{className:(0,x.cn)("flex items-center justify-between bg-secondary p-2 text-secondary-foreground",!b&&"rounded-t-lg"),children:[(0,n.jsxs)("div",{className:"flex h-8 items-center gap-4 leading-8",children:[o,(0,n.jsx)("span",{className:"ml-2 text-sm text-muted-foreground",children:k})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,n.jsxs)(q.u,{children:[(0,n.jsx)(q.aJ,{asChild:!0,children:(0,n.jsxs)(N.z,{variant:"ghost",size:"icon",onClick:C,children:[j?(0,n.jsx)(w.IconCheck,{className:"text-green-600"}):(0,n.jsx)(w.IconCopy,{}),(0,n.jsx)("span",{className:"sr-only",children:"Copy"})]})}),(0,n.jsx)(q._v,{children:"Copy raw file"})]}),!!t&&(0,n.jsxs)(q.u,{children:[(0,n.jsx)(q.aJ,{asChild:!0,children:(0,n.jsx)("a",{className:(0,N.d)({variant:"ghost",size:"icon"}),download:R(null!=p?p:""),href:URL.createObjectURL(t),children:(0,n.jsx)(w.IconDownload,{})})}),(0,n.jsx)(q._v,{children:"Download raw file"})]}),y&&(0,n.jsxs)(q.u,{children:[(0,n.jsx)(q.aJ,{asChild:!0,children:(0,n.jsxs)(N.z,{variant:"ghost",className:"flex shrink-0 items-center gap-1 px-2",onClick:e=>h(!f),children:[(0,n.jsx)(V(),{alt:"Tabby logo",src:A.Z,width:24}),"Ask Tabby"]})}),(0,n.jsx)(q._v,{children:"Open chat panel"})]})]})]})]})},W=e=>{let{className:t,loading:l,initialized:s}=e,{activePath:i,currentFileRoutes:a,setActivePath:o,fileTreeData:c}=r.useContext(eC),d=r.useMemo(()=>(function(e,t){if(!(null==e?void 0:e.length))return[];if(t){let l=t.split("/"),n=e;for(;l.length;){let e=l.shift(),t=(0,I.Z)(n,t=>t.name===e);if(null==t||!t.children)return[];n=null==t?void 0:t.children}return(null==n?void 0:n.map(e=>(0,O.Z)(e,"children")))||[]}{let t=e.map(e=>(0,O.Z)(e,"children"))||[];return t}})(c,i),[c,i]),[u]=(0,D.n)(l,300),f=(null==a?void 0:a.length)>0,h=()=>{var e;let t=null===(e=a[(null==a?void 0:a.length)-2])||void 0===e?void 0:e.fullPath;o(t)},v=e=>{o(e.fullPath)};return(0,n.jsxs)("div",{className:(0,x.cn)("text-base",t),children:[(0,n.jsx)(H,{blob:void 0,hideBlobActions:!0,className:"border-0"}),u||!s?(0,n.jsx)(Y,{}):(null==c?void 0:c.length)?(0,n.jsx)(M.iA,{children:(0,n.jsxs)(M.RM,{children:[f&&(0,n.jsx)(M.SC,{className:"cursor-pointer",onClick:e=>h(),children:(0,n.jsx)(M.pj,{className:"p-1 px-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"shrink-0",children:(0,n.jsx)(w.IconDirectorySolid,{style:{color:"rgb(84, 174, 255)"}})}),(0,n.jsx)("span",{className:"px-1 py-2",children:".."})]})})}),(0,n.jsx)(n.Fragment,{children:d.map(e=>(0,n.jsx)(M.SC,{children:(0,n.jsx)(M.pj,{className:"p-1 px-4 text-base",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"shrink-0",children:"dir"===e.file.kind?(0,n.jsx)(w.IconDirectorySolid,{style:{color:"rgb(84, 174, 255)"}}):(0,n.jsx)(w.IconFile,{})}),(0,n.jsx)("span",{onClick:t=>v(e),className:"cursor-pointer px-1 py-2 hover:text-primary hover:underline",children:R(e.fullPath)})]})})},e.fullPath))})]})}):(0,n.jsx)("div",{className:"flex justify-center py-8",children:"No indexed repository yet"})]})};function Y(){return(0,n.jsxs)("ul",{className:"space-y-3 p-2",children:[(0,n.jsx)(L.O,{}),(0,n.jsx)(L.O,{}),(0,n.jsx)(L.O,{}),(0,n.jsx)(L.O,{})]})}var $=l(42910);let X=r.createContext({}),ee=e=>{let{onSelectTreeNode:t,children:l,activePath:r,fileMap:s,updateFileMap:i,expandedKeys:a,toggleExpandedKey:o,initialized:c,fileTreeData:d}=e;return(0,n.jsx)(X.Provider,{value:{onSelectTreeNode:t,fileTreeData:d,expandedKeys:a,toggleExpandedKey:o,activePath:r,fileMap:s,updateFileMap:i,initialized:c},children:l})},et=e=>{let{level:t}=e,l=r.useMemo(()=>Array(t).fill(1),[t]);return(0,n.jsx)("div",{className:"flex h-full shrink-0 items-stretch",children:l.map((e,t)=>(0,n.jsx)("div",{className:"flex h-8 w-2 border-r border-transparent transition-colors duration-300 group-hover/filetree:border-border"},t))})},el=()=>(0,n.jsx)("div",{className:"absolute -left-2 h-8 w-1 rounded-md bg-primary"}),en=e=>{let{isActive:t,level:l,children:r,className:s,...i}=e;return(0,n.jsxs)("div",{className:(0,x.cn)("relative flex h-8 cursor-pointer items-stretch rounded-sm hover:bg-accent focus:bg-accent focus:text-accent-foreground",t&&"bg-accent",s),...i,children:[t&&(0,n.jsx)(el,{}),(0,n.jsx)(et,{level:l}),(0,n.jsxs)("div",{className:"flex flex-nowrap items-center gap-2 truncate whitespace-nowrap",children:[(0,n.jsx)("div",{className:"h-4 w-4 shrink-0"}),r]})]})},er=e=>{let{children:t,level:l,isActive:r,className:s,...i}=e;return(0,n.jsxs)("div",{className:(0,x.cn)("relative flex cursor-pointer items-stretch rounded-sm hover:bg-accent focus:bg-accent focus:text-accent-foreground",r?"bg-accent text-accent-foreground":void 0,s),...i,children:[r&&(0,n.jsx)(el,{}),(0,n.jsx)(et,{level:l}),(0,n.jsx)("div",{className:"flex flex-nowrap items-center gap-2 truncate whitespace-nowrap",children:t})]})},es=e=>{let{node:t,level:l}=e,{onSelectTreeNode:s,activePath:i}=r.useContext(X),a="file"===t.file.kind,o=t.fullPath===i;return(0,n.jsxs)(en,{level:l,onClick:e=>{a&&(null==s||s(t))},isActive:o,children:[(0,n.jsx)(w.IconFile,{className:"shrink-0"}),(0,n.jsx)("div",{className:"truncate",children:null==t?void 0:t.name})]})},ei=e=>{var t,l,s;let{node:i,level:a,root:o}=e,{fileMap:c,updateFileMap:u,expandedKeys:x,toggleExpandedKey:h,onSelectTreeNode:v,activePath:m}=r.useContext(X),p=r.useRef(!1),j=r.useMemo(()=>_(i.fullPath),[i.fullPath]),g=o?"":i.file.basename,b=x.has(i.fullPath),y="dir"===i.file.kind&&!(null==c?void 0:null===(t=c[i.fullPath])||void 0===t?void 0:t.treeExpanded)&&b,{data:N,isLoading:k}=(0,d.Z)(y?"/repositories/".concat(j,"/resolve/").concat(g):null,f.Z,{revalidateIfStale:!1});r.useEffect(()=>{var e;if(!p.current&&(null==N?void 0:null===(e=N.entries)||void 0===e?void 0:e.length)){let e=N.entries.reduce((e,t)=>{let l="".concat(j,"/").concat(t.basename);return{...e,[l]:{file:t,name:R(l),fullPath:l,treeExpanded:!1}}},{});u(e),p.current=!0}},[N]);let[C]=(0,D.n)(k,300),S=!!(null==i?void 0:null===(l=i.children)||void 0===l?void 0:l.length);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(er,{level:a,onClick:e=>{null==v||v(i)},isActive:m===i.fullPath,children:[(0,n.jsx)("div",{className:"flex h-8 shrink-0 items-center hover:bg-primary/10 hover:text-popover-foreground",onClick:e=>{C||(h(i.fullPath),e.stopPropagation())},children:C&&!p.current?(0,n.jsx)(w.IconSpinner,{}):b?(0,n.jsx)(w.IconChevronDown,{}):(0,n.jsx)(w.IconChevronRight,{})}),(0,n.jsx)("div",{className:"shrink-0",style:{color:"rgb(84, 174, 255)"},children:b?(0,n.jsx)(w.IconDirectoryExpandSolid,{}):(0,n.jsx)(w.IconDirectorySolid,{})}),(0,n.jsx)("div",{className:"truncate",children:null==i?void 0:i.name})]}),(0,n.jsx)(n.Fragment,{children:b&&S?(0,n.jsx)(n.Fragment,{children:null===(s=i.children)||void 0===s?void 0:s.map(e=>{let t=e.file.basename;return"dir"===e.file.kind?(0,n.jsx)(ei,{node:e,level:a+1},t):(0,n.jsx)(es,{node:e,level:a+1},t)})}):null})]})},ea=()=>{let{initialized:e,activePath:t,fileMap:l,fileTreeData:s}=r.useContext(X),i=_(t);return e?(0,$.Z)(l)?(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:"No Indexed repository"}):!i||(null==s?void 0:s.length)?i?(0,n.jsx)(n.Fragment,{children:null==s?void 0:s.map(e=>{var t;let l=(null==e?void 0:null===(t=e.file)||void 0===t?void 0:t.kind)==="file";return l?(0,n.jsx)(es,{level:0,node:e},e.fullPath):(0,n.jsx)(ei,{level:0,node:e},e.fullPath)})}):null:(0,n.jsx)("div",{className:"flex h-full items-center justify-center",children:"No Data"}):(0,n.jsx)(ec,{})},eo=e=>{let{className:t,...l}=e;return(0,n.jsx)("div",{className:(0,x.cn)("group/filetree",t),children:(0,n.jsx)(ee,{...l,children:(0,n.jsx)(ea,{})})})};function ec(){return(0,n.jsxs)("div",{className:"space-y-3 p-2",children:[(0,n.jsx)(L.O,{}),(0,n.jsx)(L.O,{className:"ml-4"}),(0,n.jsx)(L.O,{className:"ml-4"}),(0,n.jsx)(L.O,{}),(0,n.jsx)(L.O,{className:"ml-4"})]})}var ed=l(70470),eu=l(99109),ef=l(60106),ex=l(58094),eh=l(35216);let ev=(0,ef.BX)("\n  query RepositorySearch($repositoryName: String!, $pattern: String!) {\n    repositorySearch(repositoryName: $repositoryName, pattern: $pattern) {\n      type\n      path\n      indices\n    }\n  }\n"),em=e=>{let{className:t,...l}=e,{activePath:s,fileTreeData:i,setActivePath:a,initialized:o,updateFileMap:c,setExpandedKeys:d}=(0,r.useContext)(eC),{setProgress:u}=(0,j.U)(),f=_(s),h=r.useRef(null),[v,m]=r.useState(),[p,g]=r.useState(),[b,y]=r.useState(),[k,C]=r.useState(!1),S=o&&!(null==i?void 0:i.length),[{data:P}]=(0,eu.aM)({query:ev,variables:{repositoryName:f,pattern:null!=p?p:""},pause:!f||!p});r.useEffect(()=>{var e,t;let l=null!==(t=null==P?void 0:null===(e=P.repositorySearch)||void 0===e?void 0:e.map(e=>({...e,id:e.path})))&&void 0!==t?t:[];y(l),C(!!p)},[null==P?void 0:P.repositorySearch]);let E=(0,D.S)(e=>{e?g(e):(g(""),C(!1),y([]))},500),z=()=>{E.run(""),E.flush()},I=async e=>{let t=e.path;if(!t)return;let l="".concat(f,"/").concat(t);try{u(!0);let e=await F(l),n=Z(t),r={};for(let t of e){let e="".concat(f,"/").concat(t.basename);r[e]={file:t,name:R(e),fullPath:e,treeExpanded:n.includes(t.basename)}}let s=n.map(e=>[f,e].filter(Boolean).join("/"));r&&c(r),(null==s?void 0:s.length)&&d(e=>{let t=new Set(e);for(let e of s)t.add(e);return t})}catch(e){}finally{a(l),u(!1)}};return r.useEffect(()=>{let e=e=>{var t,l;let n=e.target,r=null==n?void 0:null===(t=n.tagName)||void 0===t?void 0:t.toLowerCase();"input"!==r&&"textarea"!==r&&"select"!==r&&"t"===e.key&&(e.preventDefault(),null===(l=h.current)||void 0===l||l.focus())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,n.jsxs)("div",{className:(0,x.cn)(t),...l,children:[(0,n.jsx)("div",{className:"py-4 font-bold leading-8",children:"Files"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)(ex.Ph,{onValueChange:e=>{a(e)},value:f,children:[(0,n.jsx)(ex.i4,{children:(0,n.jsx)(ex.ki,{children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(w.IconFolderGit,{}),(0,n.jsx)("span",{className:f?"":"text-muted-foreground",children:f||"Pick a repository"})]})})}),(0,n.jsx)(ex.Bw,{children:S?(0,n.jsx)(ex.Ql,{isPlaceHolder:!0,value:"",disabled:!0,children:"No indexed repository"}):(0,n.jsx)(n.Fragment,{children:null==i?void 0:i.map(e=>(0,n.jsx)(ex.Ql,{value:e.name,children:e.name},e.fullPath))})})]}),(0,n.jsx)(eh.Vc,{stayOpenOnInputClick:!0,options:b,onSelect:I,open:k,onOpenChange:e=>{(v||(null==b?void 0:b.length))&&e?C(!0):C(!1)},children:e=>{let{highlightedIndex:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eh.JH,{children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(eh.KM,{className:"pr-8",placeholder:"Go to file",spellCheck:!1,value:v,ref:h,disabled:!f,onClick:e=>{p&&!k&&C(!0)},onChange:e=>{let t=e.target.value;m(t),t?E.run(t):z()}}),(0,n.jsx)("div",{className:"absolute right-2 top-0 flex h-full items-center",children:v?(0,n.jsx)(N.z,{variant:"ghost",size:"icon",className:"h-6 w-6 cursor-pointer",onClick:e=>{var t;m(""),z(),null===(t=h.current)||void 0===t||t.focus()},children:(0,n.jsx)(w.IconClose,{})}):(0,n.jsx)("kbd",{className:"rounded-md border bg-secondary/50 px-1.5 text-xs leading-4 text-muted-foreground shadow-[inset_-0.5px_-1.5px_0_hsl(var(--muted))]",onClick:e=>{var t;null===(t=h.current)||void 0===t||t.focus()},children:"t"})})]})}),(0,n.jsx)(eh.fD,{align:"start",side:"bottom",onOpenAutoFocus:e=>e.preventDefault(),style:{width:"50vw",maxWidth:700},className:"max-h-[50vh] overflow-y-scroll",children:(0,n.jsx)(n.Fragment,{children:(null==b?void 0:b.length)?null==b?void 0:b.map((e,l)=>(0,n.jsxs)(eh.x5,{item:e,index:l,className:"flex w-full items-center gap-2 overflow-x-hidden",children:[(0,n.jsx)("div",{className:"shrink-0",children:"dir"===e.type?(0,n.jsx)(w.IconDirectorySolid,{style:{color:"rgb(84, 174, 255)"}}):(0,n.jsx)(w.IconFile,{})}),(0,n.jsx)("div",{className:"flex-1 break-all",children:(0,n.jsx)(ep,{text:e.path,indices:e.indices})}),t===l&&(0,n.jsx)("div",{className:"shrink-0`",children:"dir"===e.type?"Go to folder":"Go to file"})]},null==e?void 0:e.id)):(0,n.jsx)("div",{className:"flex h-24 items-center justify-center",children:"No matches found"})})})]})}})]})]})},ep=e=>{let{text:t,indices:l}=e,s=r.useMemo(()=>new Set(l),[l]);return(0,n.jsx)("p",{className:"text-muted-foreground",children:t.split("").map((e,t)=>s.has(t)?(0,n.jsx)("span",{className:"font-semibold text-foreground",children:e}):e)})},ej=()=>{let{activePath:e,setActivePath:t,expandedKeys:l,updateFileMap:s,toggleExpandedKey:i,initialized:a,fileTreeData:o,fileMap:c}=r.useContext(eC),d=r.useRef(null),u=function(e,t){var l,n;let[s,i]=(0,r.useState)(null!==(n=null===(l=e.current)||void 0===l?void 0:l.scrollTop)&&void 0!==n?n:0);return(0,r.useEffect)(()=>{if(e.current){let l=(0,ed.Z)(()=>{var t,l;i(null!==(l=null===(t=e.current)||void 0===t?void 0:t.scrollTop)&&void 0!==l?l:0)},t,{leading:!0}),n=e.current;return n.addEventListener("scroll",l),()=>{n.removeEventListener("scroll",l)}}},[e,t]),s}(d,200),f=r.useMemo(()=>{var t;let l=_(e),n=o.find(e=>e.name===l);return null!==(t=null==n?void 0:n.children)&&void 0!==t?t:[]},[e,o]);return(0,n.jsxs)("div",{className:"flex h-full flex-col overflow-hidden",children:[(0,n.jsx)(em,{className:"shrink-0 px-4 pb-3"}),u>0&&(0,n.jsx)("div",{className:"h-0 border-b shadow-[0px_3px_8px_rgba(0,0,0,0.3)] dark:shadow-[0px_3px_8px_rgba(255,255,255,0.3)]"}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto px-4",ref:d,children:(0,n.jsx)(eo,{onSelectTreeNode:e=>{t(e.fullPath)},activePath:e,fileMap:c,updateFileMap:s,expandedKeys:l,toggleExpandedKey:i,initialized:a,fileTreeData:f})})]})},eg=e=>{let{className:t,blob:l,isImage:s,contentLength:i}=e,{activePath:a}=(0,r.useContext)(eC);return(0,n.jsxs)("div",{className:(0,x.cn)(t),children:[(0,n.jsx)(H,{blob:l,contentLength:i}),(0,n.jsx)("div",{className:"rounded-b-lg border border-t-0 p-2 text-center",children:s?(0,n.jsx)("img",{className:"mx-auto",src:l?URL.createObjectURL(l):void 0}):(0,n.jsx)("a",{className:"text-primary hover:underline",download:R(null!=a?a:""),href:l?URL.createObjectURL(l):"",target:"_blank",children:"View raw"})})]})};var eb=l(67579),ey=l(93111);let eN=r.lazy(()=>Promise.all([l.e(8301),l.e(6401),l.e(5782),l.e(4960),l.e(7582)]).then(l.bind(l,37582))),ew=r.lazy(()=>Promise.all([l.e(352),l.e(4403),l.e(3109)]).then(l.bind(l,23109))),ek=e=>{var t,l;let{className:i,blob:a,meta:o,contentLength:c}=e,{searchParams:d,updateSearchParams:f}=(0,u.Z)(),[h,v]=r.useState(""),{activePath:m}=(0,r.useContext)(eC),p=m?(0,s.Z)(m)[0]:void 0,j=(null!==(l=null==o?void 0:o.language)&&void 0!==l?l:p)||"",g=!!h&&"markdown"===j,b=(null===(t=d.get("plain"))||void 0===t?void 0:t.toString())==="1";return r.useEffect(()=>{let e=async e=>{try{let t=await e.text();v(t)}catch(e){v("")}};a&&e(a)},[a]),(0,n.jsxs)("div",{className:(0,x.cn)(i),children:[(0,n.jsx)(H,{blob:a,contentLength:c,canCopy:!0,children:g&&(0,n.jsx)(eb.mQ,{value:b?"1":"0",onValueChange:e=>{"1"===e?f({set:{plain:"1"}}):f({del:"plain"})},children:(0,n.jsxs)(eb.dr,{children:[(0,n.jsx)(eb.SP,{value:"0",children:"Preview"}),(0,n.jsx)(eb.SP,{value:"1",children:"Code"})]})})}),(0,n.jsx)("div",{className:"rounded-b-lg border border-t-0 p-2",children:(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)(ey.cg,{}),children:g&&!b?(0,n.jsx)(ew,{value:h}):(0,n.jsx)(eN,{value:h,language:j,meta:o})})})]})},eC=r.createContext({}),eS=e=>{let{children:t}=e,{searchParams:l,updateSearchParams:s}=(0,u.Z)(),a=r.useMemo(()=>{var e,t;return null!==(t=null===(e=l.get("path"))||void 0===e?void 0:e.toString())&&void 0!==t?t:""},[l]),[o,c]=r.useState(!1),[d,f]=r.useState({}),[x,h]=r.useState(new Set),[v,m]=r.useState(!1),[p,j]=r.useState(),g=r.useMemo(()=>{if(!a)return[];let e=[],t=a.split("/");for(let l=0;l<t.length;l++){let n=t.slice(0,l+1).join("/");e.push(null==d?void 0:d[n])}return(0,i.Z)(e)},[a,d]),b=r.useMemo(()=>(function e(t){if(!t.length)return[];for(let l of(t.sort((e,t)=>{let l="file"===e.file.kind?1:0,n="file"===t.file.kind?1:0;return l-n||e.name.localeCompare(t.name)}),t))(null==l?void 0:l.children)&&e(l.children);return t})(function(e){let t=[];if(!e)return t;let l=Object.keys(e);for(let n of l){let l=e[n],r=n.split("/"),s=t;for(let e=0;e<r.length;e++){let t=r[e],i=null==s?void 0:s.find(e=>e.name===t);if(i)s=i.children||[];else{let e={file:l.file,name:t,fullPath:n,children:[]};s.push(e),s=e.children}}}return t}(d)),[d]);return(0,n.jsx)(eC.Provider,{value:{initialized:o,setInitialized:c,activePath:a,setActivePath:e=>{e?s({set:{path:e},del:"plain"}):s({del:["path","plain"]})},fileMap:d,updateFileMap:e=>{e&&f(t=>({...t,...e}))},expandedKeys:x,setExpandedKeys:h,toggleExpandedKey:e=>{let t=x.has(e),l=new Set(x);t?l.delete(e):l.add(e),h(l)},currentFileRoutes:g,fileTreeData:b,chatSideBarVisible:v,setChatSideBarVisible:m,pendingEvent:p,setPendingEvent:j},children:t})},eP=e=>{var t,l,s;let{className:i}=e,{activePath:a,updateFileMap:u,fileMap:h,initialized:b,setInitialized:y,setExpandedKeys:N,chatSideBarVisible:w,setChatSideBarVisible:C,setPendingEvent:S}=r.useContext(eC),{setProgress:P}=(0,j.U)(),F=r.useRef(null),[I,O]=r.useState(35),D=r.useMemo(()=>_(a),[a]),L=r.useMemo(()=>E(a),[a]),[M,T]=r.useState(),V=a&&(null==h?void 0:null===(l=h[a])||void 0===l?void 0:null===(t=l.file)||void 0===t?void 0:t.kind)==="file",A=a?null==h?void 0:null===(s=h[a])||void 0===s?void 0:s.file:void 0,B=r.useMemo(()=>{var e,t,l;if(!b)return!1;let n=a&&(null==h?void 0:null===(t=h[a])||void 0===t?void 0:null===(e=t.file)||void 0===e?void 0:e.kind)==="dir";return n&&!(null==h?void 0:null===(l=h[a])||void 0===l?void 0:l.treeExpanded)},[a,h,b]),{data:U,isLoading:G}=(0,d.Z)(V?"/repositories/".concat(D,"/resolve/").concat(L):null,e=>(0,f.Z)(e,{responseFormatter:async e=>{if(!e.ok)return;let t=(0,o.Z)(e.headers.get("Content-Length")),l=await e.blob();return{contentLength:t,blob:l}}}),{onError(e){c.A.error("Fail to fetch")}});r.useEffect(()=>{G?P(!0):P(!1)},[G]);let K=null==U?void 0:U.blob,J=null==U?void 0:U.contentLength,{data:Q}=(0,d.Z)(V?"/repositories/".concat(D,"/meta/").concat(L):null,f.Z),{data:q,isLoading:H}=(0,d.Z)(B?"/repositories/".concat(D,"/resolve/").concat(L):null,f.Z),Y=(null==A?void 0:A.kind)==="dir"||""===a,$=V&&"text"===M,X=V&&("image"===M||"raw"===M);return r.useEffect(()=>{let e=async()=>{let{patchMap:e,expandedKeys:t}=await eE(a);e&&u(e),(null==t?void 0:t.length)&&N(new Set(t)),y(!0)};e()},[]),r.useEffect(()=>{(()=>{var e;if((null==q?void 0:null===(e=q.entries)||void 0===e?void 0:e.length)&&a){let e=_(a),t={};for(let l of q.entries){let n="".concat(e,"/").concat(l.basename);t[n]={file:l,name:R(n),fullPath:n,treeExpanded:!1}}u(t);let l=Z(a,!0);(null==l?void 0:l.length)&&N(e=>{let t=new Set(e);for(let e of l)t.add(e);return t})}})()},[q]),r.useEffect(()=>{let e=async()=>{let e=await eR(null!=a?a:"",K);T(e)};V?e():T("")},[a,V,K]),r.useEffect(()=>{let e=e=>{C(!0),S(e)};return g.u.on("code_browser_quick_action",e),()=>{g.u.off("code_browser_quick_action",e)}},[]),r.useEffect(()=>{var e,t,l;w?(null===(e=F.current)||void 0===e||e.expand(),null===(t=F.current)||void 0===t||t.resize(I)):null===(l=F.current)||void 0===l||l.collapse()},[w]),(0,n.jsxs)(v,{direction:"horizontal",className:(0,x.cn)(i),onLayout:e=>{(null==e?void 0:e[2])&&O(e[2])},children:[(0,n.jsx)(m,{defaultSize:20,minSize:20,maxSize:40,children:(0,n.jsx)(ej,{})}),(0,n.jsx)(p,{className:"w-1 bg-border/40 hover:bg-border active:bg-blue-500"}),(0,n.jsx)(m,{defaultSize:80,minSize:30,children:(0,n.jsxs)("div",{className:"flex h-full flex-col overflow-y-auto px-4 pb-4",children:[(0,n.jsx)(z,{className:"py-4"}),(0,n.jsxs)("div",{children:[Y&&(0,n.jsx)(W,{loading:H,initialized:b,className:"rounded-lg border"}),$&&(0,n.jsx)(ek,{blob:K,meta:Q,contentLength:J}),X&&(0,n.jsx)(eg,{blob:K,isImage:"image"===M,contentLength:J})]})]})}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p,{className:(0,x.cn)("hidden w-1 bg-border/40 hover:bg-border active:bg-blue-500",w&&"block")}),(0,n.jsx)(m,{collapsible:!0,collapsedSize:0,defaultSize:0,minSize:25,ref:F,children:(0,n.jsx)(k,{})})]})]})},e_=e=>(0,n.jsx)(eS,{children:(0,n.jsx)(eP,{className:"source-code-browser",...e})});async function eE(e){let t=_(e),l=E(e);try{let e=await n(),r=await s(e),i=Z(l),a={};for(let l of e)a[l.basename]={file:l,name:l.basename,fullPath:l.basename,treeExpanded:l.basename===t};for(let e of r){let l="".concat(t,"/").concat(e.basename);a[l]={file:e,name:R(l),fullPath:l,treeExpanded:i.includes(e.basename)}}let o=i.map(e=>[t,e].filter(Boolean).join("/"));return{patchMap:a,expandedKeys:o}}catch(e){return console.error(e),{}}async function n(){try{let e=await (0,f.Z)("/repositories/resolve/");return null==e?void 0:e.entries}catch(e){return[]}}async function r(l){try{if(!t)return;let n=(0,a.Z)(l,e=>e.basename===t);if(n<0)return;return F(e)}catch(e){console.error(e)}}async function s(e){let l=[];try{if(t&&(null==e?void 0:e.length)){let t=await r(e);l=null!=t?t:[]}}catch(e){console.error(e)}return l}}async function eR(e,t){var l;if(!t)return"";let n=null==t?void 0:t.type,r=null===(l=(0,s.Z)(e))||void 0===l?void 0:l[0];if(null==n?void 0:n.startsWith("image"))return"image";if(r||(null==n?void 0:n.startsWith("text")))return"text";let i=await new Promise((e,l)=>{let n=t.slice(0,1024),r=new FileReader;r.onloadend=function(t){var l;if((null==t?void 0:null===(l=t.target)||void 0===l?void 0:l.readyState)===FileReader.DONE){let l=t.target.result;"string"!=typeof l?e(!1):/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/.test(l)?e(!1):e(!0)}},r.onerror=function(){e(!1)},r.readAsText(n,"UTF-8")});return i?"text":"raw"}},23977:function(e,t,l){"use strict";l.d(t,{u:function(){return r}});var n=l(60681);let r=(0,n.Z)()},30522:function(e,t,l){"use strict";l.d(t,{J:function(){return d},U:function(){return u}});var n=l(57437),r=l(2265),s=l(6435),i=l(16450),a=l.n(i),o=l(36850);let c=r.createContext({}),d=e=>{let{children:t}=e,[l,i]=r.useState(!1),[d]=(0,o.n)(l,300,{leading:!0}),{theme:u}=(0,s.F)();return r.useEffect(()=>{a().config({barColors:{0:"dark"===u?"#DC981A":"#B7942B"}})},[]),(0,n.jsxs)(c.Provider,{value:{progress:d,setProgress:i},children:[d&&(0,n.jsx)(a(),{}),t]})},u=()=>r.useContext(c)},58094:function(e,t,l){"use strict";l.d(t,{Bw:function(){return f},DI:function(){return c},Ph:function(){return o},Ql:function(){return h},i4:function(){return u},ki:function(){return d}});var n=l(57437),r=l(2265),s=l(98608),i=l(39311),a=l(84168);let o=s.fC,c=s.ZA,d=s.B4,u=r.forwardRef((e,t)=>{let{className:l,children:r,...o}=e;return(0,n.jsxs)(s.xz,{ref:t,className:(0,i.cn)("flex h-9 w-full items-center justify-between rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l),...o,children:[r,(0,n.jsx)(s.JO,{asChild:!0,children:(0,n.jsx)(a.IconChevronUpDown,{className:"opacity-50"})})]})});u.displayName=s.xz.displayName;let f=r.forwardRef((e,t)=>{let{className:l,children:r,position:a="popper",...o}=e;return(0,n.jsx)(s.h_,{children:(0,n.jsx)(s.VY,{ref:t,className:(0,i.cn)("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md animate-in fade-in-80","popper"===a&&"translate-y-1",l),position:a,...o,children:(0,n.jsx)(s.l_,{className:(0,i.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r})})})});f.displayName=s.VY.displayName;let x=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)(s.__,{ref:t,className:(0,i.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",l),...r})});x.displayName=s.__.displayName;let h=r.forwardRef((e,t)=>{let{className:l,children:r,isPlaceHolder:o,...c}=e;return(0,n.jsxs)(s.ck,{ref:t,className:(0,i.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",l),...c,children:[!o&&(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(s.wU,{children:(0,n.jsx)(a.IconCheck,{className:"h-4 w-4"})})}),(0,n.jsx)(s.eT,{children:r})]})});h.displayName=s.ck.displayName;let v=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)(s.Z0,{ref:t,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",l),...r})});v.displayName=s.Z0.displayName},32553:function(e,t,l){"use strict";l.d(t,{RM:function(){return o},SC:function(){return d},iA:function(){return i},pj:function(){return f},ss:function(){return u},xD:function(){return a}});var n=l(57437),r=l(2265),s=l(39311);let i=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("table",{ref:t,className:(0,s.cn)("w-full caption-bottom text-sm",l),...r})});i.displayName="Table";let a=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("thead",{ref:t,className:(0,s.cn)("[&_tr]:border-b",l),...r})});a.displayName="TableHeader";let o=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("tbody",{ref:t,className:(0,s.cn)("[&_tr:last-child]:border-0",l),...r})});o.displayName="TableBody";let c=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("tfoot",{ref:t,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",l),...r})});c.displayName="TableFooter";let d=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("tr",{ref:t,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",l),...r})});d.displayName="TableRow";let u=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("th",{ref:t,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",l),...r})});u.displayName="TableHead";let f=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("td",{ref:t,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",l),...r})});f.displayName="TableCell";let x=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)("caption",{ref:t,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",l),...r})});x.displayName="TableCaption"},67579:function(e,t,l){"use strict";l.d(t,{SP:function(){return c},dr:function(){return o},mQ:function(){return a},nU:function(){return d}});var n=l(57437),r=l(2265),s=l(34522),i=l(39311);let a=s.fC,o=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)(s.aV,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",l),...r})});o.displayName=s.aV.displayName;let c=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)(s.xz,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",l),...r})});c.displayName=s.xz.displayName;let d=r.forwardRef((e,t)=>{let{className:l,...r}=e;return(0,n.jsx)(s.VY,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",l),...r})});d.displayName=s.VY.displayName},20946:function(e,t,l){"use strict";l.d(t,{B:function(){return a},D:function(){return o}});var n=l(2265);let r=(e,t)=>{let[l,r]=(0,n.useState)(t),[s,i]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let t=localStorage.getItem(e);t&&r(JSON.parse(t)),i(!1)},[]),[l,t=>{r(t),localStorage.setItem(e,JSON.stringify(t))},s]};class s{get value(){if("undefined"!=typeof localStorage){let e=localStorage.getItem(this.storageKey);if(e)return"true"===e}return this.defaultValue}constructor(e,t,l,n){this.storageKey=e,this.title=t,this.description=l,this.defaultValue=n}}let i=new class{defineGlobalVar(){return new s(this.storageKey,this.title,this.description,this.defaultValue)}defineHook(){return()=>{let[e,t,l]=r(this.storageKey,this.defaultValue);return[{value:e,title:this.title,description:this.description,loading:l},()=>{t(!e)}]}}constructor(e,t,l,n){this.storageKey="EXP_".concat(e),this.title=t,this.description=l,this.defaultValue=null!=n&&n}}("enable_code_browser_quick_action_bar","Quick Action Bar","Enable Quick Action Bar to display a convenient toolbar when you select code, offering options to explain the code, add unit tests, and more.",!1),a=i.defineGlobalVar(),o=i.defineHook()}},function(e){e.O(0,[768,9109,584,3072,2699,1424,7070,3714,6410,713,6630,2453,8608,1408,9190,4018,4522,5367,7753,4168,2445,278,2971,7864,1744],function(){return e(e.s=51848)}),_N_E=e.O()}]);