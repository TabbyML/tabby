(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[357],{51848:function(e,t,r){Promise.resolve().then(r.bind(r,82959))},82959:function(e,t,r){"use strict";r.r(t),r.d(t,{SourceCodeBrowser:function(){return F},SourceCodeBrowserContext:function(){return z}});var n=r(57437),l=r(2265),a=r(30415),i=r.n(a),s=r(91067),o=r(1589),c=r(24033),u=r(1592),d=r(39311),f=r(61574);let h=e=>{let{className:t,...r}=e;return(0,n.jsx)(f.eh,{className:(0,d.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...r})},v=f.s_,m=e=>{let{withHandle:t,className:r,...l}=e;return(0,n.jsx)(f.OT,{className:(0,d.cn)("border-bg relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",r),...l,children:t&&(0,n.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border"})})};var x=r(16630),p=r(24144),g=r(58001),b=r(84168);let j=l.createContext({}),y=e=>{let{onSelectTreeNode:t,children:r,repositoryName:a,initialFileMap:i,activePath:s,defaultExpandedKeys:o=[]}=e,[c,u]=l.useState(null!=i?i:{}),[d,f]=l.useState(new Set(o)),h=l.useMemo(()=>{let e=function(e,t){let r=[],n=Object.keys(e),l=n.filter(e=>e!==t),a=null==e?void 0:e[t];for(let t of l){let n=e[t],l=n.file.basename.split("/"),a=r;for(let e=0;e<l.length;e++){let t=l[e],r=null==a?void 0:a.find(e=>e.name===t);if(r)a=r.children||[];else{let e={file:n.file,name:t,children:[]};a.push(e),a=e.children}}}return{file:(null==a?void 0:a.file)||{kind:"dir",basename:t},name:function(e){var t;let r=null===(t=/https_github.com_(\w+).git/.exec(e))||void 0===t?void 0:t[1];return r||e}(t),children:r}}(c,a);return function e(t){if(!t.length)return[];for(let r of(t.sort((e,t)=>{let r="file"===e.file.kind?1:0,n="file"===t.file.kind?1:0;return r-n||e.name.localeCompare(t.name)}),t))(null==r?void 0:r.children)&&e(r.children);return t}(e.children||[]),e},[c,a]);return(0,n.jsx)(j.Provider,{value:{fileMap:c,updateFileMap:e=>{e&&u({...c,...e})},onSelectTreeNode:t,fileTree:h,repositoryName:a,expandedKeys:d,toggleExpandedKey:e=>{let t=d.has(e),r=new Set(d);t?r.delete(e):r.add(e),f(r)},activePath:s},children:r})},N=e=>{let{level:t}=e,r=l.useMemo(()=>Array(t).fill(1),[t]);return(0,n.jsx)("div",{className:"flex h-full shrink-0 items-stretch",children:r.map((e,t)=>(0,n.jsx)("div",{className:"flex h-8 w-2 border-r border-transparent transition-colors duration-300 group-hover/filetree:border-border"},t))})},w=e=>{let{isActive:t,level:r,children:l,className:a,...i}=e;return(0,n.jsxs)("div",{className:(0,d.cn)("flex cursor-pointer items-stretch rounded-sm hover:bg-accent focus:bg-accent focus:text-accent-foreground",t&&"bg-accent",a),...i,children:[(0,n.jsx)(N,{level:r}),(0,n.jsxs)("div",{className:"flex flex-nowrap items-center gap-2 truncate whitespace-nowrap py-1",children:[(0,n.jsx)("div",{className:"h-4 w-4 shrink-0"}),l]})]})},k=e=>{let{children:t,level:r,className:l,...a}=e;return(0,n.jsxs)("div",{className:(0,d.cn)("flex cursor-pointer items-stretch rounded-sm hover:bg-accent focus:bg-accent focus:text-accent-foreground",l),...a,children:[(0,n.jsx)(N,{level:r}),(0,n.jsx)("div",{className:"flex flex-nowrap items-center gap-2 truncate whitespace-nowrap py-1",children:t})]})},S=e=>{let{node:t,level:r}=e,{onSelectTreeNode:a,activePath:i,repositoryName:s}=l.useContext(j),o="file"===t.file.kind,c="".concat(s,"/").concat(t.file.basename)===i;return(0,n.jsxs)(w,{level:r,onClick:e=>{o&&(null==a||a(t,s))},isActive:c,children:[(0,n.jsx)(b.Xh,{className:"shrink-0"}),(0,n.jsx)("div",{className:"truncate",children:null==t?void 0:t.name})]})},E=e=>{var t,r,a;let{node:i,level:s,root:c}=e,{repositoryName:d,fileMap:f,updateFileMap:h,expandedKeys:v,toggleExpandedKey:m}=l.useContext(j),x=l.useRef(!1),p=c?"":i.file.basename,g=v.has(p),y="dir"===i.file.kind&&!(null==f?void 0:null===(t=f[p])||void 0===t?void 0:t.treeExpanded)&&g,{data:N,isValidating:w}=(0,o.Z)(y?"/repositories/".concat(d,"/resolve/").concat(p):null,u.Z,{revalidateIfStale:!1});l.useEffect(()=>{var e;if(!x.current&&(null==N?void 0:null===(e=N.entries)||void 0===e?void 0:e.length)){let e=N.entries.reduce((e,t)=>({...e,["".concat(d,"/").concat(t.basename)]:{file:t,treeExpanded:!1}}),{});h(e),x.current=!0}},[N]);let C=function(e,t){let[r,n]=l.useState(e);return l.useEffect(()=>{let r=setTimeout(()=>{n(e)},t);return()=>clearTimeout(r)},[e,t]),r}(w,100),P=!!(null==i?void 0:null===(r=i.children)||void 0===r?void 0:r.length);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(k,{level:s,onClick:e=>{C||m(p)},children:[(0,n.jsx)("div",{className:"shrink-0",children:C&&!x.current?(0,n.jsx)(b.vM,{}):g?(0,n.jsx)(b.C2,{}):(0,n.jsx)(b.VG,{})}),(0,n.jsx)("div",{className:"shrink-0",style:{color:"rgb(84, 174, 255)"},children:g?(0,n.jsx)(b.F8,{}):(0,n.jsx)(b.oR,{})}),(0,n.jsx)("div",{className:"truncate",children:null==i?void 0:i.name})]}),(0,n.jsx)(n.Fragment,{children:g&&P?(0,n.jsx)(n.Fragment,{children:null===(a=i.children)||void 0===a?void 0:a.map(e=>{let t=e.file.basename;return"dir"===e.file.kind?(0,n.jsx)(E,{node:e,level:s+1},t):(0,n.jsx)(S,{node:e,level:s+1},t)})}):null})]})},C=()=>{let{fileTree:e}=l.useContext(j);return(0,n.jsx)(E,{root:!0,level:0,node:e})},P=e=>{let{onSelectTreeNode:t,repositoryName:r,className:a,activePath:i,defaultEntries:s,defaultExpandedKeys:o,...c}=e,u=l.useMemo(()=>(null==s?void 0:s.length)?function(e,t,r){let n={};for(let l of e)n["".concat(t,"/").concat(l.basename)]={file:l,treeExpanded:l.basename===t||(null==r?void 0:r.includes(l.basename))};return n}(s,r,o):{[r]:{file:{kind:"dir",basename:r},treeExpanded:!1}},[]);return(0,n.jsx)("div",{className:(0,d.cn)(a),...c,children:(0,n.jsx)(y,{onSelectTreeNode:t,repositoryName:r,activePath:i,initialFileMap:u,defaultExpandedKeys:o,children:(0,n.jsx)(C,{})})})},T=e=>{let{onSelectTreeNode:t,activePath:r,className:a,defaultBasename:i,defaultRepository:s,...o}=e,{data:c}=(0,g.kP)(),f=null==c?void 0:c.accessToken,h=l.useRef(!1),[v,m]=l.useState(),[p,b]=l.useState(),[j,y]=l.useState(),N=async()=>{try{if(!f)return[];let e=await (0,u.Z)("/repositories/resolve/");return null==e?void 0:e.entries}catch(e){return[]}},w=async e=>{try{if(!f||!s||!i)return;let r=(0,x.Z)(e,e=>e.basename===s);if(r<0)return;let n=Z(i),l=n.map(e=>()=>(0,u.Z)("/repositories/".concat(s,"/resolve/").concat(e))),a=await Promise.all(l.map(e=>e())),o=[];for(let e of a){var t;(null===(t=e.entries)||void 0===t?void 0:t.length)&&(o=[...o,...e.entries])}return o}catch(e){console.error(e)}},k=async e=>{let t={defaultEntriesRes:[],expandedKeys:[]};try{if(i&&s&&(null==e?void 0:e.length)){let r=await w(e),n=Z(i);(null==r?void 0:r.length)&&(t.defaultEntriesRes=r),(null==n?void 0:n.length)&&(t.expandedKeys=n)}}catch(e){console.error(e)}return h.current=!0,t},S=async()=>{try{let e=await N(),{defaultEntriesRes:t,expandedKeys:r}=await k(e);y(e),m(t),b(r)}catch(e){console.error(e)}h.current=!0};return(l.useEffect(()=>{!h.current&&f&&S()},[f]),h.current)?(null==j?void 0:j.length)?(0,n.jsx)("div",{className:(0,d.cn)("group/filetree",a),...o,children:null==j?void 0:j.map(e=>(0,n.jsx)(P,{repositoryName:e.basename,activePath:r,onSelectTreeNode:t,defaultEntries:e.basename===s?v:void 0,defaultExpandedKeys:e.basename===s?p:void 0},e.basename))}):(0,n.jsx)("div",{className:"mt-1 flex justify-center",children:"No Data"}):(0,n.jsx)(R,{})};function R(){return(0,n.jsxs)("ul",{className:"duration-600 animate-pulse space-y-3 p-2",children:[(0,n.jsx)("li",{className:"h-4 rounded-md bg-gray-200 dark:bg-gray-700"}),(0,n.jsx)("li",{className:"ml-4 h-4 rounded-md bg-gray-200 dark:bg-gray-700"}),(0,n.jsx)("li",{className:"ml-4 h-4 rounded-md bg-gray-200 dark:bg-gray-700"}),(0,n.jsx)("li",{className:"h-4 rounded-md bg-gray-200 dark:bg-gray-700"}),(0,n.jsx)("li",{className:"ml-4 h-4 rounded-md bg-gray-200 dark:bg-gray-700"})]})}function Z(e){if((0,p.Z)(e))return[];let t=[""],r=e.split("/");for(let e=0;e<r.length-1;e++)t.push(r.slice(0,e+1).join("/"));return t}let _=i()(()=>Promise.all([r.e(8301),r.e(6401),r.e(980),r.e(3830)]).then(r.bind(r,53830)),{loadableGenerated:{webpack:()=>[53830]},ssr:!1}),z=l.createContext({}),M=e=>{let{children:t}=e,[r,a]=l.useState(),[i,s]=(0,l.useState)({}),[o,c]=(0,l.useState)({});return(0,n.jsx)(z.Provider,{value:{codeMap:i,setCodeMap:s,fileMetaMap:o,setFileMetaMap:c,activePath:r,setActivePath:a},children:t})},O=e=>{var t,r;let{className:a}=e,{searchParams:i,updateSearchParams:f}=function(){let e=(0,c.usePathname)(),t=(0,c.useRouter)(),r=(0,c.useSearchParams)();return{pathname:e,router:t,searchParams:r,updateSearchParams:n=>{let{set:l,del:a,replace:i,getNewPath:s}=n,o=new URLSearchParams(r);l&&Object.entries(l).forEach(e=>{let[t,r]=e;return o.set(t,r)}),a&&(Array.isArray(a)?a.forEach(e=>o.delete(e)):o.delete(a));let c=o.toString(),u="".concat(e).concat(c.length>0?"?".concat(c):"");if(s)return u;i?t.replace(u):t.push(u)},getQueryString:e=>{let t=new URLSearchParams(r);e&&Object.entries(e).forEach(e=>{let[r,n]=e;return t.set(r,n)});let n=t.toString();return n.length>0?"?".concat(n):""}}}(),x=null===(t=i.get("repo"))||void 0===t?void 0:t.toString(),p=null===(r=i.get("path"))||void 0===r?void 0:r.toString(),[g,b]=l.useState(null!=x?x:""),[j,y]=l.useState(null!=p?p:""),{activePath:N,setActivePath:w,codeMap:k,setCodeMap:S,setFileMetaMap:E}=l.useContext(z),{data:C}=(0,o.Z)(j&&g?"/repositories/".concat(g,"/resolve/").concat(j):null,e=>(0,u.Z)(e,{format:"text"})),{data:P}=(0,o.Z)(C&&j&&g?"/repositories/".concat(g,"/meta/").concat(j):null,u.Z);return l.useEffect(()=>{p&&x&&w("".concat(x,"/").concat(p))},[]),l.useEffect(()=>{C&&N&&S(e=>({...e,[N]:C}))},[C]),l.useEffect(()=>{P&&N&&E(e=>({...e,[N]:P}))},[P]),(0,n.jsxs)(h,{direction:"horizontal",className:(0,d.cn)(a),children:[(0,n.jsx)(v,{defaultSize:20,minSize:20,children:(0,n.jsx)("div",{className:"h-full overflow-hidden py-2 pl-4",children:(0,n.jsx)(T,{className:"h-full overflow-y-auto overflow-x-hidden pr-4",onSelectTreeNode:(e,t)=>{let r="".concat(t,"/").concat(e.file.basename),n="file"===e.file.kind;n&&(b(t),w(r),(0,s.Z)(k,r)||y(e.file.basename),f({set:{repo:t,path:e.file.basename},replace:!0}))},activePath:N,defaultBasename:p,defaultRepository:x})})}),(0,n.jsx)(m,{className:"w-1 hover:bg-primary active:bg-primary"}),(0,n.jsx)(v,{defaultSize:80,minSize:30,children:(0,n.jsx)(_,{className:"flex h-full ".concat(N?"block":"hidden")})})]})},F=e=>(0,n.jsx)(M,{children:(0,n.jsx)(O,{className:"source-code-browser",...e})})},1592:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(34084),l=r(58001),a=r(7820);let i=!1,s=[];async function o(e,t){let r=await fetch(e,c(t));if(401!==r.status)return(null==t?void 0:t.format)==="text"?r.text():r.json();{var n,a;if(i)return new Promise(r=>{s.push({url:e,init:t,resolve:r})});let r=null===(n=(0,l.bW)())||void 0===n?void 0:n.refreshToken;if(!r){(0,l.Rn)();return}i=!0;let o=await u(r),c=null==o?void 0:null===(a=o.data)||void 0===a?void 0:a.refreshToken;if(c){for((0,l.pC)({accessToken:c.accessToken,refreshToken:c.refreshToken}),i=!1;s.length;){let e=s.shift();null==e||e.resolve(d(e.url,e.init))}return d(e,t)}i=!1,s.length=0,(0,l.Rn)()}}function c(e){var t;let r=new Headers(null==e?void 0:e.headers);return r.append("authorization","Bearer ".concat(null===(t=(0,l.bW)())||void 0===t?void 0:t.accessToken)),{...e||{},headers:r}}async function u(e){let t=a.L.createRequestOperation("mutation",(0,n.h)(l.Dp,{refreshToken:e}));return a.L.executeMutation(t)}function d(e,t){return fetch(e,c(t)).then(e=>(null==t?void 0:t.format)==="text"?e.text():e.json())}}},function(e){e.O(0,[9081,713,6630,8090,7820,4168,2971,7864,1744],function(){return e(e.s=51848)}),_N_E=e.O()}]);