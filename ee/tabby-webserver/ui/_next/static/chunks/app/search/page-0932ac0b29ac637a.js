(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2797],{72845:function(e,t,n){Promise.resolve().then(n.bind(n,37148))},37148:function(e,t,n){"use strict";n.r(t),n.d(t,{SOURCE_CARD_STYLE:function(){return ew},Search:function(){return eS},SearchContext:function(){return eN}});var l=n(36164),s=n(3546),r=n(70652),a=n.n(r),o=n(11978),i=n(54767),c=n(1853),d=n(82030),u=n(72940),m=n(52807),h=n(51722),x=n(19108),f=n(56575),v=n(2578),p=n(40055),g=n(21808),j=n(93877),N=n(43240),w=n(18500),b=n(28312),I=n(9010),S=n(24449),y=n(16784),C=n(98454),k=n(31159),R=n(44645),E=n(80605),_=n(64566),M=n(47241),L=n(37266),z=n(11634),T=n(70410),A=n(1544),F=n(31458),O=n(81565),P=n(53538),U=n(57830),D=n(11208),Z=n(72657),G=n(68172),V=n(30601),Q=n(24203),H=n(63743),$=n(52569),q=n(7449),X=n(84381),J=n(62226),W=n.n(J),K=n(6797),B=n.n(K),Y=n(94909),ee=n(66686),et=n(5493),en=n(23455),el=n(23782),es=n(74038),er=n(98150),ea=n(3448),eo=n(29),ei=n(90168),ec=n(48537),ed=n(10279);function eu(e){var t,n,r,a;let{message:o,showRelatedQuestion:i,isLoading:d,isLastAssistantMessage:u,isDeletable:m,className:h}=e,{onRegenerateResponse:x,onSubmitSearch:f,setDevPanelOpen:v,setConversationIdForDev:p,enableDeveloperMode:g,contextInfo:j,fetchingContextInfo:N,onDeleteMessage:w,isThreadOwner:b,onUpdateMessage:I}=(0,s.useContext)(eN),[S,y]=(0,s.useState)(!1),[C,k]=(0,s.useState)(!1),[R,E]=(0,s.useState)(void 0),_=d?O.IconSpinner:O.IconSparkles,M=null==o?void 0:null===(t=o.attachment)||void 0===t?void 0:t.doc,L=null==o?void 0:null===(n=o.attachment)||void 0===n?void 0:n.code,z=(null==M?void 0:M.length)?Math.ceil(M.length/4)*ew.expand+.5*Math.floor(M.length/4)+.5:0,T=(0,s.useMemo)(()=>{var e,t,n;return null!==(n=null==o?void 0:null===(t=o.attachment)||void 0===t?void 0:null===(e=t.code)||void 0===e?void 0:e.map(e=>{var t;let{startLine:n,endLine:l}=(0,A.OV)(e);return{kind:"file",range:{start:n,end:l},filepath:e.filepath,content:e.content,git_url:e.gitUrl,extra:{scores:null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.scores}}}))&&void 0!==n?n:[]},[null==o?void 0:null===(r=o.attachment)||void 0===r?void 0:r.code]),P=e=>{let{startLine:t,endLine:n}=(0,A.OV)(e);if(!e.filepath)return;let l=new URL("".concat(window.location.origin,"/files")),s=new URLSearchParams;s.append("redirect_filepath",e.filepath),s.append("redirect_git_url",e.gitUrl),l.search=s.toString();let r=(0,A.nO)({start:t,end:n});r&&(l.hash=r),window.open(l.toString())},U=async e=>{let t=await I(e);if(t)return t;y(!1)};return(0,l.jsxs)("div",{className:(0,A.cn)("flex flex-col gap-y-5",h),children:[M&&M.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-1 flex items-center gap-x-2",children:[(0,l.jsx)(O.IconBlocks,{className:"relative",style:{top:"-0.04rem"}}),(0,l.jsx)("p",{className:"text-sm font-bold leading-normal",children:"Sources"})]}),(0,l.jsx)("div",{className:"gap-sm -mx-2 grid grid-cols-3 gap-2 overflow-y-hidden px-2 pt-2 md:grid-cols-4",style:{transition:"height 0.25s ease-out",height:C?"".concat(z,"rem"):"".concat(ew.compress+.5,"rem")},children:M.map((e,t)=>(0,l.jsx)(em,{conversationId:o.id,source:e,showMore:C,showDevTooltip:g},e.link+t))}),(0,l.jsxs)(F.z,{variant:"ghost",className:"-ml-1.5 mt-1 flex items-center gap-x-1 px-1 py-2 text-sm font-normal text-muted-foreground",onClick:()=>k(!C),children:[(0,l.jsx)(O.IconChevronRight,{className:(0,A.cn)({"-rotate-90":C,"rotate-90":!C})}),(0,l.jsx)("p",{children:C?"Show less":"Show more"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-1 flex h-8 items-center gap-x-1.5",children:[(0,l.jsx)(_,{className:(0,A.cn)({"animate-spinner":d})}),(0,l.jsx)("p",{className:"text-sm font-bold leading-none",children:"Answer"}),g&&(0,l.jsx)(F.z,{variant:"ghost",size:"icon",onClick:()=>{p(o.id),v(!0)},children:(0,l.jsx)(O.IconBug,{})})]}),L&&L.length>0&&(0,l.jsx)(ei.q,{contexts:T,className:"mt-1 text-sm",onContextClick:e=>{if(!e.filepath)return;let t=new URL("".concat(window.location.origin,"/files")),n=new URLSearchParams;n.append("redirect_filepath",e.filepath),n.append("redirect_git_url",e.git_url),t.search=n.toString();let l=(0,A.nO)({start:e.range.start,end:e.range.end});l&&(t.hash=l),window.open(t.toString())},enableTooltip:g,showExternalLink:!1,onTooltipClick:()=>{p(o.id),v(!0)},highlightIndex:R}),d&&!o.content&&(0,l.jsx)(ea.O,{className:"mt-1 h-40 w-full"}),S?(0,l.jsx)(eh,{message:o,onCancel:()=>y(!1),onSubmit:U}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ed.JG,{message:o.content,attachmentDocs:M,attachmentCode:L,onCodeCitationClick:e=>{P(e)},onCodeCitationMouseEnter:e=>{var t,n;E(e-1-((null==o?void 0:null===(n=o.attachment)||void 0===n?void 0:null===(t=n.doc)||void 0===t?void 0:t.length)||0))},onCodeCitationMouseLeave:e=>{E(void 0)},contextInfo:j,fetchingContextInfo:N,canWrapLongLines:!d}),o.error&&(0,l.jsx)(ed.mE,{error:o.error}),!d&&!S&&(0,l.jsxs)("div",{className:"mt-3 flex items-center justify-between text-sm",children:[(0,l.jsx)("div",{className:"flex items-center gap-x-3",children:b&&(0,l.jsxs)(l.Fragment,{children:[!d&&!N&&u&&(0,l.jsxs)(F.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>x(o.id),children:[(0,l.jsx)(O.IconRefresh,{}),(0,l.jsx)("p",{children:"Regenerate"})]}),m&&(0,l.jsxs)(F.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>w(o.id),children:[(0,l.jsx)(O.IconTrash,{}),(0,l.jsx)("p",{children:"Delete"})]})]})}),(0,l.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,l.jsx)(ec.q,{className:"-ml-1.5 gap-x-1 px-1 font-normal text-muted-foreground",value:(e=>{var t,n,l,s,r,a,o,i,d,u,m;if((0,Y.Z)(null==e?void 0:null===(t=e.attachment)||void 0===t?void 0:t.doc)&&(0,Y.Z)(null==e?void 0:null===(n=e.attachment)||void 0===n?void 0:n.code))return e.content;let h=e.content.replace(es.H,e=>{let t=null==e?void 0:e.match(/\d+/);return"[".concat(t,"]")}).trim(),x=null!==(d=null===(s=e.attachment)||void 0===s?void 0:null===(l=s.doc)||void 0===l?void 0:l.map((e,t)=>"[".concat(t+1,"] ").concat(e.link)).join("\n"))&&void 0!==d?d:"",f=null!==(u=null===(a=e.attachment)||void 0===a?void 0:null===(r=a.doc)||void 0===r?void 0:r.length)&&void 0!==u?u:0,v=null!==(m=null===(i=e.attachment)||void 0===i?void 0:null===(o=i.code)||void 0===o?void 0:o.map((e,t)=>{let n=(0,A.tf)(e),l=(0,c.Z)([e.filepath,n]).join(":");return"[".concat(t+f+1,"] ").concat(l)}).join("\n"))&&void 0!==m?m:"";return"".concat(h,"\n\nCitations:\n").concat(x+v)})(o),text:"Copy"}),b&&(0,l.jsxs)(F.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:e=>y(!0),children:[(0,l.jsx)(O.IconEdit,{}),(0,l.jsx)("p",{children:"Edit"})]})]})]})]})]}),i&&!S&&!d&&o.threadRelevantQuestions&&o.threadRelevantQuestions.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-1.5",children:[(0,l.jsx)(O.IconLayers,{}),(0,l.jsx)("p",{className:"text-sm font-bold leading-none",children:"Suggestions"})]}),(0,l.jsx)("div",{className:"mt-2 flex flex-col gap-y-3",children:null===(a=o.threadRelevantQuestions)||void 0===a?void 0:a.map((e,t)=>(0,l.jsxs)("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-4 py-3 transition-opacity hover:opacity-70",onClick:f.bind(null,e),children:[(0,l.jsx)("p",{className:"w-full overflow-hidden text-ellipsis text-sm",children:e}),(0,l.jsx)(O.IconPlus,{})]},t))})]})]})}function em(e){var t,n;let{conversationId:r,source:a,showMore:o,showDevTooltip:i,isDeletable:c,onDelete:d}=e,{setDevPanelOpen:u,setConversationIdForDev:m}=(0,s.useContext)(eN),{hostname:h}=new URL(a.link),[x,f]=(0,s.useState)(!1);return(0,l.jsxs)(eo.u,{open:x,onOpenChange:e=>{i&&f(e)},delayDuration:0,children:[(0,l.jsx)(eo.aJ,{asChild:!0,children:(0,l.jsxs)("div",{className:"relative flex cursor-pointer flex-col justify-between rounded-lg border bg-card p-3 hover:bg-card/60",style:{height:o?"".concat(ew.expand,"rem"):"".concat(ew.compress,"rem"),transition:"all 0.25s ease-out"},onClick:()=>window.open(a.link),children:[c&&(0,l.jsx)("div",{className:"absolute -right-1.5 -top-2",children:(0,l.jsx)(F.z,{size:"icon",variant:"secondary",className:"h-4 w-4 rounded-full border",onClick:e=>{e.stopPropagation(),null==d||d()},children:(0,l.jsx)(O.IconRemove,{className:"h-3 w-3"})})}),(0,l.jsxs)("div",{className:"flex flex-1 flex-col justify-between gap-y-1",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,l.jsx)("p",{className:"line-clamp-1 w-full overflow-hidden text-ellipsis break-all text-xs font-semibold",children:a.title}),(0,l.jsx)("p",{className:(0,A.cn)(" w-full overflow-hidden text-ellipsis break-all text-xs text-muted-foreground",{"line-clamp-2":o,"line-clamp-1":!o}),children:ex(a.content)})]}),(0,l.jsx)("div",{className:"flex items-center text-xs text-muted-foreground",children:(0,l.jsxs)("div",{className:"flex w-full flex-1 items-center",children:[(0,l.jsx)(ed.V$,{hostname:h}),(0,l.jsx)("p",{className:"ml-1 overflow-hidden text-ellipsis",children:h.replace("www.","").split("/")[0]})]})})]})]})}),(0,l.jsx)(eo._v,{align:"start",className:"cursor-pointer p-2",onClick:e=>{e.stopPropagation(),m(r),u(!0)},children:(0,l.jsxs)("p",{children:["Score: ",null!==(n=null==a?void 0:null===(t=a.extra)||void 0===t?void 0:t.score)&&void 0!==n?n:"-"]})})]})}function eh(e){let{message:t,onCancel:n,onSubmit:r}=e,a=el.Ry({content:el.Z_().trim()}),o=(0,et.cI)({resolver:(0,X.F)(a),defaultValues:{content:t.content}}),{isSubmitting:i}=o.formState,[c]=(0,s.useState)(t),d=async e=>{let t=await r({...c,content:e.content});t&&(0,z.zG)(o)(t)};return(0,l.jsx)(er.l0,{...o,children:(0,l.jsxs)("form",{onSubmit:o.handleSubmit(d),children:[(0,l.jsx)(er.Wi,{control:o.control,name:"content",render:e=>{let{field:t}=e;return(0,l.jsxs)(er.xJ,{children:[(0,l.jsx)(er.NI,{children:(0,l.jsx)(en.Z,{autoFocus:!0,minRows:2,maxRows:20,className:"w-full rounded-lg border bg-background p-4 outline-ring",...t})}),(0,l.jsx)(er.zG,{})]})}}),(0,l.jsxs)("div",{className:"my-4 flex items-center justify-between gap-2 px-2",children:[(0,l.jsx)("div",{children:(0,l.jsx)(er.zG,{})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(F.z,{type:"button",variant:"outline",onClick:n,className:"min-w-[2rem]",children:"Cancel"}),(0,l.jsxs)(F.z,{type:"submit",disabled:i,children:[i&&(0,l.jsx)(O.IconSpinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})]})})}let ex=e=>{let t=W().sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}),n=ee.TU.parse(t),l=B().decode(n),s=l.replace(/<\/?[^>]+(>|$)/g,"");return s};var ef=n(90379);let ev=(0,s.lazy)(()=>n.e(726).then(n.t.bind(n,80726,23))),ep=e=>{let{value:t,isFullScreen:n,onToggleFullScreen:r,onClose:a}=e,[o]=(0,j.m)(),{theme:i}=(0,I.X)(),c=(0,s.useRef)(null);return((0,s.useEffect)(()=>{if(t){var e;null===(e=c.current)||void 0===e||e.scrollTo({top:0,behavior:"smooth"})}},[t]),(null==o?void 0:o.value)&&open)?(0,l.jsxs)("div",{className:"flex h-full flex-col px-3 pt-2",children:[(0,l.jsx)("div",{className:"flex items-center justify-end pb-2",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(F.z,{variant:"ghost",size:"icon",onClick:e=>r(!n),children:(0,l.jsx)(O.IconChevronDown,{className:(0,A.cn)("transition-all",n?"":"rotate-180")})}),(0,l.jsx)(F.z,{variant:"ghost",size:"icon",onClick:a,children:(0,l.jsx)(O.IconClose,{})})]})}),(0,l.jsx)(s.Suspense,{fallback:(0,l.jsx)(ef.cg,{className:"p-2"}),children:t?(0,l.jsx)(U.ScrollArea,{className:"flex-1",ref:c,children:(0,l.jsx)(ev,{theme:"dark"===i?"tomorrow":"rjv-default",src:t,style:{fontSize:"0.75rem"},collapseStringsAfterLength:120})}):null})]}):null};function eg(){return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(ea.O,{className:"w-full"}),(0,l.jsx)(ea.O,{className:"w-[70%]"})]}),(0,l.jsx)(ea.O,{className:"h-40 w-full"})]})}function ej(e){let{message:t,className:n,...r}=e,{contextInfo:a,fetchingContextInfo:o}=(0,s.useContext)(eN);return(0,l.jsx)("div",{className:(0,A.cn)("font-semibold",n),...r,children:(0,l.jsx)(ed.JG,{message:t.content,contextInfo:a,fetchingContextInfo:o,className:"text-xl prose-p:mb-2 prose-p:mt-0",headline:!0,canWrapLongLines:!0})})}let eN=(0,s.createContext)({}),ew={compress:5.3,expand:6.3},eb="_temp_msg_",eI=()=>"".concat(eb).concat((0,f.x0)());function eS(){var e,t,n,r,a;let[{data:m}]=(0,C.P)(),{updateUrlComponents:f,pathname:N}=(0,R.Z)(),[G,H]=(0,s.useState)(),[$,q]=(0,s.useState)(!1),X=(0,E.xG)(),[J,W]=(0,s.useState)([]),[K,B]=(0,s.useState)(!0),[Y,ee]=(0,s.useState)(!1),[et,en]=(0,s.useState)(""),[el,es]=(0,s.useState)(""),er=(0,s.useRef)(null),[ea,eo]=(0,s.useState)(!1),[ei]=(0,V.Hb)(),ec=(0,o.useRouter)(),ed=(0,s.useRef)(!1),{theme:em}=(0,I.X)(),[eh,ex]=(0,s.useState)(!1),[ef,ev]=(0,s.useState)(),ew=(0,s.useRef)(null),[eS,e_]=(0,s.useState)(45),eM=(0,s.useRef)(eS),[eL]=(0,j.m)(),[ez,eT]=(0,s.useState)(),eA=(0,s.useMemo)(()=>{var e,t;if(G)return null===(t=G.match(/^\/search\/(.*)/))||void 0===t?void 0:null===(e=t[1])||void 0===e?void 0:e.split("-").pop()},[G]),eF=(0,z.Db)(eC),eO=async e=>{let t=J.findIndex(t=>t.id===e.id);if(!(t>-1)||!ez)return Error("Failed to save");{var n;let l=await eF({input:{threadId:ez,id:e.id,content:e.content}});if(null==l||null===(n=l.data)||void 0===n||!n.updateThreadMessage)return(null==l?void 0:l.error)||Error("Failed to save");await W(n=>{let l=[...n];return l[t]=e,l})}};(0,s.useEffect)(()=>{eA&&eT(eA)},[eA]);let[{data:eP,fetching:eU}]=(0,p.aM)({query:T.Gx}),[eD,eZ]=(0,s.useState)(),[{data:eG,fetching:eV,error:eQ}]=(0,p.aM)({query:T.XL,variables:{ids:[ez]},pause:!ez}),[{data:eH,error:e$,fetching:eq,stale:eX}]=(0,p.aM)({query:T.r4,variables:{threadId:ez,first:30,after:eD},pause:!ez||Y});(0,s.useEffect)(()=>{var e,t,n,l;if(!eX){if(null==eH?void 0:null===(t=eH.threadMessages)||void 0===t?void 0:null===(e=t.edges)||void 0===e?void 0:e.length){let e=eH.threadMessages.edges.map(e=>e.node).slice();W(t=>{var n;return(n=[...t,...e]).length?(0,x.Z)(n,(0,h.Z)("id",2)):[]})}if(null==eH?void 0:eH.threadMessages){let e=null==eH?void 0:null===(l=eH.threadMessages)||void 0===l?void 0:null===(n=l.pageInfo)||void 0===n?void 0:n.hasNextPage,t=null==eH?void 0:eH.threadMessages.pageInfo.endCursor;e&&t?eZ(t):ee(!0)}}},[eH]);let eJ=(0,s.useMemo)(()=>{var e,t;return!ez||!!m&&null!=eG&&null!==(t=eG.threads)&&void 0!==t&&null!==(e=t.edges)&&void 0!==e&&!!e.length&&m.me.id===eG.threads.edges[0].node.userId},[m,eG,ez]),eW=null==eP?void 0:eP.contextInfo.sources,eK=null==J?void 0:null===(e=J[0])||void 0===e?void 0:e.content,eB=(0,s.useMemo)(()=>eW&&eK?(0,A.i8)(eW,eK,{maxLength:g.$I}):"",[eW,eK]);(0,s.useEffect)(()=>{eB&&(document.title=eB)},[eB]),(0,s.useEffect)(()=>{e$&&!Y&&ee(!0)},[e$]);let{sendUserMessage:eY,isLoading:e0,error:e1,answer:e4,stop:e2,regenerate:e5,deleteThreadMessagePair:e3}=(0,_.x)({threadId:ez}),e6=(0,y.d)(e0),{selectedModel:e8,isModelLoading:e7,models:e9}=(0,k.Vq)(),te=(0,s.useMemo)(()=>J.find(e=>e.id===ef),[ef,J]),tt=(0,s.useMemo)(()=>te?(0,d.Z)(null==te?void 0:te.attachment,"doc","code"):{answers:J.filter(e=>e.role===w.uU.Assistant).map(e=>(0,d.Z)(e,"doc","code"))},[ef,null==te?void 0:null===(t=te.attachment)||void 0===t?void 0:t.code,null==te?void 0:null===(n=te.attachment)||void 0===n?void 0:n.doc]);(0,s.useEffect)(()=>{H(N),$||q(!0)},[N]),(0,s.useEffect)(()=>{$&&!eA&&(()=>{if(ed.current)return;ed.current=!0;let e=sessionStorage.getItem(g.$6.SEARCH_INITIAL_MSG),t=sessionStorage.getItem(g.$6.SEARCH_INITIAL_CONTEXTS),n=t?JSON.parse(t):void 0;if(e){sessionStorage.removeItem(g.$6.SEARCH_INITIAL_MSG),sessionStorage.removeItem(g.$6.SEARCH_INITIAL_CONTEXTS),ee(!0),tr(e,n);return}ez||((0,L.wh)(),ec.replace("/"))})()},[$]),(0,s.useEffect)(()=>{Y&&setTimeout(()=>{eo(!0)},300)},[Y]);let{isCopied:tn,onCopy:tl}=function(e){let{threadIdFromURL:t,threadIdFromStreaming:n,streamingDone:l,updateThreadURL:s}=e,{isCopied:r,copyToClipboard:a}=(0,b.m)({timeout:2e3}),o=(0,z.Db)(ey,{onError(e){v.A.error(e.message)}}),i=!t&&l&&n&&s,c=async()=>{if(r)return;let e=window.location.href;i&&(await o({threadId:n}),e=s(n)),a(e)};return{onCopy:c,isCopied:r}}({threadIdFromURL:eA,threadIdFromStreaming:ez,streamingDone:!e0,updateThreadURL:e=>{let t=(0,i.Z)(eB),n=(0,c.Z)([t,e]).join("-"),l=f({pathname:"/search/".concat(n),searchParams:{del:["q"]},replace:!0});return location.origin+l}});(0,s.useEffect)(()=>{var e,t,n,l;e4.threadId&&e4.threadId!==ez&&eT(e4.threadId);let s=[...J],r=s.findIndex(e=>e.id===et),a=s.findIndex(e=>e.id===el);if(-1===r||-1===a)return;let o=s[r],i=s[a];i.content=e4.content,(null===(e=i.attachment)||void 0===e?void 0:e.code)||!e4.attachmentsCode||(i.attachment={doc:(null===(n=i.attachment)||void 0===n?void 0:n.doc)||null,code:e4.attachmentsCode.map(e=>({...e.code,extra:{scores:e.scores}}))||null}),(null===(t=i.attachment)||void 0===t?void 0:t.doc)||!e4.attachmentsDoc||(i.attachment={doc:e4.attachmentsDoc.map(e=>({...e.doc,extra:{score:e.score}}))||null,code:(null===(l=i.attachment)||void 0===l?void 0:l.code)||null}),i.threadRelevantQuestions=null==e4?void 0:e4.relevantQuestions;let c=e4.userMessageId,d=e4.assistantMessageId;c&&d&&c!==o.id&&d!==i.id&&(o.id=c,i.id=d,en(c),es(d)),W(s)},[e0,e4]),(0,s.useEffect)(()=>{if(e1){let e=[...J],t=e.find(e=>e.id===el);t&&(t.error=e1?"401"===e1.message?"Unauthorized":(0,u.Z)(e1.graphQLErrors,e=>{var t;return(null===(t=e.extensions)||void 0===t?void 0:t.code)===g.ir})?"The thread has expired":e1.message||"Failed to fetch":"Failed to fetch")}},[e1]);let ts=(0,s.useRef)();(0,s.useEffect)(()=>(e6.current&&(ts.current=window.setTimeout(()=>{if(!e6.current)return;B(!0);let e=null==er?void 0:er.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},300)),e6.current||B(!1),()=>{window.clearTimeout(ts.current)}),[e0]),(0,s.useEffect)(()=>{var e,t,n;eh?(null===(e=ew.current)||void 0===e||e.expand(),null===(t=ew.current)||void 0===t||t.resize(eS)):null===(n=ew.current)||void 0===n||n.collapse()},[eh]);let tr=(e,t)=>{let n=eI(),l=eI(),s={id:n,role:w.uU.User,content:e},r={id:l,role:w.uU.Assistant,content:""},{sourceIdForCodeQuery:a,sourceIdsForDocQuery:o,searchPublic:i}=eE(t),c=a?{sourceId:a,content:e}:null;en(n),es(l),W([...J].concat([s,r])),eY({content:e},{generateRelevantQuestions:!0,codeQuery:c,docQuery:{sourceIds:o,content:e,searchPublic:!!i},modelName:null==t?void 0:t.modelName})},ta=(0,s.useMemo)(()=>{var e,t;if(Y&&!eV&&eA&&(eQ||!(null==eG?void 0:null===(t=eG.threads)||void 0===t?void 0:null===(e=t.edges)||void 0===e?void 0:e.length)))return eQ||Error(g.ir)},[eG,eV,eQ,Y,eA]),[to]=(0,S.n)(eq||(null==eH?void 0:null===(a=eH.threadMessages)||void 0===a?void 0:null===(r=a.pageInfo)||void 0===r?void 0:r.hasNextPage),200);if(Y&&(e$||ta))return(0,l.jsx)(eR,{});if(!Y&&(to||eX))return(0,l.jsxs)("div",{children:[(0,l.jsx)(ek,{}),(0,l.jsxs)("div",{className:"mx-auto mt-24 w-full space-y-10 px-4 pb-32 lg:max-w-4xl lg:px-0",children:[(0,l.jsx)(eg,{}),(0,l.jsx)(eg,{})]})]});if(!X||!Y)return(0,l.jsx)(l.Fragment,{});let ti=ei?{height:"calc(100vh - ".concat(V.wt,")")}:{height:"100vh"};return(0,l.jsx)(eN.Provider,{value:{isLoading:e0,onRegenerateResponse:()=>{var e;if(!ez||eU)return;let t=J.length-1,n=t-1;if(-1===t||n<=-1)return;let l=J[n].id,s=J[t].id,r=J.slice(0,-2),a=J[n],o={...a,id:eI()},i={id:eI(),role:w.uU.Assistant,content:"",attachment:{code:null,doc:null},error:void 0},c=(0,A.b)(o.content,null==eP?void 0:null===(e=eP.contextInfo)||void 0===e?void 0:e.sources),{sourceIdForCodeQuery:d,sourceIdsForDocQuery:u,searchPublic:m}=eE((0,A.G8)(c)),h=d?{sourceId:d,content:o.content}:null,x={sourceIds:u,content:o.content,searchPublic:m};en(o.id),es(i.id),W([...r,o,i]),e5({threadId:ez,userMessageId:l,assistantMessageId:s,userMessage:{content:o.content},threadRunOptions:{generateRelevantQuestions:!0,codeQuery:h,docQuery:x,modelName:e8}})},onSubmitSearch:tr,setDevPanelOpen:ex,setConversationIdForDev:ev,isPathnameInitialized:$,enableDeveloperMode:eL.value,contextInfo:null==eP?void 0:eP.contextInfo,fetchingContextInfo:eU,onDeleteMessage:e=>{if(!ez)return;let t=J.findIndex(t=>t.id===e),n=t-1,l=J[t-1];if(-1!==t&&(null==l?void 0:l.role)===w.uU.User){if(l.id.startsWith(eb)&&e.startsWith(eb)){let e=J.slice(0,n).concat(J.slice(t+1));W(e);return}e3(ez,l.id,e).then(e=>{if(e){v.A.error(e);return}let l=J.slice(0,n).concat(J.slice(t+1));W(l)})}},isThreadOwner:eJ,onUpdateMessage:eO},children:(0,l.jsx)("div",{className:"transition-all",style:ti,children:(0,l.jsxs)(P.pO,{direction:"vertical",onLayout:e=>{(null==e?void 0:e[1])&&e_(e[1])},children:[(0,l.jsxs)(P.ee,{children:[(0,l.jsx)(ek,{threadIdFromURL:eA,streamingDone:e4.completed}),(0,l.jsxs)("main",{className:"h-[calc(100%-4rem)] pb-8 lg:pb-0",children:[(0,l.jsx)(U.ScrollArea,{className:"h-full",ref:er,children:(0,l.jsx)("div",{className:"mx-auto px-4 pb-32 lg:max-w-4xl lg:px-0",children:(0,l.jsx)("div",{className:"flex flex-col",children:J.map((e,t)=>{let n=t===J.length-1;return e.role===w.uU.User?(0,l.jsx)(ej,{className:"pb-2 pt-8",message:e},e.id):e.role===w.uU.Assistant?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eu,{className:"pb-8 pt-2",message:e,isLoading:e0&&n,isLastAssistantMessage:n,showRelatedQuestion:n,isDeletable:!e0&&J.length>2},e.id),!n&&(0,l.jsx)(D.Z,{})]}):null})})})}),(0,l.jsx)(Z.K,{className:(0,A.cn)("!fixed !bottom-[5.4rem] !right-4 !top-auto z-40 border-muted-foreground lg:!bottom-[2.85rem]",{hidden:eh}),container:er.current,offset:100,style:"dark"===em?{"--background":"0 0% 12%"}:{}}),(0,l.jsxs)("div",{className:(0,A.cn)("fixed bottom-5 left-0 z-30 flex min-h-[3rem] w-full flex-col items-center gap-y-2",{"opacity-100 translate-y-0":ea,"opacity-0 translate-y-10":!ea,hidden:eh}),style:Object.assign({transition:"all 0.35s ease-out"},"dark"===em?{"--background":"0 0% 12%"}:{}),children:[(0,l.jsxs)("div",{className:(0,A.cn)("absolute flex items-center gap-4"),style:eJ?{top:"-2.5rem"}:void 0,children:[K&&(0,l.jsxs)(F.z,{className:"bg-background",variant:"outline",onClick:()=>e2(),children:[(0,l.jsx)(O.IconStop,{className:"mr-2"}),"Stop generating"]}),!K&&(0,l.jsxs)(F.z,{className:"bg-background",variant:"outline",onClick:tl,children:[tn?(0,l.jsx)(O.IconCheck,{className:"mr-2 text-green-600"}):(0,l.jsx)(O.IconShare,{className:"mr-2"}),"Share Link"]})]}),eJ&&(0,l.jsx)("div",{className:(0,A.cn)("relative z-20 flex justify-center self-stretch px-4"),children:(0,l.jsx)(Q.Z,{onSearch:tr,className:"min-h-[5rem] lg:max-w-4xl",placeholder:"Ask a follow up question",isFollowup:!0,isLoading:e0,contextInfo:null==eP?void 0:eP.contextInfo,fetchingContextInfo:eU,modelName:e8,onModelSelect:e=>{(0,M.Eg)(e)},isModelLoading:e7,models:e9})})]})]})]}),(0,l.jsx)(P.Dp,{className:(0,A.cn)("hidden !h-[4px] border-none bg-background shadow-[0px_-4px_4px_rgba(0,0,0,0.2)] hover:bg-blue-500 active:bg-blue-500 dark:shadow-[0px_-4px_4px_rgba(255,255,255,0.2)]",eh&&"block")}),(0,l.jsx)(P.ee,{collapsible:!0,collapsedSize:0,defaultSize:0,ref:ew,onCollapse:()=>ex(!1),className:"z-50",children:(0,l.jsx)(ep,{onClose:()=>ex(!1),value:tt,isFullScreen:100===eS,onToggleFullScreen:e=>{var t;let n=eM.current;e?n=100:100===n&&(n=45),null===(t=ew.current)||void 0===t||t.resize(n),e_(n),eM.current=eS}})})]})})})}let ey=(0,N.BX)("\n  mutation SetThreadPersisted($threadId: ID!) {\n    setThreadPersisted(threadId: $threadId)\n  }\n"),eC=(0,N.BX)("\n  mutation UpdateThreadMessage($input: UpdateMessageInput!) {\n    updateThreadMessage(input: $input)\n  }\n");function ek(e){let{threadIdFromURL:t,streamingDone:n}=e,s=(0,o.useRouter)(),r=e=>{e&&(0,L.wh)(),s.push("/")};return(0,l.jsxs)("header",{className:"flex h-16 items-center justify-between px-4 lg:px-10",children:[(0,l.jsx)("div",{className:"flex items-center gap-x-6",children:(0,l.jsxs)(F.z,{variant:"ghost",className:"-ml-1 pl-0 text-sm text-muted-foreground",onClick:()=>r(),children:[(0,l.jsx)(O.IconChevronLeft,{className:"mr-1 h-5 w-5"}),"Home"]})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(n||t)&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(F.z,{variant:"ghost",className:"flex items-center gap-1 px-2 font-normal text-muted-foreground",onClick:()=>r(!0),children:(0,l.jsx)(O.IconPlus,{})})}),(0,l.jsx)(G.q,{children:(0,l.jsx)(H.T,{className:"mr-4"})}),(0,l.jsx)(q.Z,{showHome:!1,showSetting:!0,beforeRouteChange:()=>{(0,L.wh)()},children:(0,l.jsx)($.SQ,{className:"h-10 w-10 border"})})]})]})}function eR(){return(0,l.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,l.jsx)(ek,{}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(O.IconFileSearch,{className:"h-6 w-6"}),(0,l.jsx)("div",{className:"text-xl font-semibold",children:"Something went wrong"})]}),(0,l.jsx)("div",{children:"Failed to fetch the thread, please refresh the page or start a new thread"}),(0,l.jsxs)(a(),{href:"/",onClick:L.wh,className:(0,A.cn)((0,F.d)(),"mt-4 gap-2"),children:[(0,l.jsx)(O.IconPlus,{}),(0,l.jsx)("span",{children:"New Thread"})]})]})})]})}function eE(e){let t,n=[],l=!1;if(e){var s,r,a,o;n=(0,m.Z)((0,c.Z)([null==e?void 0:null===(s=e.codeSourceIds)||void 0===s?void 0:s[0]].concat(e.docSourceIds))),l=null!==(a=e.searchPublic)&&void 0!==a&&a,t=null!==(o=null===(r=e.codeSourceIds)||void 0===r?void 0:r[0])&&void 0!==o?o:void 0}return{sourceIdsForDocQuery:n,sourceIdForCodeQuery:t,searchPublic:l}}},98150:function(e,t,n){"use strict";n.d(t,{NI:function(){return v},Wi:function(){return u},l0:function(){return c},lX:function(){return f},pf:function(){return p},xJ:function(){return x},zG:function(){return g}});var l=n(36164),s=n(3546),r=n(74047),a=n(5493),o=n(1544),i=n(5266);let c=a.RV,d=s.createContext({}),u=e=>{let{...t}=e;return(0,l.jsx)(d.Provider,{value:{name:t.name},children:(0,l.jsx)(a.Qr,{...t})})},m=()=>{let e=s.useContext(d),t=s.useContext(h),{getFieldState:n,formState:l}=(0,a.Gc)(),r=e.name||"root",o=n(r,l);if(!l)throw Error("useFormField should be used within <Form>");let{id:i}=t;return{id:i,name:r,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...o}},h=s.createContext({}),x=s.forwardRef((e,t)=>{let{className:n,...r}=e,a=s.useId();return(0,l.jsx)(h.Provider,{value:{id:a},children:(0,l.jsx)("div",{ref:t,className:(0,o.cn)("space-y-2",n),...r})})});x.displayName="FormItem";let f=s.forwardRef((e,t)=>{let{className:n,required:s,...r}=e,{error:a,formItemId:c}=m();return(0,l.jsx)(i._,{ref:t,className:(0,o.cn)(a&&"text-destructive",s&&'after:ml-0.5 after:text-destructive after:content-["*"]',n),htmlFor:c,...r})});f.displayName="FormLabel";let v=s.forwardRef((e,t)=>{let{...n}=e,{error:s,formItemId:a,formDescriptionId:o,formMessageId:i}=m();return(0,l.jsx)(r.g7,{ref:t,id:a,"aria-describedby":s?"".concat(o," ").concat(i):"".concat(o),"aria-invalid":!!s,...n})});v.displayName="FormControl";let p=s.forwardRef((e,t)=>{let{className:n,...s}=e,{formDescriptionId:r}=m();return(0,l.jsx)("div",{ref:t,id:r,className:(0,o.cn)("text-sm text-muted-foreground",n),...s})});p.displayName="FormDescription";let g=s.forwardRef((e,t)=>{let{className:n,children:s,...r}=e,{error:a,formMessageId:i}=m(),c=a?String(null==a?void 0:a.message):s;return c?(0,l.jsx)("p",{ref:t,id:i,className:(0,o.cn)("text-sm font-medium text-destructive",n),...r,children:c}):null});g.displayName="FormMessage"},53538:function(e,t,n){"use strict";n.d(t,{Dp:function(){return i},ee:function(){return o},pO:function(){return a}});var l=n(36164),s=n(6618),r=n(1544);let a=e=>{let{className:t,...n}=e;return(0,l.jsx)(s.eh,{className:(0,r.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...n})},o=s.s_,i=e=>{let{withHandle:t,className:n,...a}=e;return(0,l.jsx)(s.OT,{className:(0,r.cn)("border-bg relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",n),...a,children:t&&(0,l.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border"})})}},93877:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var l=n(3546);let s=(e,t)=>{let[n,s]=(0,l.useState)(t),[r,a]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let t=localStorage.getItem(e);t&&s(JSON.parse(t)),a(!1)},[]),[n,t=>{s(t),localStorage.setItem(e,JSON.stringify(t))},r]};class r{get value(){if("undefined"!=typeof localStorage){let e=localStorage.getItem(this.storageKey);if(e)return"true"===e}return this.defaultValue}constructor(e,t,n,l){this.storageKey=e,this.title=t,this.description=n,this.defaultValue=l}}let a=new class{defineGlobalVar(){return new r(this.storageKey,this.title,this.description,this.defaultValue)}defineHook(){return()=>{let[e,t,n]=s(this.storageKey,this.defaultValue);return[{value:e,title:this.title,description:this.description,loading:n},()=>{t(!e)}]}}constructor(e,t,n,l){this.storageKey="EXP_".concat(e),this.title=t,this.description=n,this.defaultValue=null!=l&&l}}("enable_developer_mode","Developer Mode","Enable the developer mode. The features involved include the Answer Engine.",!1);a.defineGlobalVar();let o=a.defineHook()},44645:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var l=n(3546),s=n(11978);function r(){let e=(0,s.usePathname)(),t=(0,s.useRouter)(),n=(0,s.useSearchParams)(),r=(0,l.useCallback)(e=>{let t=new URLSearchParams(n);e&&Object.entries(e).forEach(e=>{let[n,l]=e;return t.set(n,l)});let l=t.toString();return l.length>0?"?".concat(l):""},[n]),a=(0,l.useCallback)(l=>{let s=function(e,t,n){var l,s;let r=null===(l=n.searchParams)||void 0===l?void 0:l.set,a=null===(s=n.searchParams)||void 0===s?void 0:s.del,o=new URLSearchParams(t);r&&Object.entries(r).forEach(e=>{let[t,n]=e;return o.set(t,n)}),a&&(Array.isArray(a)?a.forEach(e=>o.delete(e)):o.delete(a));let i=o.toString(),c=e;return i.length>0&&(c+="?".concat(i)),n.hash&&(c+="#".concat(n.hash.replace(/^#/,""))),c}((null==l?void 0:l.pathname)||e,n,l);return l.replace?t.replace(s):t.push(s),s},[e,n]);return{pathname:e,router:t,searchParams:n,getQueryString:r,updateUrlComponents:a}}},82030:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var l=n(94219),s=n(79204),r=(0,n(43285).Z)(function(e,t){return null==e?{}:(0,l.Z)(e,t,function(t,n){return(0,s.Z)(e,n)})})}},function(e){e.O(0,[8415,3078,753,1386,55,2904,4007,9643,5006,6345,2578,8511,240,4421,1454,1722,4546,9275,4553,9148,1658,1266,5376,446,1112,6898,7045,1544,1565,3821,7188,9826,3375,5289,1744],function(){return e(e.s=72845)}),_N_E=e.O()}]);