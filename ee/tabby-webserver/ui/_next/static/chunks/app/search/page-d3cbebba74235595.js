(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2797],{67802:function(e,t,n){Promise.resolve().then(n.bind(n,32166))},32166:function(e,t,n){"use strict";n.r(t),n.d(t,{SOURCE_CARD_STYLE:function(){return eM},Search:function(){return eT},SearchContext:function(){return eR}});var r=n(36164),s=n(3546),l=n(70652),a=n.n(l),o=n(11978),i=n(54767),d=n(1853),c=n(82030),u=n(72940),m=n(52807),h=n(12978),x=n(56575),f=n(2578),p=n(40055),v=n(21808),g=n(93877),j=n(43240),b=n(18500),N=n(28312),w=n(9010),y=n(24449),C=n(16784),I=n(98454),S=n(31159),k=n(44645),A=n(80605),R=n(64566),M=n(47241),E=n(37266),_=n(11634),T=n(70410),L=n(57288),z=n(31458),D=n(81565),O=n(53538),P=n(57830),F=n(11208),U=n(29),Z=n(72657),H=n(30601),V=n(69579),q=n(24203),G=n(84381),W=n(62226),K=n.n(W),$=n(6797),B=n.n($),Q=n(94909),J=n(66686),Y=n(5493),X=n(23455),ee=n(23782),et=n(74038),en=n(98150),er=n(90615),es=n(3448),el=n(50445),ea=n(90168),eo=n(48537),ei=n(54646),ed=n(64219),ec=n(89811),eu=n(52569);function em(e){var t,n,l,a,o,i,c,u,m;let{className:h,message:x,showRelatedQuestion:f,isLoading:p,isLastAssistantMessage:v,isDeletable:g,clientCode:j}=e,{onRegenerateResponse:b,onSubmitSearch:N,setDevPanelOpen:w,setConversationIdForDev:y,enableDeveloperMode:C,contextInfo:I,fetchingContextInfo:S,onDeleteMessage:k,isThreadOwner:A,onUpdateMessage:R}=(0,s.useContext)(eR),{supportsOnApplyInEditorV2:M,onNavigateToContext:E}=(0,s.useContext)(el.p),[_,T]=(0,s.useState)(!1),[O,P]=(0,s.useState)(!1),[F,U]=(0,s.useState)(void 0),Z=p?D.IconSpinner:D.IconSparkles,H=(null==x?void 0:null===(l=x.attachment)||void 0===l?void 0:null===(n=l.code)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.gitUrl)||"",V=(0,s.useMemo)(()=>{var e;return(null==j?void 0:j.length)&&null!==(e=j.map(e=>{let{startLine:t,endLine:n}=(0,L.OV)(e);return{kind:"file",range:{start:t,end:n},filepath:e.filepath||"",content:e.content,git_url:H}}))&&void 0!==e?e:[]},[j,H]),q=(0,s.useMemo)(()=>{var e,t,n;return null!==(n=null==x?void 0:null===(t=x.attachment)||void 0===t?void 0:null===(e=t.code)||void 0===e?void 0:e.map(e=>{var t;let{startLine:n,endLine:r}=(0,L.OV)(e);return{kind:"file",range:{start:n,end:r},filepath:e.filepath,content:e.content,git_url:e.gitUrl,extra:{scores:null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.scores}}}))&&void 0!==n?n:[]},[j,null==x?void 0:null===(a=x.attachment)||void 0===a?void 0:a.code]),G=(0,s.useMemo)(()=>null==j?void 0:j.map(e=>({...e,gitUrl:H})),[j,H]),W=null==x?void 0:null===(o=x.attachment)||void 0===o?void 0:o.doc,K=((null==G?void 0:G.length)||0)+((null===(c=x.attachment)||void 0===c?void 0:null===(i=c.code)||void 0===i?void 0:i.length)||0),$=(null==W?void 0:W.length)?Math.ceil(W.length/4)*eM.expand+.5*Math.floor(W.length/4)+.5:0,B=e=>{let{startLine:t,endLine:n}=(0,L.OV)(e);if(!e.filepath)return;let r=new URL("".concat(window.location.origin,"/files")),s=new URLSearchParams;s.append("redirect_filepath",e.filepath),s.append("redirect_git_url",e.gitUrl),r.search=s.toString();let l=(0,L.nO)({start:t,end:n});l&&(r.hash=l),window.open(r.toString())},J=async e=>{let t=await R(e);if(t)return t;T(!1)};return(0,r.jsxs)("div",{className:(0,L.cn)("flex flex-col gap-y-5",h),children:[W&&W.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-1 flex items-center gap-x-2",children:[(0,r.jsx)(D.IconBlocks,{className:"relative",style:{top:"-0.04rem"}}),(0,r.jsx)("p",{className:"text-sm font-bold leading-normal",children:"Sources"})]}),(0,r.jsx)("div",{className:"gap-sm -mx-2 grid grid-cols-3 gap-2 overflow-y-hidden px-2 pt-2 md:grid-cols-4",style:{transition:"height 0.25s ease-out",height:O?"".concat($,"rem"):"".concat(eM.compress+.5,"rem")},children:W.map((e,t)=>(0,r.jsx)(eh,{conversationId:x.id,source:e,showMore:O,showDevTooltip:C},e.link+t))}),(0,r.jsxs)(z.z,{variant:"ghost",className:"-ml-1.5 mt-1 flex items-center gap-x-1 px-1 py-2 text-sm font-normal text-muted-foreground",onClick:()=>P(!O),children:[(0,r.jsx)(D.IconChevronRight,{className:(0,L.cn)({"-rotate-90":O,"rotate-90":!O})}),(0,r.jsx)("p",{children:O?"Show less":"Show more"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-1 flex h-8 items-center gap-x-1.5",children:[(0,r.jsx)(Z,{className:(0,L.cn)({"animate-spinner":p})}),(0,r.jsx)("p",{className:"text-sm font-bold leading-none",children:"Answer"}),C&&(0,r.jsx)(z.z,{variant:"ghost",size:"icon",onClick:()=>{y(x.id),w(!0)},children:(0,r.jsx)(D.IconBug,{})})]}),K>0&&(0,r.jsx)(ea.q,{clientContexts:V,contexts:q,className:"mt-1 text-sm",onContextClick:e=>{if(!e.filepath)return;let t=new URL("".concat(window.location.origin,"/files")),n=new URLSearchParams;n.append("redirect_filepath",e.filepath),n.append("redirect_git_url",e.git_url),t.search=n.toString();let r=(0,L.nO)({start:e.range.start,end:e.range.end});r&&(t.hash=r),window.open(t.toString())},enableTooltip:C,showExternalLink:!1,showClientCodeIcon:!0,onTooltipClick:()=>{y(x.id),w(!0)},highlightIndex:F}),p&&!x.content&&(0,r.jsx)(es.O,{className:"mt-1 h-40 w-full"}),_?(0,r.jsx)(ef,{message:x,onCancel:()=>T(!1),onSubmit:J}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ei.J,{message:x.content,attachmentDocs:W,attachmentClientCode:G,attachmentCode:null===(u=x.attachment)||void 0===u?void 0:u.code,onCodeCitationClick:e=>{e.gitUrl&&B(e)},onCodeCitationMouseEnter:e=>{var t,n;U(e-1-((null==x?void 0:null===(n=x.attachment)||void 0===n?void 0:null===(t=n.doc)||void 0===t?void 0:t.length)||0))},onCodeCitationMouseLeave:e=>{U(void 0)},contextInfo:I,fetchingContextInfo:S,canWrapLongLines:!p,supportsOnApplyInEditorV2:M}),x.error&&(0,r.jsx)(ei.m,{error:x.error}),!p&&!_&&(0,r.jsxs)("div",{className:"mt-3 flex items-center justify-between text-sm",children:[(0,r.jsx)("div",{className:"flex items-center gap-x-3",children:A&&(0,r.jsxs)(r.Fragment,{children:[!p&&!S&&v&&(0,r.jsxs)(z.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>b(x.id),children:[(0,r.jsx)(D.IconRefresh,{}),(0,r.jsx)("p",{children:"Regenerate"})]}),g&&(0,r.jsxs)(z.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>k(x.id),children:[(0,r.jsx)(D.IconTrash,{}),(0,r.jsx)("p",{children:"Delete"})]})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-x-3",children:[(0,r.jsx)(eo.q,{className:"-ml-1.5 gap-x-1 px-1 font-normal text-muted-foreground",value:(e=>{var t,n,r,s,l,a,o,i,c,u,m;if((0,Q.Z)(null==e?void 0:null===(t=e.attachment)||void 0===t?void 0:t.doc)&&(0,Q.Z)(null==e?void 0:null===(n=e.attachment)||void 0===n?void 0:n.code))return e.content;let h=e.content.replace(et.H,e=>{let t=null==e?void 0:e.match(/\d+/);return"[".concat(t,"]")}).trim(),x=null!==(c=null===(s=e.attachment)||void 0===s?void 0:null===(r=s.doc)||void 0===r?void 0:r.map((e,t)=>"[".concat(t+1,"] ").concat(e.link)).join("\n"))&&void 0!==c?c:"",f=null!==(u=null===(a=e.attachment)||void 0===a?void 0:null===(l=a.doc)||void 0===l?void 0:l.length)&&void 0!==u?u:0,p=null!==(m=null===(i=e.attachment)||void 0===i?void 0:null===(o=i.code)||void 0===o?void 0:o.map((e,t)=>{let n=(0,L.tf)(e),r=(0,d.Z)([e.filepath,n]).join(":");return"[".concat(t+f+1,"] ").concat(r)}).join("\n"))&&void 0!==m?m:"";return"".concat(h,"\n\nCitations:\n").concat(x+p)})(x),text:"Copy"}),A&&(0,r.jsxs)(z.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:e=>T(!0),children:[(0,r.jsx)(D.IconEdit,{}),(0,r.jsx)("p",{children:"Edit"})]})]})]})]})]}),f&&!_&&!p&&x.threadRelevantQuestions&&x.threadRelevantQuestions.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-1.5",children:[(0,r.jsx)(D.IconLayers,{}),(0,r.jsx)("p",{className:"text-sm font-bold leading-none",children:"Suggestions"})]}),(0,r.jsx)("div",{className:"mt-2 flex flex-col gap-y-3",children:null===(m=x.threadRelevantQuestions)||void 0===m?void 0:m.map((e,t)=>(0,r.jsxs)("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-4 py-3 transition-opacity hover:opacity-70",onClick:N.bind(null,e),children:[(0,r.jsx)("p",{className:"w-full overflow-hidden text-ellipsis text-sm",children:e}),(0,r.jsx)(D.IconPlus,{})]},t))})]})]})}function eh(e){var t,n;let{conversationId:l,source:a,showMore:o,showDevTooltip:i}=e,{setDevPanelOpen:d,setConversationIdForDev:c}=(0,s.useContext)(eR),[u,m]=(0,s.useState)(!1);return(0,r.jsxs)(er.zs,{openDelay:100,closeDelay:100,children:[(0,r.jsxs)(U.u,{open:u,onOpenChange:e=>{i&&m(e)},delayDuration:0,children:[(0,r.jsx)(er.Yi,{asChild:!0,children:(0,r.jsx)(U.aJ,{asChild:!0,children:(0,r.jsx)("div",{className:"relative flex cursor-pointer flex-col justify-between rounded-lg border bg-card p-3 hover:bg-card/60",style:{height:o?"".concat(eM.expand,"rem"):"".concat(eM.compress,"rem"),transition:"all 0.25s ease-out"},onClick:()=>window.open(a.link),children:(0,r.jsx)(ex,{source:a,showMore:o})})})}),(0,r.jsx)(U._v,{align:"start",className:"cursor-pointer p-2",onClick:e=>{e.stopPropagation(),c(l),d(!0)},children:(0,r.jsxs)("p",{children:["Score: ",null!==(n=null==a?void 0:null===(t=a.extra)||void 0===t?void 0:t.score)&&void 0!==n?n:"-"]})})]}),(0,r.jsx)(er.bZ,{className:"w-96 bg-background text-sm text-foreground dark:border-muted-foreground/60",children:(0,r.jsx)(ed.Z,{relevantDocument:a})})]})}function ex(e){let{source:t,showMore:n}=e,{hostname:s}=new URL(t.link),l="MessageAttachmentIssueDoc"===t.__typename,a="MessageAttachmentPullDoc"===t.__typename,o="MessageAttachmentWebDoc"===t.__typename?void 0:t.author,i=(l||a)&&!!o;return(0,r.jsxs)("div",{className:"flex flex-1 flex-col justify-between gap-y-1",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,r.jsx)("p",{className:"line-clamp-1 w-full overflow-hidden text-ellipsis break-all text-xs font-semibold",children:t.title}),i&&(0,r.jsxs)("div",{className:"flex items-center gap-1 overflow-x-hidden",children:[(0,r.jsx)(eu.Yt,{user:o,className:"h-3.5 w-3.5 shrink-0"}),(0,r.jsx)("p",{className:"truncate text-xs font-medium text-muted-foreground",children:null==o?void 0:o.name})]}),(!i||n)&&(0,r.jsx)("p",{className:(0,L.cn)(" w-full overflow-hidden text-ellipsis break-all text-xs text-muted-foreground",!i&&n?"line-clamp-2":"line-clamp-1"),children:ep((0,L.L5)(t))})]}),(0,r.jsx)("div",{className:"flex items-center text-xs text-muted-foreground",children:(0,r.jsxs)("div",{className:"flex w-full flex-1 items-center justify-between gap-1",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(ec.V,{hostname:s}),(0,r.jsx)("p",{className:"ml-1 truncate",children:s.replace("www.","").split("/")[0]})]}),(0,r.jsxs)("div",{className:"flex shrink-0 items-center gap-1",children:[l&&(0,r.jsxs)(r.Fragment,{children:[t.closed?(0,r.jsx)(D.IconCheckCircled,{className:"h-3.5 w-3.5"}):(0,r.jsx)(D.IconCircleDot,{className:"h-3.5 w-3.5"}),(0,r.jsx)("span",{children:t.closed?"Closed":"Open"})]}),a&&(0,r.jsxs)(r.Fragment,{children:[t.merged?(0,r.jsx)(D.IconGitMerge,{className:"h-3.5 w-3.5"}):(0,r.jsx)(D.IconGitPullRequest,{className:"h-3.5 w-3.5"}),t.merged?"Merged":"Open"]})]})]})})]})}function ef(e){let{message:t,onCancel:n,onSubmit:l}=e,a=ee.Ry({content:ee.Z_().trim()}),o=(0,Y.cI)({resolver:(0,G.F)(a),defaultValues:{content:t.content}}),{isSubmitting:i}=o.formState,[d]=(0,s.useState)(t),c=async e=>{let t=await l({...d,content:e.content});t&&(0,_.zG)(o)(t)};return(0,r.jsx)(en.l0,{...o,children:(0,r.jsxs)("form",{onSubmit:o.handleSubmit(c),children:[(0,r.jsx)(en.Wi,{control:o.control,name:"content",render:e=>{let{field:t}=e;return(0,r.jsxs)(en.xJ,{children:[(0,r.jsx)(en.NI,{children:(0,r.jsx)(X.Z,{autoFocus:!0,minRows:2,maxRows:20,className:"w-full rounded-lg border bg-background p-4 outline-ring",...t})}),(0,r.jsx)(en.zG,{})]})}}),(0,r.jsxs)("div",{className:"my-4 flex items-center justify-between gap-2 px-2",children:[(0,r.jsx)("div",{children:(0,r.jsx)(en.zG,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(z.z,{type:"button",variant:"outline",onClick:n,className:"min-w-[2rem]",children:"Cancel"}),(0,r.jsxs)(z.z,{type:"submit",disabled:i,children:[i&&(0,r.jsx)(D.IconSpinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})]})})}let ep=e=>{let t=K().sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}),n=J.TU.parse(t),r=B().decode(n),s=r.replace(/<\/?[^>]+(>|$)/g,"");return s};var ev=n(90379);let eg=(0,s.lazy)(()=>n.e(726).then(n.t.bind(n,80726,23))),ej=e=>{let{value:t,isFullScreen:n,onToggleFullScreen:l,onClose:a}=e,[o]=(0,g.m)(),{theme:i}=(0,w.X)(),d=(0,s.useRef)(null);return((0,s.useEffect)(()=>{if(t){var e;null===(e=d.current)||void 0===e||e.scrollTo({top:0,behavior:"smooth"})}},[t]),(null==o?void 0:o.value)&&open)?(0,r.jsxs)("div",{className:"flex h-full flex-col px-3 pt-2",children:[(0,r.jsx)("div",{className:"flex items-center justify-end pb-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(z.z,{variant:"ghost",size:"icon",onClick:e=>l(!n),children:(0,r.jsx)(D.IconChevronDown,{className:(0,L.cn)("transition-all",n?"":"rotate-180")})}),(0,r.jsx)(z.z,{variant:"ghost",size:"icon",onClick:a,children:(0,r.jsx)(D.IconClose,{})})]})}),(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)(ev.cg,{className:"p-2"}),children:t?(0,r.jsx)(P.ScrollArea,{className:"flex-1",ref:d,children:(0,r.jsx)(eg,{theme:"dark"===i?"tomorrow":"rjv-default",src:t,style:{fontSize:"0.75rem"},collapseStringsAfterLength:120})}):null})]}):null};var eb=n(73460),eN=n(68172),ew=n(61249),ey=n(63743),eC=n(7449);let eI=(0,j.BX)("\n  mutation DeleteThread($id: ID!) {\n    deleteThread(id: $id)\n  }\n");function eS(e){let{threadIdFromURL:t,streamingDone:n}=e,l=(0,o.useRouter)(),{isThreadOwner:a}=(0,s.useContext)(eR),[i,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(!1),m=(0,_.Db)(eI,{onCompleted(e){e.deleteThread?l.replace("/"):(f.A.error("Failed to delete"),u(!1))},onError(e){f.A.error((null==e?void 0:e.message)||"Failed to delete"),u(!1)}}),h=e=>{e&&(0,E.wh)(),l.push("/")};return(0,r.jsxs)("header",{className:"flex h-16 items-center justify-between px-4 lg:px-10",children:[(0,r.jsx)("div",{className:"flex items-center gap-x-6",children:(0,r.jsxs)(z.z,{variant:"ghost",className:"-ml-1 pl-0 text-sm text-muted-foreground",onClick:()=>h(),children:[(0,r.jsx)(D.IconChevronLeft,{className:"mr-1 h-5 w-5"}),"Home"]})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[n&&t&&(0,r.jsx)(z.z,{variant:"ghost",className:"flex items-center gap-1 px-2 font-normal text-muted-foreground",onClick:()=>h(!0),children:(0,r.jsx)(D.IconPlus,{})}),n&&t&&a&&(0,r.jsxs)(eb.aR,{open:i,onOpenChange:d,children:[(0,r.jsx)(eb.vW,{asChild:!0,children:(0,r.jsx)(z.z,{size:"icon",variant:"hover-destructive",children:(0,r.jsx)(D.IconTrash,{})})}),(0,r.jsxs)(eb._T,{children:[(0,r.jsxs)(eb.fY,{children:[(0,r.jsx)(eb.f$,{children:"Delete this thread"}),(0,r.jsx)(eb.yT,{children:"Are you sure you want to delete this thread? This operation is not revertible."})]}),(0,r.jsxs)(eb.xo,{children:[(0,r.jsx)(eb.le,{children:"Cancel"}),(0,r.jsxs)(eb.OL,{className:(0,z.d)({variant:"destructive"}),onClick:e=>{e.preventDefault(),u(!0),m({id:t})},children:[c&&(0,r.jsx)(D.IconSpinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Yes, delete it"]})]})]})]}),(0,r.jsx)(eN.q,{children:(0,r.jsx)(ey.T,{})}),(0,r.jsx)(ew.L,{className:"mr-4"}),(0,r.jsx)(eC.Z,{showHome:!1,showSetting:!0,beforeRouteChange:()=>{(0,E.wh)()},children:(0,r.jsx)(eu.SQ,{className:"h-10 w-10 border"})})]})]})}function ek(){return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(es.O,{className:"w-full"}),(0,r.jsx)(es.O,{className:"w-[70%]"})]}),(0,r.jsx)(es.O,{className:"h-40 w-full"})]})}function eA(e){let{message:t,className:n,...l}=e,{contextInfo:a,fetchingContextInfo:o}=(0,s.useContext)(eR),{supportsOnApplyInEditorV2:i}=(0,s.useContext)(el.p);return(0,r.jsx)("div",{className:(0,L.cn)("font-semibold",n),...l,children:(0,r.jsx)(ei.J,{message:t.content,contextInfo:a,supportsOnApplyInEditorV2:i,fetchingContextInfo:o,className:"text-xl prose-p:mb-2 prose-p:mt-0",headline:!0,canWrapLongLines:!0})})}let eR=(0,s.createContext)({}),eM={compress:5.3,expand:6.3},eE="_temp_msg_",e_=()=>"".concat(eE).concat((0,x.x0)());function eT(){var e,t,n,l,a;let[{data:m}]=(0,I.P)(),{updateUrlComponents:x,pathname:j}=(0,k.Z)(),[V,G]=(0,s.useState)(),[W,K]=(0,s.useState)(!1),$=(0,A.xG)(),[B,Q]=(0,s.useState)([]),[J,Y]=(0,s.useState)(!0),[X,ee]=(0,s.useState)(!1),[et,en]=(0,s.useState)(""),[er,es]=(0,s.useState)(""),el=(0,s.useRef)(null),[ea,eo]=(0,s.useState)(!1),[ei]=(0,H.Hb)(),ed=(0,o.useRouter)(),ec=(0,s.useRef)(!1),{theme:eu}=(0,w.X)(),[eh,ex]=(0,s.useState)(!1),[ef,ep]=(0,s.useState)(),ev=(0,s.useRef)(null),[eg,eb]=(0,s.useState)(45),eN=(0,s.useRef)(eg),[ew]=(0,g.m)(),[ey,eC]=(0,s.useState)(),eI=(0,s.useMemo)(()=>{var e,t;if(V)return null===(t=V.match(/^\/search\/(.*)/))||void 0===t?void 0:null===(e=t[1])||void 0===e?void 0:e.split("-").pop()},[V]),eM=(0,_.Db)(eL),eT=async e=>{let t=B.findIndex(t=>t.id===e.id);if(!(t>-1)||!ey)return Error("Failed to save");{var n;let r=await eM({input:{threadId:ey,id:e.id,content:e.content}});if(null==r||null===(n=r.data)||void 0===n||!n.updateThreadMessage)return(null==r?void 0:r.error)||Error("Failed to save");await Q(n=>{let r=[...n];return r[t]=e,r})}};(0,s.useEffect)(()=>{eI&&eC(eI)},[eI]);let[{data:eO,fetching:eP}]=(0,p.aM)({query:T.Gx}),[eF,eU]=(0,s.useState)(),[{data:eZ,fetching:eH,error:eV}]=(0,p.aM)({query:T.XL,variables:{ids:[ey]},pause:!ey}),[{data:eq,error:eG,fetching:eW,stale:eK}]=(0,p.aM)({query:T.r4,variables:{threadId:ey,first:30,after:eF},pause:!ey||X});(0,s.useEffect)(()=>{var e,t,n,r;if(!eK){if(null==eq?void 0:null===(t=eq.threadMessages)||void 0===t?void 0:null===(e=t.edges)||void 0===e?void 0:e.length){let e=eq.threadMessages.edges.map(e=>e.node).slice();Q(t=>(0,h.Z)([...t,...e],"id"))}if(null==eq?void 0:eq.threadMessages){let e=null==eq?void 0:null===(r=eq.threadMessages)||void 0===r?void 0:null===(n=r.pageInfo)||void 0===n?void 0:n.hasNextPage,t=null==eq?void 0:eq.threadMessages.pageInfo.endCursor;e&&t?eU(t):ee(!0)}}},[eq]);let e$=(0,s.useMemo)(()=>{if(!m)return!1;if(!eI)return!0;let e=null==eZ?void 0:eZ.threads.edges[0];return!!e&&m.me.id===e.node.userId},[m,eZ,eI]),eB=null==eO?void 0:eO.contextInfo.sources,eQ=null==B?void 0:null===(e=B[0])||void 0===e?void 0:e.content,eJ=(0,s.useMemo)(()=>eB&&eQ?(0,L.i8)(eB,eQ,{maxLength:v.$I}):"",[eB,eQ]);(0,s.useEffect)(()=>{eJ&&(document.title=eJ)},[eJ]),(0,s.useEffect)(()=>{eG&&!X&&ee(!0)},[eG]);let{sendUserMessage:eY,isLoading:eX,error:e0,answer:e1,stop:e5,regenerate:e2,deleteThreadMessagePair:e4}=(0,R.x)({threadId:ey}),e6=(0,C.d)(eX),{selectedModel:e3,isModelLoading:e8,models:e7}=(0,S.Vq)(),e9=(0,s.useMemo)(()=>B.find(e=>e.id===ef),[ef,B]),te=(0,s.useMemo)(()=>e9?(0,c.Z)(null==e9?void 0:e9.attachment,"doc","code"):{answers:B.filter(e=>e.role===b.uU.Assistant).map(e=>(0,c.Z)(e,"doc","code"))},[ef,null==e9?void 0:null===(t=e9.attachment)||void 0===t?void 0:t.code,null==e9?void 0:null===(n=e9.attachment)||void 0===n?void 0:n.doc]);(0,s.useEffect)(()=>{G(j),W||K(!0)},[j]),(0,s.useEffect)(()=>{W&&!eI&&(()=>{if(ec.current)return;ec.current=!0;let e=sessionStorage.getItem(v.$6.SEARCH_INITIAL_MSG),t=sessionStorage.getItem(v.$6.SEARCH_INITIAL_CONTEXTS),n=t?JSON.parse(t):void 0;if(e){sessionStorage.removeItem(v.$6.SEARCH_INITIAL_MSG),sessionStorage.removeItem(v.$6.SEARCH_INITIAL_CONTEXTS),ee(!0),tl(e,n);return}ey||((0,E.wh)(),ed.replace("/"))})()},[W]),(0,s.useEffect)(()=>{X&&setTimeout(()=>{eo(!0)},300)},[X]);let tt=(0,s.useMemo)(()=>!eI&&(0,u.Z)(B,e=>!!e.error),[eI,B]),{isCopied:tn,onShare:tr}=function(e){let{threadIdFromURL:t,threadIdFromStreaming:n,streamingDone:r,updateThreadURL:s}=e,{isCopied:l,copyToClipboard:a}=(0,N.m)({timeout:2e3}),o=(0,_.Db)(T.md,{onError(e){f.A.error(e.message)}}),i=!t&&r&&n&&s,d=async()=>{if(l)return;let e=window.location.href;i&&(await o({threadId:n}),e=s(n)),a(e)};return{onShare:d,isCopied:l}}({threadIdFromURL:eI,threadIdFromStreaming:ey,streamingDone:!eX,updateThreadURL:e=>{let t=(0,i.Z)(eJ),n=(0,d.Z)([t,e]).join("-"),r=x({pathname:"/search/".concat(n),searchParams:{del:["q"]},replace:!0});return location.origin+r}});(0,s.useEffect)(()=>{var e,t,n,r;e1.threadId&&e1.threadId!==ey&&eC(e1.threadId);let s=[...B],l=s.findIndex(e=>e.id===et),a=s.findIndex(e=>e.id===er);if(-1===l||-1===a)return;let o=s[l],i=s[a];i.content=e1.content,(null===(e=i.attachment)||void 0===e?void 0:e.code)||!e1.attachmentsCode||(i.attachment={clientCode:null,doc:(null===(n=i.attachment)||void 0===n?void 0:n.doc)||null,code:e1.attachmentsCode.map(e=>({...e.code,extra:{scores:e.scores}}))||null}),(null===(t=i.attachment)||void 0===t?void 0:t.doc)||!e1.attachmentsDoc||(i.attachment={clientCode:null,doc:e1.attachmentsDoc.map(e=>({...e.doc,extra:{score:e.score}}))||null,code:(null===(r=i.attachment)||void 0===r?void 0:r.code)||null}),i.threadRelevantQuestions=null==e1?void 0:e1.relevantQuestions;let d=e1.userMessageId,c=e1.assistantMessageId;d&&c&&d!==o.id&&c!==i.id&&(o.id=d,i.id=c,en(d),es(c)),Q(s)},[eX,e1]),(0,s.useEffect)(()=>{if(e0){let e=[...B],t=e.find(e=>e.id===er);t&&(t.error=e0?"401"===e0.message?"Unauthorized":(0,u.Z)(e0.graphQLErrors,e=>{var t;return(null===(t=e.extensions)||void 0===t?void 0:t.code)===v.ir})?"The thread has expired or does not exist.":e0.message||"Failed to fetch":"Failed to fetch")}},[e0]);let ts=(0,s.useRef)();(0,s.useEffect)(()=>(e6.current&&(ts.current=window.setTimeout(()=>{if(!e6.current)return;Y(!0);let e=null==el?void 0:el.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},300)),e6.current||Y(!1),()=>{window.clearTimeout(ts.current)}),[eX]),(0,s.useEffect)(()=>{var e,t,n;eh?(null===(e=ev.current)||void 0===e||e.expand(),null===(t=ev.current)||void 0===t||t.resize(eg)):null===(n=ev.current)||void 0===n||n.collapse()},[eh]);let tl=(e,t)=>{let n=e_(),r=e_(),s={id:n,role:b.uU.User,content:e},l={id:r,role:b.uU.Assistant,content:""},{sourceIdForCodeQuery:a,sourceIdsForDocQuery:o,searchPublic:i}=eD(t),d=a?{sourceId:a,content:e}:null;en(n),es(r),Q([...B].concat([s,l])),eY({content:e},{generateRelevantQuestions:!0,codeQuery:d,docQuery:{sourceIds:o,content:e,searchPublic:!!i},modelName:null==t?void 0:t.modelName})},ta=(0,s.useMemo)(()=>{var e,t;if(X&&!eH&&eI&&(eV||!(null==eZ?void 0:null===(t=eZ.threads)||void 0===t?void 0:null===(e=t.edges)||void 0===e?void 0:e.length)))return eV||Error(v.ir)},[eZ,eH,eV,X,eI]),[to]=(0,y.n)(eW||(null==eq?void 0:null===(a=eq.threadMessages)||void 0===a?void 0:null===(l=a.pageInfo)||void 0===l?void 0:l.hasNextPage),200),ti=(0,s.useMemo)(()=>{let e=[],t={question:null,answer:null};return B.forEach(n=>{n.role===b.uU.User?t.question=n:n.role!==b.uU.Assistant||t.answer||(t.answer=n,e.push(t),t={question:null,answer:null})}),e},[B]),td=ei?{height:"calc(100vh - ".concat(H.wt,")")}:{height:"100vh"};return X&&(ta||eG)?(0,r.jsx)(ez,{error:ta||eG,threadIdFromURL:eI}):!X&&(to||eK)?(0,r.jsxs)("div",{children:[(0,r.jsx)(eS,{}),(0,r.jsxs)("div",{className:"mx-auto mt-24 w-full space-y-10 px-4 pb-32 lg:max-w-4xl lg:px-0",children:[(0,r.jsx)(ek,{}),(0,r.jsx)(ek,{})]})]}):$&&X?(0,r.jsx)(eR.Provider,{value:{isLoading:eX,onRegenerateResponse:()=>{var e;if(!ey||eP)return;let t=B.length-1,n=t-1;if(-1===t||n<=-1)return;let r=B[n].id,s=B[t].id,l=B.slice(0,-2),a=B[n],o={...a,id:e_()},i={id:e_(),role:b.uU.Assistant,content:"",attachment:{code:null,doc:null,clientCode:null},error:void 0},d=(0,L.b)(o.content,null==eO?void 0:null===(e=eO.contextInfo)||void 0===e?void 0:e.sources),{sourceIdForCodeQuery:c,sourceIdsForDocQuery:u,searchPublic:m}=eD((0,L.G8)(d)),h=c?{sourceId:c,content:o.content}:null,x={sourceIds:u,content:o.content,searchPublic:m};en(o.id),es(i.id),Q([...l,o,i]),e2({threadId:ey,userMessageId:r,assistantMessageId:s,userMessage:{content:o.content},threadRunOptions:{generateRelevantQuestions:!0,codeQuery:h,docQuery:x,modelName:e3}})},onSubmitSearch:tl,setDevPanelOpen:ex,setConversationIdForDev:ep,isPathnameInitialized:W,enableDeveloperMode:ew.value,contextInfo:null==eO?void 0:eO.contextInfo,fetchingContextInfo:eP,onDeleteMessage:e=>{if(!ey)return;let t=B.findIndex(t=>t.id===e),n=t-1,r=B[t-1];if(-1!==t&&(null==r?void 0:r.role)===b.uU.User){if(r.id.startsWith(eE)&&e.startsWith(eE)){let e=B.slice(0,n).concat(B.slice(t+1));Q(e);return}e4(ey,r.id,e).then(e=>{if(e){f.A.error(e);return}let r=B.slice(0,n).concat(B.slice(t+1));Q(r)})}},isThreadOwner:e$,onUpdateMessage:eT},children:(0,r.jsx)("div",{className:"transition-all",style:td,children:(0,r.jsxs)(O.pO,{direction:"vertical",onLayout:e=>{(null==e?void 0:e[1])&&eb(e[1])},children:[(0,r.jsxs)(O.ee,{children:[(0,r.jsx)(eS,{threadIdFromURL:eI,streamingDone:!eX}),(0,r.jsxs)("main",{className:"h-[calc(100%-4rem)] pb-8 lg:pb-0",children:[(0,r.jsx)(P.ScrollArea,{className:"h-full",ref:el,children:(0,r.jsx)("div",{className:"mx-auto px-4 pb-32 lg:max-w-4xl lg:px-0",children:(0,r.jsx)("div",{className:"flex flex-col",children:ti.map((e,t)=>{var n,l;let a=t===ti.length-1;return e.question?(0,r.jsxs)(s.Fragment,{children:[!!e.question&&(0,r.jsx)(eA,{className:"pb-2 pt-8",message:e.question},e.question.id),!!e.answer&&(0,r.jsx)(em,{className:"pb-8 pt-2",message:e.answer,clientCode:null===(l=e.question)||void 0===l?void 0:null===(n=l.attachment)||void 0===n?void 0:n.clientCode,isLoading:eX&&a,isLastAssistantMessage:a,showRelatedQuestion:a,isDeletable:!eX&&B.length>2},e.answer.id),!a&&(0,r.jsx)(F.Z,{})]},e.question.id):null})})})}),(0,r.jsx)(Z.K,{className:(0,L.cn)("!fixed !bottom-[5.4rem] !right-4 !top-auto z-40 border-muted-foreground lg:!bottom-[2.85rem]",{hidden:eh}),container:el.current,offset:100,style:"dark"===eu?{"--background":"0 0% 12%"}:{}}),(0,r.jsxs)("div",{className:(0,L.cn)("fixed bottom-5 left-0 z-30 flex min-h-[3rem] w-full flex-col items-center gap-y-2",{"opacity-100 translate-y-0":ea,"opacity-0 translate-y-10":!ea,hidden:eh}),style:Object.assign({transition:"all 0.35s ease-out"},"dark"===eu?{"--background":"0 0% 12%"}:{}),children:[(0,r.jsxs)("div",{className:(0,L.cn)("absolute flex items-center gap-4"),style:e$?{top:"-2.5rem"}:void 0,children:[J&&(0,r.jsxs)(z.z,{className:"bg-background",variant:"outline",onClick:()=>e5(),children:[(0,r.jsx)(D.IconStop,{className:"mr-2"}),"Stop generating"]}),!J&&(0,r.jsxs)(U.u,{delayDuration:0,children:[(0,r.jsx)(U.aJ,{asChild:!0,children:(0,r.jsx)("span",{tabIndex:0,children:(0,r.jsxs)(z.z,{className:"gap-2 bg-background",variant:"outline",onClick:tr,disabled:tt,children:[tt?(0,r.jsx)(D.IconInfoCircled,{}):tn?(0,r.jsx)(D.IconCheck,{className:"text-green-600"}):(0,r.jsx)(D.IconShare,{}),"Share Link"]})})}),(0,r.jsx)(U._v,{hidden:!tt,children:"Please resolve errors in messages before sharing this thread."})]})]}),e$&&(0,r.jsx)("div",{className:(0,L.cn)("relative z-20 flex justify-center self-stretch px-4"),children:(0,r.jsx)(q.Z,{onSearch:tl,className:"min-h-[5rem] lg:max-w-4xl",placeholder:"Ask a follow up question",isFollowup:!0,isLoading:eX,contextInfo:null==eO?void 0:eO.contextInfo,fetchingContextInfo:eP,modelName:e3,onModelSelect:e=>{(0,M.Eg)(e)},isModelLoading:e8,models:e7})})]})]})]}),(0,r.jsx)(O.Dp,{className:(0,L.cn)("hidden !h-[4px] border-none bg-background shadow-[0px_-4px_4px_rgba(0,0,0,0.2)] hover:bg-blue-500 active:bg-blue-500 dark:shadow-[0px_-4px_4px_rgba(255,255,255,0.2)]",eh&&"block")}),(0,r.jsx)(O.ee,{collapsible:!0,collapsedSize:0,defaultSize:0,ref:ev,onCollapse:()=>ex(!1),className:"z-50",children:(0,r.jsx)(ej,{onClose:()=>ex(!1),value:te,isFullScreen:100===eg,onToggleFullScreen:e=>{var t;let n=eN.current;e?n=100:100===n&&(n=45),null===(t=ev.current)||void 0===t||t.resize(n),eb(n),eN.current=eg}})})]})})}):(0,r.jsx)(r.Fragment,{})}let eL=(0,j.BX)("\n  mutation UpdateThreadMessage($input: UpdateMessageInput!) {\n    updateThreadMessage(input: $input)\n  }\n");function ez(e){let{error:t,threadIdFromURL:n}=e;return t.message===v.ir?(0,r.jsx)(V.default,{}):(0,r.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,r.jsx)(eS,{threadIdFromURL:n}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(D.IconFileSearch,{className:"h-6 w-6"}),(0,r.jsx)("div",{className:"text-xl font-semibold",children:"Something went wrong"})]}),(0,r.jsx)("div",{children:"Failed to fetch the thread, please refresh the page or start a new thread"}),(0,r.jsxs)(a(),{href:"/",onClick:E.wh,className:(0,L.cn)((0,z.d)(),"mt-4 gap-2"),children:[(0,r.jsx)(D.IconPlus,{}),(0,r.jsx)("span",{children:"New Thread"})]})]})})]})}function eD(e){let t,n=[],r=!1;if(e){var s,l,a,o;n=(0,m.Z)((0,d.Z)([null==e?void 0:null===(s=e.codeSourceIds)||void 0===s?void 0:s[0]].concat(e.docSourceIds))),r=null!==(a=e.searchPublic)&&void 0!==a&&a,t=null!==(o=null===(l=e.codeSourceIds)||void 0===l?void 0:l[0])&&void 0!==o?o:void 0}return{sourceIdsForDocQuery:n,sourceIdForCodeQuery:t,searchPublic:r}}},69579:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var r=n(36164),s=n(42891),l=n.n(s),a=n(70652),o=n.n(a),i=n(83332),d=n(76531),c=n(57288),u=n(68172),m=n(30601),h=n(63743),x=n(31458),f=n(52569),p=n(7449);function v(){let[e]=(0,m.Hb)(),t=e?{height:"calc(100vh - ".concat(m.wt,")")}:{height:"100vh"};return(0,r.jsxs)("div",{style:t,className:"flex flex-col",children:[(0,r.jsx)(g,{}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col items-center justify-center",children:[(0,r.jsx)("h2",{className:"mt-4 text-6xl font-bold tracking-tight text-foreground sm:text-7xl",children:"404"}),(0,r.jsx)("p",{className:"mt-4 text-lg text-muted-foreground",children:"Oops, it looks like the page you're looking for doesn't exist."}),(0,r.jsx)(o(),{className:(0,c.cn)("mt-6",(0,x.d)()),href:"/",children:"Home"})]})]})}function g(){return(0,r.jsxs)("header",{className:"flex h-16 items-center justify-between border-b px-4 lg:px-10",children:[(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsxs)(o(),{href:"/",children:[(0,r.jsx)(l(),{src:d.Z,alt:"logo",width:128,className:"dark:hidden"}),(0,r.jsx)(l(),{src:i.Z,alt:"logo",width:96,className:"hidden dark:block"})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsx)(u.q,{children:(0,r.jsx)(h.T,{})}),(0,r.jsx)(p.Z,{showSetting:!0,children:(0,r.jsx)(f.SQ,{className:"h-10 w-10 border"})})]})]})}},24203:function(e,t,n){"use strict";n.d(t,{Z:function(){return U}});var r=n(36164),s=n(3546),l=n(21808),a=n(9010),o=n(57288),i=n(62202),d=n(29),c=n(6230);n(15812);var u=n(46836),m=n(75866),h=n(97216),x=n(48497),f=n(10155),p=n(31408),v=n(68035),g=n(16784),j=n(10345),b=n(83171);let N="mention",w=j.ZP.extend({addNodeView:()=>(0,v.fW)(b.t),renderText(e){let{node:t}=e;return"[[source:".concat(t.attrs.id,"]]")},addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}},kind:{default:null,parseHTML:e=>e.getAttribute("data-kind"),renderHTML:e=>e.kind?{"data-kind":e.kind}:{}}})});n(44750);var y=n(31022),C=n(45238),I=n(18500),S=n(81565);let k=(0,s.forwardRef)((e,t)=>{let{query:n,command:l,category:a}=e,{list:i,pending:d}=(0,s.useContext)(z),[c,u]=(0,s.useState)(0),m=(0,s.useMemo)(()=>{if(!(null==i?void 0:i.length))return[];let e=i.filter(e=>(0,o._q)(e.sourceKind)).map(e=>({type:"source",category:"doc",id:e.sourceId,label:e.sourceName,data:e})),t=i.filter(e=>(0,o.wO)(e.sourceKind)).map(e=>({type:"source",category:"code",id:e.sourceId,label:e.sourceName,data:e}));return"doc"===a?e:t},[a,i]),h=(0,s.useMemo)(()=>{if(!n)return m;let e=(0,C.go)(n,m,{key:e=>e.label});return e.map(e=>e.obj)},[n,m]),x=()=>{u((c+h.length-1)%h.length)},f=()=>{u((c+1)%h.length)},p=e=>{let t=h[e];t&&l({id:t.data.sourceId,label:t.label,kind:t.data.sourceKind})},v=()=>{p(c)};return(0,s.useEffect)(()=>u(0),[m]),(0,s.useImperativeHandle)(t,()=>({onKeyDown:e=>{let{event:t}=e;return"ArrowUp"===t.key?(x(),!0):"ArrowDown"===t.key?(f(),!0):"Enter"===t.key&&(v(),!0)}})),(0,r.jsx)("div",{className:"dropdown-menu max-h-[30vh] min-w-[20rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-2 text-popover-foreground shadow animate-in",children:d?(0,r.jsx)("div",{className:"px-2 py-1.5",children:(0,r.jsx)(S.IconSpinner,{})}):h.length?h.map((e,t)=>(0,r.jsx)(R,{onClick:()=>p(t),onMouseEnter:()=>u(t),title:e.label,data:e,isSelected:t===c},e.id)):(0,r.jsx)("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:(null==m?void 0:m.length)?(0,r.jsx)("span",{children:"No matches results"}):(0,r.jsx)("span",{children:"No results"})})})});function A(e){let{kind:t}=e;switch(t){case I.ri.Doc:return(0,r.jsx)(S.IconEmojiBook,{});case I.ri.Web:return(0,r.jsx)(S.IconEmojiGlobe,{});case I.ri.Git:return(0,r.jsx)(S.IconCode,{});case I.ri.Github:return(0,r.jsx)(S.IconGitHub,{});case I.ri.Gitlab:return(0,r.jsx)(S.IconGitLab,{});default:return null}}function R(e){let{isSelected:t,data:n,...l}=e,a=(0,s.useRef)(null);return(0,s.useLayoutEffect)(()=>{if(t&&a.current){var e;null===(e=a.current)||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}},[t]),(0,r.jsxs)("div",{className:(0,o.cn)("flex cursor-pointer gap-1 rounded-md px-2 py-1.5 text-sm",{"bg-accent text-accent-foreground":t}),...l,ref:a,children:[(0,r.jsx)("span",{className:"flex h-5 shrink-0 items-center",children:(0,r.jsx)(A,{kind:n.data.sourceKind})}),(0,r.jsx)("span",{className:"flex-1",children:n.label})]})}k.displayName="MetionList";let M=e=>{let t=e.getJSON(),n=[],r=0,s=e=>{var t,l;"text"===e.type?r+=(null==e?void 0:null===(t=e.text)||void 0===t?void 0:t.length)||0:"mention"===e.type&&(null==e?void 0:null===(l=e.attrs)||void 0===l?void 0:l.id)&&n.push({id:e.attrs.id,label:e.attrs.label,kind:e.attrs.kind}),e.content&&e.content.forEach(s)};return s(t),n};var E=e=>{let{disabled:t,category:n,placement:r,char:s="@",pluginKey:l}=e;return{render:()=>{let e,t;return{onStart:s=>{let l=M(s.editor);e=new v.M_(k,{props:{...s,mentions:l,category:n},editor:s.editor}),s.clientRect&&(t=(0,y.ZP)("body",{getReferenceClientRect:s.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:r||"bottom-start",animation:"shift-away",maxWidth:"400px"}))},onUpdate(n){e.updateProps(n),n.clientRect&&t[0].setProps({getReferenceClientRect:n.clientRect})},onKeyDown(n){var r,s;return"Escape"===n.event.key?(t[0].hide(),!0):null!==(s=null===(r=e.ref)||void 0===r?void 0:r.onKeyDown(n))&&void 0!==s&&s},onExit(){t[0].destroy(),e.destroy()}}},char:s,pluginKey:l,command:e=>{var t,r,s;let{editor:l,range:a,props:i}=e;if("code"===n){!function(e,t,n){let r;let{doc:s}=e.state,l=e.state.selection.$from;s.descendants((e,t)=>!("mention"===e.type.name&&(0,o.wO)(e.attrs.kind))||(r=t,!1)),e.chain().deleteRange({from:t.from,to:t.to}).run();let a=void 0!==r,i=s.firstChild,d=a?[{type:N,attrs:n}]:[{type:N,attrs:n},{type:"text",text:" "}];if(i&&"paragraph"===i.type.name){let t=i.firstChild;if(t&&"mention"===t.type.name&&(0,o.wO)(t.attrs.kind)){let n=t.nodeSize;e.chain().deleteRange({from:1,to:1+n}).insertContentAt(1,d).focus().run()}else e.chain().insertContentAt(1,d).focus().run()}else e.chain().insertContentAt(0,d).focus().run();e.commands.focus(a?l.pos:l.pos+1)}(l,a,i);return}let d=l.view.state.selection.$to.nodeAfter,c=null==d?void 0:null===(t=d.text)||void 0===t?void 0:t.startsWith(" ");c&&(a.to+=1),l.chain().focus().insertContentAt(a,[{type:N,attrs:i},{type:"text",text:" "}]).run(),null===(s=l.view.dom.ownerDocument.defaultView)||void 0===s||null===(r=s.getSelection())||void 0===r||r.collapseToEnd()},allow:e=>{let{state:n,range:r}=e;if(t)return!1;let s=n.doc.resolve(r.from),l=n.schema.nodes[N],a=!!s.parent.type.contentMatch.matchType(l);return a}}};let _=new f.H$("mention-doc"),T=new f.H$("mention-code"),L=e=>p.hj.create({addKeyboardShortcuts(){return{Enter:t=>{let{editor:n}=t;return e(n),!0},"Shift-Enter":()=>this.editor.commands.first(e=>{let{commands:t}=e;return[()=>t.newlineInCode(),()=>t.createParagraphNear(),()=>t.liftEmptyBlock(),()=>t.splitBlock()]})}}}),z=s.createContext({}),D=(0,s.forwardRef)((e,t)=>{let{editable:n,content:a,contextInfo:i,fetchingContextInfo:d,submitting:c,onSubmit:f,placeholder:p,onBlur:j,onFocus:b,onUpdate:N,autoFocus:y,className:C,editorClassName:I,placement:S}=e,[k,A]=(0,s.useState)(!d),R=(0,g.d)(e=>{if(c)return;let t=e.getText({blockSeparator:l.rZ}).trim();t&&(null==f||f(e))}),M=(0,s.useMemo)(()=>null!=i&&!!i.sources&&i.sources.some(e=>(0,o.wO)(e.sourceKind)),[null==i?void 0:i.sources]),D=(0,s.useMemo)(()=>null!=i&&!!i.sources&&i.sources.some(e=>(0,o._q)(e.sourceKind)),[null==i?void 0:i.sources]),O=(0,v.jE)({editable:!!k&&n,immediatelyRender:!1,extensions:[u.Z,m.Z,x.Z,h.Z.configure({showOnlyWhenEditable:!1,placeholder:k?p||"Ask anything...":"Loading..."}),L(e=>{R.current(e)}),w.configure({deleteTriggerWithBackspace:!0,HTMLAttributes:{class:"mention"},suggestion:E({category:"doc",char:"@",pluginKey:_,placement:"bottom"===S?"top-start":"bottom-start",disabled:!D})}),w.configure({deleteTriggerWithBackspace:!0,HTMLAttributes:{class:"mention-code"},suggestion:E({category:"code",char:"#",pluginKey:T,placement:"bottom"===S?"top-start":"bottom-start",disabled:!M})})],editorProps:{attributes:{class:(0,o.cn)("max-h-38 prose min-h-[3.5rem] max-w-none font-sans dark:prose-invert focus:outline-none prose-p:my-0",I)}},content:a,onBlur(e){null==j||j(e)},onFocus(e){null==b||b(e)},onUpdate(e){null==N||N(e)}},[k]);return((0,s.useImperativeHandle)(t,()=>({editor:O})),(0,s.useLayoutEffect)(()=>{O&&y&&O.commands.focus()},[O]),(0,s.useEffect)(()=>{d||k||A(!0)},[d]),O)?(0,r.jsx)(z.Provider,{value:{list:null==i?void 0:i.sources,pending:!!d},children:(0,r.jsx)("div",{className:(0,o.cn)("text-area-autosize max-h-36 overflow-y-auto pr-1",C),children:(0,r.jsx)(v.kg,{editor:O})})}):null});D.displayName="PromptEditor";var O=n(31458),P=n(11208),F=n(3448);function U(e){let{onSearch:t,onModelSelect:n,modelName:a,className:i,placeholder:u,showBetaBadge:m,isLoading:h,autoFocus:x,loadingWithSpinning:f,cleanAfterSearch:p=!0,isFollowup:v,contextInfo:g,fetchingContextInfo:j,isModelLoading:b,models:N}=e,[w,y]=(0,s.useState)(!1),[C,I]=(0,s.useState)(""),k=(0,s.useRef)(null),A=()=>{var e,t;null===(t=k.current)||void 0===t||null===(e=t.editor)||void 0===e||e.commands.focus()},R=e=>{n(e),setTimeout(()=>{A()})},M=e=>{if(!e||h||b)return;let n=e.getText({blockSeparator:l.rZ}).trim();if(!n)return;let r=(0,o.b)(n,null==g?void 0:g.sources),s={...(0,o.G8)(r),modelName:a};if(t(n,s),p){var i,d;null===(d=k.current)||void 0===d||null===(i=d.editor)||void 0===i||i.chain().clearContent().focus().run(),I("")}},E=e=>{var t;let n=null===(t=k.current)||void 0===t?void 0:t.editor;n&&n.chain().focus().command(t=>{var n,r,s;let{tr:l,state:a}=t,{$from:o}=a.selection,i=0===o.parentOffset,d=null!==(s=null===(r=o.nodeBefore)||void 0===r?void 0:null===(n=r.text)||void 0===n?void 0:n.endsWith(" "))&&void 0!==s&&s;return i||d?l.insertText(e):l.insertText(" "+e),!0}).run()},{hasCodebaseSource:_,hasDocumentSource:T}=(0,s.useMemo)(()=>(0,o.xV)(null==g?void 0:g.sources),[null==g?void 0:g.sources]),L=!!(null==N?void 0:N.length);return(0,r.jsxs)("div",{className:(0,o.cn)("relative w-full overflow-hidden rounded-xl border bg-background transition-all hover:border-ring dark:border-muted-foreground/60 dark:hover:border-muted-foreground",{"border-ring dark:border-muted-foreground":w},i),onClick:()=>{A()},children:[m&&(0,r.jsx)(H,{}),(0,r.jsxs)("div",{className:(0,o.cn)("flex items-end pr-4",{"min-h-[5.5rem]":!v,"min-h-[2.5rem]":v}),children:[(0,r.jsxs)("div",{className:"mr-1 flex-1 overflow-x-hidden pl-4",children:[(0,r.jsx)(D,{editable:!0,contextInfo:g,fetchingContextInfo:j,onSubmit:M,placeholder:u||"Ask anything...",autoFocus:x,onFocus:()=>y(!0),onBlur:()=>y(!1),onUpdate:e=>{let{editor:t}=e;return I(t.getText({blockSeparator:l.rZ}).trim())},ref:k,placement:v?"bottom":"top",className:(0,o.cn)("text-area-autosize resize-none rounded-lg !border-none bg-transparent !shadow-none !outline-none !ring-0 !ring-offset-0",{"py-3":!m,"py-4":m}),editorClassName:v&&L?"min-h-[1.75rem]":"min-h-[3.5em]"}),v&&L&&(0,r.jsx)("div",{className:"-ml-2 mb-2 flex",children:(0,r.jsx)(Z,{isInitializing:b,models:N,value:a,onChange:R})})]}),(0,r.jsx)("div",{className:(0,o.cn)("mb-3 flex items-center justify-between gap-2"),children:(0,r.jsxs)("div",{className:(0,o.cn)("flex items-center justify-center rounded-lg p-1 transition-all",{"bg-primary text-primary-foreground cursor-pointer":C.length>0,"!bg-muted !text-primary !cursor-default":h||0===C.length||b,"mr-1.5":!m}),onClick:()=>{var e;return M(null===(e=k.current)||void 0===e?void 0:e.editor)},children:[f&&h&&(0,r.jsx)(S.IconSpinner,{className:"h-4 w-4"}),(!f||!h)&&(0,r.jsx)(S.IconArrowRight,{className:"h-4 w-4"})]})})]}),!v&&(0,r.jsx)("div",{className:(0,o.cn)("flex items-center gap-2 border-t bg-[#F9F6EF] py-2 pl-2 pr-4 dark:border-muted-foreground/60 dark:bg-[#333333]"),onClick:e=>e.stopPropagation(),children:(0,r.jsxs)(c.Z,{loading:b||j,delay:0,fallback:(0,r.jsx)("div",{className:"flex h-8 w-[40%] items-center",children:(0,r.jsx)(F.O,{className:"h-4 w-full"})}),children:[(0,r.jsxs)(d.u,{children:[(0,r.jsx)(d.aJ,{asChild:!0,children:(0,r.jsxs)(O.z,{variant:"ghost",className:"gap-2 px-1.5 py-1 text-foreground/70",onClick:e=>E("#"),disabled:!_,children:[(0,r.jsx)(S.IconHash,{}),"Codebase"]})}),(0,r.jsx)(d._v,{className:"max-w-md",children:"Select a codebase to chat with"})]}),(0,r.jsx)(P.Z,{orientation:"vertical",className:"h-5"}),(0,r.jsxs)(d.u,{children:[(0,r.jsx)(d.aJ,{asChild:!0,children:(0,r.jsxs)(O.z,{variant:"ghost",className:"gap-2 px-1.5 py-1 text-foreground/70",onClick:e=>E("@"),disabled:!T,children:[(0,r.jsx)(S.IconAtSign,{}),"Documents"]})}),(0,r.jsx)(d._v,{className:"max-w-md",children:"Select a document to bring into context"})]}),!!(null==N?void 0:N.length)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(P.Z,{orientation:"vertical",className:"h-5"}),(0,r.jsx)(Z,{models:N,value:a,onChange:R})]})]})})]})}function Z(e){let{models:t,value:n,onChange:s,isInitializing:l}=e,a=e=>{s(e)};return(0,r.jsx)(c.Z,{loading:l,fallback:(0,r.jsx)("div",{className:"w-full pl-2",children:(0,r.jsx)(F.O,{className:"h-3 w-[20%]"})}),children:!!(null==t?void 0:t.length)&&(0,r.jsxs)(i.h_,{children:[(0,r.jsx)(i.$F,{asChild:!0,children:(0,r.jsxs)(O.z,{variant:"ghost",className:"gap-2 px-1.5 py-1 text-foreground/70",children:[(0,r.jsx)(S.IconBox,{}),n]})}),(0,r.jsx)(i.AW,{side:"bottom",align:"start",className:"dropdown-menu max-h-[30vh] min-w-[20rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-2 text-popover-foreground shadow animate-in",children:(0,r.jsx)(i._x,{value:n,onValueChange:s,children:t.map(e=>{let t=e===n;return(0,r.jsxs)(i.qB,{onClick:t=>{a(e),t.stopPropagation()},value:e,className:"cursor-pointer py-2 pl-3",children:[(0,r.jsx)(S.IconCheck,{className:(0,o.cn)("mr-2 shrink-0",e===n?"opacity-100":"opacity-0")}),(0,r.jsx)("span",{className:(0,o.cn)({"font-medium":t}),children:e})]},e)})})})]})})}function H(){let{theme:e}=(0,a.X)();return(0,r.jsxs)(d.u,{delayDuration:0,children:[(0,r.jsx)(d.aJ,{asChild:!0,children:(0,r.jsx)("span",{className:"absolute -right-8 top-1 mr-3 rotate-45 rounded-none border-none py-0.5 pl-6 pr-5 text-xs text-primary",style:{background:"dark"===e?"#333":"#e8e1d3"},children:"Beta"})}),(0,r.jsx)(d._v,{sideOffset:-8,className:"max-w-md",children:(0,r.jsx)("p",{children:"Please note that the answer engine is still in its early stages, and certain functionalities, such as finding the correct code context and the quality of summarizations, still have room for improvement. If you encounter an issue and believe it can be enhanced, consider sharing it in our Slack community!"})})]})}},73460:function(e,t,n){"use strict";n.d(t,{OL:function(){return v},_T:function(){return m},aR:function(){return i},f$:function(){return f},fY:function(){return h},le:function(){return g},vW:function(){return d},xo:function(){return x},yT:function(){return p}});var r=n(36164),s=n(3546),l=n(28961),a=n(57288),o=n(31458);let i=l.fC,d=l.xz,c=e=>{let{className:t,children:n,...s}=e;return(0,r.jsx)(l.h_,{className:(0,a.cn)(t),...s,children:(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-end justify-center sm:items-center",children:n})})};c.displayName=l.h_.displayName;let u=s.forwardRef((e,t)=>{let{className:n,children:s,...o}=e;return(0,r.jsx)(l.aV,{className:(0,a.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm transition-opacity animate-in fade-in",n),...o,ref:t})});u.displayName=l.aV.displayName;let m=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(l.VY,{ref:t,className:(0,a.cn)("fixed z-50 grid w-full max-w-lg scale-100 gap-4 border bg-background p-6 opacity-100 shadow-lg animate-in fade-in-90 slide-in-from-bottom-10 sm:rounded-lg sm:zoom-in-90 sm:slide-in-from-bottom-0 md:w-full",n),...s})]})});m.displayName=l.VY.displayName;let h=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,a.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...n})};h.displayName="AlertDialogHeader";let x=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,a.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};x.displayName="AlertDialogFooter";let f=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(l.Dx,{ref:t,className:(0,a.cn)("text-lg font-semibold",n),...s})});f.displayName=l.Dx.displayName;let p=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(l.dk,{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",n),...s})});p.displayName=l.dk.displayName;let v=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(l.aU,{ref:t,className:(0,a.cn)((0,o.d)(),n),...s})});v.displayName=l.aU.displayName;let g=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)(l.$j,{ref:t,className:(0,a.cn)((0,o.d)({variant:"outline"}),"mt-2 sm:mt-0",n),...s})});g.displayName=l.$j.displayName},98150:function(e,t,n){"use strict";n.d(t,{NI:function(){return p},Wi:function(){return u},l0:function(){return d},lX:function(){return f},pf:function(){return v},xJ:function(){return x},zG:function(){return g}});var r=n(36164),s=n(3546),l=n(74047),a=n(5493),o=n(57288),i=n(5266);let d=a.RV,c=s.createContext({}),u=e=>{let{...t}=e;return(0,r.jsx)(c.Provider,{value:{name:t.name},children:(0,r.jsx)(a.Qr,{...t})})},m=()=>{let e=s.useContext(c),t=s.useContext(h),{getFieldState:n,formState:r}=(0,a.Gc)(),l=e.name||"root",o=n(l,r);if(!r)throw Error("useFormField should be used within <Form>");let{id:i}=t;return{id:i,name:l,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...o}},h=s.createContext({}),x=s.forwardRef((e,t)=>{let{className:n,...l}=e,a=s.useId();return(0,r.jsx)(h.Provider,{value:{id:a},children:(0,r.jsx)("div",{ref:t,className:(0,o.cn)("space-y-2",n),...l})})});x.displayName="FormItem";let f=s.forwardRef((e,t)=>{let{className:n,required:s,...l}=e,{error:a,formItemId:d}=m();return(0,r.jsx)(i._,{ref:t,className:(0,o.cn)(a&&"text-destructive",s&&'after:ml-0.5 after:text-destructive after:content-["*"]',n),htmlFor:d,...l})});f.displayName="FormLabel";let p=s.forwardRef((e,t)=>{let{...n}=e,{error:s,formItemId:a,formDescriptionId:o,formMessageId:i}=m();return(0,r.jsx)(l.g7,{ref:t,id:a,"aria-describedby":s?"".concat(o," ").concat(i):"".concat(o),"aria-invalid":!!s,...n})});p.displayName="FormControl";let v=s.forwardRef((e,t)=>{let{className:n,...s}=e,{formDescriptionId:l}=m();return(0,r.jsx)("div",{ref:t,id:l,className:(0,o.cn)("text-sm text-muted-foreground",n),...s})});v.displayName="FormDescription";let g=s.forwardRef((e,t)=>{let{className:n,children:s,...l}=e,{error:a,formMessageId:i}=m(),d=a?String(null==a?void 0:a.message):s;return d?(0,r.jsx)("p",{ref:t,id:i,className:(0,o.cn)("text-sm font-medium text-destructive",n),...l,children:d}):null});g.displayName="FormMessage"},53538:function(e,t,n){"use strict";n.d(t,{Dp:function(){return i},ee:function(){return o},pO:function(){return a}});var r=n(36164),s=n(6618),l=n(57288);let a=e=>{let{className:t,...n}=e;return(0,r.jsx)(s.eh,{className:(0,l.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...n})},o=s.s_,i=e=>{let{withHandle:t,className:n,...a}=e;return(0,r.jsx)(s.OT,{className:(0,l.cn)("border-bg relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",n),...a,children:t&&(0,r.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border"})})}},93877:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var r=n(3546);let s=(e,t)=>{let[n,s]=(0,r.useState)(t),[l,a]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let t=localStorage.getItem(e);t&&s(JSON.parse(t)),a(!1)},[]),[n,t=>{s(t),localStorage.setItem(e,JSON.stringify(t))},l]};class l{get value(){if("undefined"!=typeof localStorage){let e=localStorage.getItem(this.storageKey);if(e)return"true"===e}return this.defaultValue}constructor(e,t,n,r){this.storageKey=e,this.title=t,this.description=n,this.defaultValue=r}}let a=new class{defineGlobalVar(){return new l(this.storageKey,this.title,this.description,this.defaultValue)}defineHook(){return()=>{let[e,t,n]=s(this.storageKey,this.defaultValue);return[{value:e,title:this.title,description:this.description,loading:n},()=>{t(!e)}]}}constructor(e,t,n,r){this.storageKey="EXP_".concat(e),this.title=t,this.description=n,this.defaultValue=null!=r&&r}}("enable_developer_mode","Developer Mode","Enable the developer mode. The features involved include the Answer Engine.",!1);a.defineGlobalVar();let o=a.defineHook()},31159:function(e,t,n){"use strict";n.d(t,{Vq:function(){return d}});var r=n(3546),s=n(21454),l=n(27257),a=n(3765),o=n(47241),i=n(17451);function d(){let{data:e,isLoading:t}=(0,s.ZP)("/v1beta/models",e=>(0,a.Z)(e,{errorHandler:()=>{throw Error("Fetch supported model failed.")}}),{shouldRetryOnError:!1}),n=(0,l.oR)(i.a,e=>e.selectedModel);return(0,r.useEffect)(()=>{if(!t){let t=function(e,t){if(!(null==t?void 0:t.length))return;let n=!!e&&t.includes(e);return n?e:t[0]}(n,null==e?void 0:e.chat);(0,o.Eg)(t)}},[t]),{isModelLoading:t,selectedModel:n,models:null==e?void 0:e.chat}}},44645:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(3546),s=n(11978);function l(){let e=(0,s.usePathname)(),t=(0,s.useRouter)(),n=(0,s.useSearchParams)(),l=(0,r.useCallback)(e=>{let t=new URLSearchParams(n);e&&Object.entries(e).forEach(e=>{let[n,r]=e;return t.set(n,r)});let r=t.toString();return r.length>0?"?".concat(r):""},[n]),a=(0,r.useCallback)(r=>{let s=function(e,t,n){var r,s;let l=null===(r=n.searchParams)||void 0===r?void 0:r.set,a=null===(s=n.searchParams)||void 0===s?void 0:s.del,o=new URLSearchParams(t);l&&Object.entries(l).forEach(e=>{let[t,n]=e;return o.set(t,n)}),a&&(Array.isArray(a)?a.forEach(e=>o.delete(e)):o.delete(a));let i=o.toString(),d=e;return i.length>0&&(d+="?".concat(i)),n.hash&&(d+="#".concat(n.hash.replace(/^#/,""))),d}((null==r?void 0:r.pathname)||e,n,r);return r.replace?t.replace(s):t.push(s),s},[e,n]);return{pathname:e,router:t,searchParams:n,getQueryString:l,updateUrlComponents:a}}},37266:function(e,t,n){"use strict";n.d(t,{CR:function(){return l},F0:function(){return o},wh:function(){return i}});var r=n(27257);let s={homePage:void 0},l=(0,r.Ue)()(()=>({...s})),a=l.setState,o=e=>a(()=>({homePage:e})),i=()=>a(()=>({homePage:void 0}))},15812:function(){},76531:function(e,t){"use strict";t.Z={src:"/_next/static/media/logo.526f7cf9.png",height:184,width:607,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAYAAABllJ3tAAAASklEQVR4nGPsKQh1f/HshV/PqtNtagrC8p++//rDAgQM//9/ZWJifMZYnRqg9+bVq6iZ51+1SP/5ovH//z8eRgbGbwyMjPxA9n0AMi8g2L1xUkUAAAAASUVORK5CYII=",blurWidth:8,blurHeight:2}}},function(e){e.O(0,[8415,7565,3078,753,7430,55,7812,4007,9643,4752,3449,2578,8511,240,2287,4421,1454,7070,5669,8961,4546,6805,9275,9148,4405,1522,1266,440,9427,6265,5019,59,7288,1565,4656,9634,445,3375,5289,1744],function(){return e(e.s=67802)}),_N_E=e.O()}]);