(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2797],{72845:function(e,t,n){Promise.resolve().then(n.bind(n,4112))},4112:function(e,t,n){"use strict";n.r(t),n.d(t,{Search:function(){return eu},SearchContext:function(){return eo}});var l=n(36164),s=n(3546),a=n(11978),r=n(62226),o=n.n(r),i=n(6797),c=n.n(i),d=n(66686),u=n(56575),h=n(21808),x=n(93877),f=n(9010),m=n(16784),v=n(80605),p=n(1544),g=n(31458),j=n(81565),N=n(53538),w=n(57830),b=n(11208),I=n(3448),S=n(72657),C=n(68172),y=n(48537),k=n(30601),_=n(24203),R=n(63743),E=n(52569),L=n(7449);n(2489);var M=n(70652),T=n.n(M),A=n(54767),z=n(1853),O=n(94909),U=n(82030),P=n(72940),Z=n(52807),D=n(51722),F=n(19108),H=n(2578),Q=n(40055),G=n(74038),V=n(43240),$=n(18500),q=n(28312),X=n(24449),J=n(44645),K=n(64566),W=n(37266),B=n(11634),Y=n(70410),ee=n(29),et=n(90168),en=n(10279),el=n(90379);let es=(0,s.lazy)(()=>n.e(726).then(n.t.bind(n,80726,23))),ea=e=>{let{value:t,isFullScreen:n,onToggleFullScreen:a,onClose:r}=e,[o]=(0,x.m)(),{theme:i}=(0,f.X)(),c=(0,s.useRef)(null);return((0,s.useEffect)(()=>{if(t){var e;null===(e=c.current)||void 0===e||e.scrollTo({top:0,behavior:"smooth"})}},[t]),(null==o?void 0:o.value)&&open)?(0,l.jsxs)("div",{className:"flex h-full flex-col px-3 pt-2",children:[(0,l.jsx)("div",{className:"flex items-center justify-end pb-2",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(g.z,{variant:"ghost",size:"icon",onClick:e=>a(!n),children:(0,l.jsx)(j.IconChevronDown,{className:(0,p.cn)("transition-all",n?"":"rotate-180")})}),(0,l.jsx)(g.z,{variant:"ghost",size:"icon",onClick:r,children:(0,l.jsx)(j.IconClose,{})})]})}),(0,l.jsx)(s.Suspense,{fallback:(0,l.jsx)(el.cg,{className:"p-2"}),children:t?(0,l.jsx)(w.ScrollArea,{className:"flex-1",ref:c,children:(0,l.jsx)(es,{theme:"dark"===i?"tomorrow":"rjv-default",src:t,style:{fontSize:"0.75rem"},collapseStringsAfterLength:120})}):null})]}):null};function er(){return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(I.O,{className:"w-full"}),(0,l.jsx)(I.O,{className:"w-[70%]"})]}),(0,l.jsx)(I.O,{className:"h-40 w-full"})]})}let eo=(0,s.createContext)({}),ei={compress:5.3,expand:6.3},ec="_temp_msg_",ed=()=>"".concat(ec).concat((0,u.x0)());function eu(){var e,t,n,r,o;let{updateUrlComponents:i,pathname:c}=(0,J.Z)(),[d,u]=(0,s.useState)(),[I,C]=(0,s.useState)(!1),y=(0,v.xG)(),[R,E]=(0,s.useState)([]),[L,M]=(0,s.useState)(!0),[T,O]=(0,s.useState)(!1),[Z,G]=(0,s.useState)(""),[V,ee]=(0,s.useState)(""),et=(0,s.useRef)(null),[el,es]=(0,s.useState)(!1),[ei]=(0,k.Hb)(),eu=(0,a.useRouter)(),ex=(0,s.useRef)(!1),{theme:ef}=(0,f.X)(),[ej,eN]=(0,s.useState)(!1),[ew,eb]=(0,s.useState)(),eI=(0,s.useRef)(null),[eS,eC]=(0,s.useState)(45),ey=(0,s.useRef)(eS),[ek]=(0,x.m)(),[e_,eR]=(0,s.useState)(),eE=(0,s.useMemo)(()=>{var e,t;if(d)return null===(t=d.match(/^\/search\/(.*)/))||void 0===t?void 0:null===(e=t[1])||void 0===e?void 0:e.split("-").pop()},[d]);(0,s.useEffect)(()=>{eE&&eR(eE)},[eE]);let[{data:eL,fetching:eM}]=(0,Q.aM)({query:Y.Gx}),[eT,eA]=(0,s.useState)(),[{data:ez,fetching:eO,error:eU}]=(0,Q.aM)({query:Y.XL,variables:{ids:[e_]},pause:!e_}),[{data:eP,error:eZ,fetching:eD}]=(0,Q.aM)({query:Y.r4,variables:{threadId:e_,first:30,after:eT},pause:!e_||T});(0,s.useEffect)(()=>{var e,t,n,l;if(null==eP?void 0:null===(t=eP.threadMessages)||void 0===t?void 0:null===(e=t.edges)||void 0===e?void 0:e.length){let e=eP.threadMessages.edges.map(e=>e.node).slice();E(t=>{var n;return(n=[...t,...e]).length?(0,F.Z)(n,(0,D.Z)("id",2)):[]})}if(null==eP?void 0:eP.threadMessages){let e=null==eP?void 0:null===(l=eP.threadMessages)||void 0===l?void 0:null===(n=l.pageInfo)||void 0===n?void 0:n.hasNextPage,t=null==eP?void 0:eP.threadMessages.pageInfo.endCursor;e&&t?eA(t):O(!0)}},[eP]);let eF=null==eL?void 0:eL.contextInfo.sources,eH=null==R?void 0:null===(e=R[0])||void 0===e?void 0:e.content,eQ=(0,s.useMemo)(()=>eF&&eH?(0,p.i8)(eF,eH,{maxLength:h.$I}):"",[eF,eH]);(0,s.useEffect)(()=>{eQ&&(document.title=eQ)},[eQ]),(0,s.useEffect)(()=>{eZ&&!T&&O(!0)},[eZ]);let{sendUserMessage:eG,isLoading:eV,error:e$,answer:eq,stop:eX,regenerate:eJ,deleteThreadMessagePair:eK}=(0,K.x)({threadId:e_}),eW=(0,m.d)(eV),eB=(0,s.useMemo)(()=>R.find(e=>e.id===ew),[ew,R]),eY=(0,s.useMemo)(()=>eB?(0,U.Z)(null==eB?void 0:eB.attachment,"doc","code"):{answers:R.filter(e=>e.role===$.uU.Assistant).map(e=>(0,U.Z)(e,"doc","code"))},[ew,null==eB?void 0:null===(t=eB.attachment)||void 0===t?void 0:t.code,null==eB?void 0:null===(n=eB.attachment)||void 0===n?void 0:n.doc]);(0,s.useEffect)(()=>{u(c),I||C(!0)},[c]),(0,s.useEffect)(()=>{I&&!eE&&(()=>{if(ex.current)return;ex.current=!0;let e=sessionStorage.getItem(h.$6.SEARCH_INITIAL_MSG),t=sessionStorage.getItem(h.$6.SEARCH_INITIAL_CONTEXTS),n=t?JSON.parse(t):void 0;if(e){sessionStorage.removeItem(h.$6.SEARCH_INITIAL_MSG),sessionStorage.removeItem(h.$6.SEARCH_INITIAL_CONTEXTS),O(!0),e2(e,n);return}e_||((0,W.wh)(),eu.replace("/"))})()},[I]),(0,s.useEffect)(()=>{T&&setTimeout(()=>{es(!0)},300)},[T]);let{isCopied:e0,onCopy:e1}=function(e){let{threadIdFromURL:t,threadIdFromStreaming:n,streamingDone:l,updateThreadURL:s}=e,{isCopied:a,copyToClipboard:r}=(0,q.m)({timeout:2e3}),o=(0,B.D)(em,{onError(e){H.A.error(e.message)}}),i=!t&&l&&n&&s,c=async()=>{if(a)return;let e=window.location.href;i&&(await o({threadId:n}),e=s(n)),r(e)};return{onCopy:c,isCopied:a}}({threadIdFromURL:eE,threadIdFromStreaming:e_,streamingDone:!eV,updateThreadURL:e=>{let t=(0,A.Z)(eQ),n=(0,z.Z)([t,e]).join("-"),l=i({pathname:"/search/".concat(n),searchParams:{del:["q"]},replace:!0});return location.origin+l}});(0,s.useEffect)(()=>{var e,t,n,l;eq.threadId&&eq.threadId!==e_&&eR(eq.threadId);let s=[...R],a=s.findIndex(e=>e.id===Z),r=s.findIndex(e=>e.id===V);if(-1===a||-1===r)return;let o=s[a],i=s[r];i.content=eq.content,(null===(e=i.attachment)||void 0===e?void 0:e.code)||!eq.attachmentsCode||(i.attachment={doc:(null===(n=i.attachment)||void 0===n?void 0:n.doc)||null,code:eq.attachmentsCode.map(e=>({...e.code,extra:{scores:e.scores}}))||null}),(null===(t=i.attachment)||void 0===t?void 0:t.doc)||!eq.attachmentsDoc||(i.attachment={doc:eq.attachmentsDoc.map(e=>({...e.doc,extra:{score:e.score}}))||null,code:(null===(l=i.attachment)||void 0===l?void 0:l.code)||null}),i.threadRelevantQuestions=null==eq?void 0:eq.relevantQuestions;let c=eq.userMessageId,d=eq.assistantMessageId;c&&d&&c!==o.id&&d!==i.id&&(o.id=c,i.id=d,G(c),ee(d)),E(s)},[eV,eq]),(0,s.useEffect)(()=>{if(e$){let e=[...R],t=e.find(e=>e.id===V);t&&(t.error=e$?"401"===e$.message?"Unauthorized":(0,P.Z)(e$.graphQLErrors,e=>{var t;return(null===(t=e.extensions)||void 0===t?void 0:t.code)===h.ir})?"The thread has expired":e$.message||"Failed to fetch":"Failed to fetch")}},[e$]);let e4=(0,s.useRef)();(0,s.useEffect)(()=>(eW.current&&(e4.current=window.setTimeout(()=>{if(!eW.current)return;M(!0);let e=null==et?void 0:et.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},300)),eW.current||M(!1),()=>{window.clearTimeout(e4.current)}),[eV]),(0,s.useEffect)(()=>{var e,t,n;ej?(null===(e=eI.current)||void 0===e||e.expand(),null===(t=eI.current)||void 0===t||t.resize(eS)):null===(n=eI.current)||void 0===n||n.collapse()},[ej]);let e2=(e,t)=>{let n=ed(),l=ed(),s={id:n,role:$.uU.User,content:e},a={id:l,role:$.uU.Assistant,content:""},{sourceIdForCodeQuery:r,sourceIdsForDocQuery:o,searchPublic:i}=eg(t),c=r?{sourceId:r,content:e}:null;G(n),ee(l),E([...R].concat([s,a])),eG({content:e},{generateRelevantQuestions:!0,codeQuery:c,docQuery:{sourceIds:o,content:e,searchPublic:!!i}})},e5=(0,s.useMemo)(()=>{var e,t;if(T&&!eO&&eE&&(eU||!(null==ez?void 0:null===(t=ez.threads)||void 0===t?void 0:null===(e=t.edges)||void 0===e?void 0:e.length)))return eU||Error(h.ir)},[ez,eO,eU,T,eE]),[e3]=(0,X.n)(eD||(null==eP?void 0:null===(o=eP.threadMessages)||void 0===o?void 0:null===(r=o.pageInfo)||void 0===r?void 0:r.hasNextPage),200);if(T&&(eZ||e5))return(0,l.jsx)(ep,{});if(!T&&e3)return(0,l.jsxs)("div",{children:[(0,l.jsx)(ev,{}),(0,l.jsxs)("div",{className:"mx-auto mt-24 w-full space-y-10 px-4 pb-32 lg:max-w-4xl lg:px-0",children:[(0,l.jsx)(er,{}),(0,l.jsx)(er,{})]})]});if(!y||!T)return(0,l.jsx)(l.Fragment,{});let e6=ei?{height:"calc(100vh - ".concat(k.wt,")")}:{height:"100vh"};return(0,l.jsx)(eo.Provider,{value:{isLoading:eV,onRegenerateResponse:()=>{var e;if(!e_||eM)return;let t=R.length-1,n=t-1;if(-1===t||n<=-1)return;let l=R[n].id,s=R[t].id,a=R.slice(0,-2),r=R[n],o={...r,id:ed()},i={id:ed(),role:$.uU.Assistant,content:"",attachment:{code:null,doc:null},error:void 0},c=(0,p.b)(o.content,null==eL?void 0:null===(e=eL.contextInfo)||void 0===e?void 0:e.sources),{sourceIdForCodeQuery:d,sourceIdsForDocQuery:u,searchPublic:h}=eg((0,p.G8)(c)),x=d?{sourceId:d,content:o.content}:null,f={sourceIds:u,content:o.content,searchPublic:h};G(o.id),ee(i.id),E([...a,o,i]),eJ({threadId:e_,userMessageId:l,assistantMessageId:s,userMessage:{content:o.content},threadRunOptions:{generateRelevantQuestions:!0,codeQuery:x,docQuery:f}})},onSubmitSearch:e2,setDevPanelOpen:eN,setConversationIdForDev:eb,isPathnameInitialized:I,enableDeveloperMode:ek.value,contextInfo:null==eL?void 0:eL.contextInfo,fetchingContextInfo:eM,onDeleteMessage:e=>{if(!e_)return;let t=R.findIndex(t=>t.id===e),n=t-1,l=R[t-1];if(-1!==t&&(null==l?void 0:l.role)===$.uU.User){if(l.id.startsWith(ec)&&e.startsWith(ec)){let e=R.slice(0,n).concat(R.slice(t+1));E(e);return}eK(e_,l.id,e).then(e=>{if(e){H.A.error(e);return}let l=R.slice(0,n).concat(R.slice(t+1));E(l)})}}},children:(0,l.jsx)("div",{className:"transition-all",style:e6,children:(0,l.jsxs)(N.pO,{direction:"vertical",onLayout:e=>{(null==e?void 0:e[1])&&eC(e[1])},children:[(0,l.jsxs)(N.ee,{children:[(0,l.jsx)(ev,{threadIdFromURL:eE,streamingDone:eq.completed}),(0,l.jsxs)("main",{className:"h-[calc(100%-4rem)] pb-8 lg:pb-0",children:[(0,l.jsx)(w.ScrollArea,{className:"h-full",ref:et,children:(0,l.jsx)("div",{className:"mx-auto px-4 pb-32 lg:max-w-4xl lg:px-0",children:(0,l.jsx)("div",{className:"flex flex-col",children:R.map((e,t)=>{if(e.role===$.uU.User)return(0,l.jsxs)("div",{children:[0!==t&&(0,l.jsx)(b.Z,{}),(0,l.jsx)("div",{className:"pb-2 pt-8 font-semibold",children:(0,l.jsx)(en.JG,{message:e.content,contextInfo:null==eL?void 0:eL.contextInfo,fetchingContextInfo:eM,className:"text-xl prose-p:mb-2 prose-p:mt-0",headline:!0,canWrapLongLines:!0})})]},e.id);if(e.role===$.uU.Assistant){let n=t===R.length-1;return(0,l.jsx)("div",{className:"pb-8 pt-2",children:(0,l.jsx)(eh,{answer:e,isLastAssistantMessage:n,showRelatedQuestion:n,isLoading:eV&&n,deletable:!eV&&R.length>2})},e.id)}return(0,l.jsx)(l.Fragment,{})})})})}),(0,l.jsx)(S.K,{className:(0,p.cn)("!fixed !bottom-[5.4rem] !right-4 !top-auto z-40 border-muted-foreground lg:!bottom-[2.85rem]",{hidden:ej}),container:et.current,offset:100,style:"dark"===ef?{"--background":"0 0% 12%"}:{}}),(0,l.jsxs)("div",{className:(0,p.cn)("fixed bottom-5 left-0 z-30 flex min-h-[3rem] w-full flex-col items-center gap-y-2",{"opacity-100 translate-y-0":el,"opacity-0 translate-y-10":!el,hidden:ej}),style:Object.assign({transition:"all 0.35s ease-out"},"dark"===ef?{"--background":"0 0% 12%"}:{}),children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[L&&(0,l.jsxs)(g.z,{className:"bg-background",variant:"outline",onClick:()=>eX(),children:[(0,l.jsx)(j.IconStop,{className:"mr-2"}),"Stop generating"]}),!L&&(0,l.jsxs)(g.z,{className:"bg-background",variant:"outline",onClick:e1,children:[e0?(0,l.jsx)(j.IconCheck,{className:"mr-2 text-green-600"}):(0,l.jsx)(j.IconShare,{className:"mr-2"}),"Share Link"]})]}),(0,l.jsx)("div",{className:(0,p.cn)("relative z-20 flex justify-center self-stretch px-4"),children:(0,l.jsx)(_.Z,{onSearch:e2,className:"min-h-[5rem] lg:max-w-4xl",placeholder:"Ask a follow up question",isLoading:eV,isFollowup:!0,contextInfo:null==eL?void 0:eL.contextInfo,fetchingContextInfo:eM})})]})]})]}),(0,l.jsx)(N.Dp,{className:(0,p.cn)("hidden !h-[4px] border-none bg-background shadow-[0px_-4px_4px_rgba(0,0,0,0.2)] hover:bg-blue-500 active:bg-blue-500 dark:shadow-[0px_-4px_4px_rgba(255,255,255,0.2)]",ej&&"block")}),(0,l.jsx)(N.ee,{collapsible:!0,collapsedSize:0,defaultSize:0,ref:eI,onCollapse:()=>eN(!1),className:"z-50",children:(0,l.jsx)(ea,{onClose:()=>eN(!1),value:eY,isFullScreen:100===eS,onToggleFullScreen:e=>{var t;let n=ey.current;e?n=100:100===n&&(n=45),null===(t=eI.current)||void 0===t||t.resize(n),eC(n),ey.current=eS}})})]})})})}function eh(e){var t,n,a,r,o,i;let{answer:c,showRelatedQuestion:d,isLoading:u,isLastAssistantMessage:h,deletable:x}=e,{onRegenerateResponse:f,onSubmitSearch:m,setDevPanelOpen:v,setConversationIdForDev:N,enableDeveloperMode:w,contextInfo:b,fetchingContextInfo:S,onDeleteMessage:C}=(0,s.useContext)(eo),[k,_]=(0,s.useState)(!1),[R,E]=(0,s.useState)(void 0),L=u?j.IconSpinner:j.IconSparkles,M=(null===(n=c.attachment)||void 0===n?void 0:null===(t=n.doc)||void 0===t?void 0:t.length)?Math.ceil(c.attachment.doc.length/4)*ei.expand+.5*Math.floor(c.attachment.doc.length/4):0,T=(0,s.useMemo)(()=>{var e,t,n;return null!==(n=null==c?void 0:null===(t=c.attachment)||void 0===t?void 0:null===(e=t.code)||void 0===e?void 0:e.map(e=>{var t;let{startLine:n,endLine:l}=(0,p.OV)(e);return{kind:"file",range:{start:n,end:l},filepath:e.filepath,content:e.content,git_url:e.gitUrl,extra:{scores:null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.scores}}}))&&void 0!==n?n:[]},[null==c?void 0:null===(a=c.attachment)||void 0===a?void 0:a.code]),A=e=>{let{startLine:t,endLine:n}=(0,p.OV)(e);if(!e.filepath)return;let l=new URL("".concat(window.location.origin,"/files")),s=new URLSearchParams;s.append("redirect_filepath",e.filepath),s.append("redirect_git_url",e.gitUrl),l.search=s.toString();let a=(0,p.nO)({start:t,end:n});a&&(l.hash=a),window.open(l.toString())},U=null==c?void 0:null===(r=c.attachment)||void 0===r?void 0:r.doc,P=null==c?void 0:null===(o=c.attachment)||void 0===o?void 0:o.code;return(0,l.jsxs)("div",{className:"flex flex-col gap-y-5",children:[U&&U.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-1 flex items-center gap-x-2",children:[(0,l.jsx)(j.IconBlocks,{className:"relative",style:{top:"-0.04rem"}}),(0,l.jsx)("p",{className:"text-sm font-bold leading-normal",children:"Sources"})]}),(0,l.jsx)("div",{className:"gap-sm grid grid-cols-3 gap-2 overflow-hidden md:grid-cols-4",style:{transition:"height 0.25s ease-out",height:k?"".concat(M,"rem"):"".concat(ei.compress,"rem")},children:U.map((e,t)=>(0,l.jsx)(ef,{conversationId:c.id,source:e,showMore:k,showDevTooltip:w},e.link+t))}),(0,l.jsxs)(g.z,{variant:"ghost",className:"-ml-1.5 mt-1 flex items-center gap-x-1 px-1 py-2 text-sm font-normal text-muted-foreground",onClick:()=>_(!k),children:[(0,l.jsx)(j.IconChevronRight,{className:(0,p.cn)({"-rotate-90":k,"rotate-90":!k})}),(0,l.jsx)("p",{children:k?"Show less":"Show more"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-1 flex h-8 items-center gap-x-1.5",children:[(0,l.jsx)(L,{className:(0,p.cn)({"animate-spinner":u})}),(0,l.jsx)("p",{className:"text-sm font-bold leading-none",children:"Answer"}),w&&(0,l.jsx)(g.z,{variant:"ghost",size:"icon",onClick:()=>{N(c.id),v(!0)},children:(0,l.jsx)(j.IconBug,{})})]}),P&&P.length>0&&(0,l.jsx)(et.q,{contexts:T,className:"mt-1 text-sm",onContextClick:e=>{if(!e.filepath)return;let t=new URL("".concat(window.location.origin,"/files")),n=new URLSearchParams;n.append("redirect_filepath",e.filepath),n.append("redirect_git_url",e.git_url),t.search=n.toString();let l=(0,p.nO)({start:e.range.start,end:e.range.end});l&&(t.hash=l),window.open(t.toString())},enableTooltip:w,showExternalLink:!1,onTooltipClick:()=>{N(c.id),v(!0)},highlightIndex:R}),u&&!c.content&&(0,l.jsx)(I.O,{className:"mt-1 h-40 w-full"}),(0,l.jsx)(en.JG,{message:c.content,attachmentDocs:U,attachmentCode:P,onCodeCitationClick:e=>{A(e)},onCodeCitationMouseEnter:e=>{var t,n;E(e-1-((null==c?void 0:null===(n=c.attachment)||void 0===n?void 0:null===(t=n.doc)||void 0===t?void 0:t.length)||0))},onCodeCitationMouseLeave:e=>{E(void 0)},contextInfo:b,fetchingContextInfo:S,canWrapLongLines:!u}),c.error&&(0,l.jsx)(en.mE,{error:c.error}),!u&&(0,l.jsxs)("div",{className:"mt-3 flex items-center gap-x-3 text-sm",children:[(0,l.jsx)(y.q,{className:"-ml-1.5 gap-x-1 px-1 font-normal text-muted-foreground",value:(e=>{var t,n,l,s,a,r,o,i,c,d,u;if((0,O.Z)(null==e?void 0:null===(t=e.attachment)||void 0===t?void 0:t.doc)&&(0,O.Z)(null==e?void 0:null===(n=e.attachment)||void 0===n?void 0:n.code))return e.content;let h=e.content.replace(G.H,e=>{let t=null==e?void 0:e.match(/\d+/);return"[".concat(t,"]")}).trim(),x=null!==(c=null===(s=e.attachment)||void 0===s?void 0:null===(l=s.doc)||void 0===l?void 0:l.map((e,t)=>"[".concat(t+1,"] ").concat(e.link)).join("\n"))&&void 0!==c?c:"",f=null!==(d=null===(r=e.attachment)||void 0===r?void 0:null===(a=r.doc)||void 0===a?void 0:a.length)&&void 0!==d?d:0,m=null!==(u=null===(i=e.attachment)||void 0===i?void 0:null===(o=i.code)||void 0===o?void 0:o.map((e,t)=>{let n=(0,p.tf)(e),l=(0,z.Z)([e.filepath,n]).join(":");return"[".concat(t+f+1,"] ").concat(l)}).join("\n"))&&void 0!==u?u:"";return"".concat(h,"\n\nCitations:\n").concat(x+m)})(c),text:"Copy"}),!u&&!S&&h&&(0,l.jsxs)(g.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>f(c.id),children:[(0,l.jsx)(j.IconRefresh,{}),(0,l.jsx)("p",{children:"Regenerate"})]}),x&&(0,l.jsxs)(g.z,{className:"flex items-center gap-x-1 px-1 font-normal text-muted-foreground",variant:"ghost",onClick:()=>C(c.id),children:[(0,l.jsx)(j.IconTrash,{}),(0,l.jsx)("p",{children:"Delete"})]})]})]}),d&&!u&&c.threadRelevantQuestions&&c.threadRelevantQuestions.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-1.5",children:[(0,l.jsx)(j.IconLayers,{}),(0,l.jsx)("p",{className:"text-sm font-bold leading-none",children:"Suggestions"})]}),(0,l.jsx)("div",{className:"mt-2 flex flex-col gap-y-3",children:null===(i=c.threadRelevantQuestions)||void 0===i?void 0:i.map((e,t)=>(0,l.jsxs)("div",{className:"flex cursor-pointer items-center justify-between rounded-lg border p-4 py-3 transition-opacity hover:opacity-70",onClick:m.bind(null,e),children:[(0,l.jsx)("p",{className:"w-full overflow-hidden text-ellipsis text-sm",children:e}),(0,l.jsx)(j.IconPlus,{})]},t))})]})]})}let ex=e=>{let t=o().sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}),n=d.TU.parse(t),l=c().decode(n),s=l.replace(/<\/?[^>]+(>|$)/g,"");return s};function ef(e){var t,n;let{conversationId:a,source:r,showMore:o,showDevTooltip:i}=e,{setDevPanelOpen:c,setConversationIdForDev:d}=(0,s.useContext)(eo),{hostname:u}=new URL(r.link),[h,x]=(0,s.useState)(!1);return(0,l.jsxs)(ee.u,{open:h,onOpenChange:e=>{i&&x(e)},delayDuration:0,children:[(0,l.jsx)(ee.aJ,{asChild:!0,children:(0,l.jsx)("div",{className:"flex cursor-pointer flex-col justify-between rounded-lg border bg-card p-3 hover:bg-card/60",style:{height:o?"".concat(ei.expand,"rem"):"".concat(ei.compress,"rem"),transition:"all 0.25s ease-out"},onClick:()=>window.open(r.link),children:(0,l.jsxs)("div",{className:"flex flex-1 flex-col justify-between gap-y-1",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-0.5",children:[(0,l.jsx)("p",{className:"line-clamp-1 w-full overflow-hidden text-ellipsis break-all text-xs font-semibold",children:r.title}),(0,l.jsx)("p",{className:(0,p.cn)(" w-full overflow-hidden text-ellipsis break-all text-xs text-muted-foreground",{"line-clamp-2":o,"line-clamp-1":!o}),children:ex(r.content)})]}),(0,l.jsx)("div",{className:"flex items-center text-xs text-muted-foreground",children:(0,l.jsxs)("div",{className:"flex w-full flex-1 items-center",children:[(0,l.jsx)(en.V$,{hostname:u}),(0,l.jsx)("p",{className:"ml-1 overflow-hidden text-ellipsis",children:u.replace("www.","").split("/")[0]})]})})]})})}),(0,l.jsx)(ee._v,{align:"start",className:"cursor-pointer p-2",onClick:e=>{e.stopPropagation(),d(a),c(!0)},children:(0,l.jsxs)("p",{children:["Score: ",null!==(n=null==r?void 0:null===(t=r.extra)||void 0===t?void 0:t.score)&&void 0!==n?n:"-"]})})]})}let em=(0,V.BX)("\n  mutation SetThreadPersisted($threadId: ID!) {\n    setThreadPersisted(threadId: $threadId)\n  }\n");function ev(e){let{threadIdFromURL:t,streamingDone:n}=e,s=(0,a.useRouter)(),r=e=>{e&&(0,W.wh)(),s.push("/")};return(0,l.jsxs)("header",{className:"flex h-16 items-center justify-between px-4 lg:px-10",children:[(0,l.jsx)("div",{className:"flex items-center gap-x-6",children:(0,l.jsxs)(g.z,{variant:"ghost",className:"-ml-1 pl-0 text-sm text-muted-foreground",onClick:()=>r(),children:[(0,l.jsx)(j.IconChevronLeft,{className:"mr-1 h-5 w-5"}),"Home"]})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(n||t)&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(g.z,{variant:"ghost",className:"flex items-center gap-1 px-2 font-normal text-muted-foreground",onClick:()=>r(!0),children:(0,l.jsx)(j.IconPlus,{})})}),(0,l.jsx)(C.q,{children:(0,l.jsx)(R.T,{className:"mr-4"})}),(0,l.jsx)(L.Z,{showHome:!1,showSetting:!0,beforeRouteChange:()=>{(0,W.wh)()},children:(0,l.jsx)(E.SQ,{className:"h-10 w-10 border"})})]})]})}function ep(){return(0,l.jsxs)("div",{className:"flex h-screen flex-col",children:[(0,l.jsx)(ev,{}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(j.IconFileSearch,{className:"h-6 w-6"}),(0,l.jsx)("div",{className:"text-xl font-semibold",children:"Something went wrong"})]}),(0,l.jsx)("div",{children:"Failed to fetch the thread, please refresh the page or start a new thread"}),(0,l.jsxs)(T(),{href:"/",onClick:W.wh,className:(0,p.cn)((0,g.d)(),"mt-4 gap-2"),children:[(0,l.jsx)(j.IconPlus,{}),(0,l.jsx)("span",{children:"New Thread"})]})]})})]})}function eg(e){let t,n=[],l=!1;if(e){var s,a,r,o;n=(0,Z.Z)((0,z.Z)([null==e?void 0:null===(s=e.codeSourceIds)||void 0===s?void 0:s[0]].concat(e.docSourceIds))),l=null!==(r=e.searchPublic)&&void 0!==r&&r,t=null!==(o=null===(a=e.codeSourceIds)||void 0===a?void 0:a[0])&&void 0!==o?o:void 0}return{sourceIdsForDocQuery:n,sourceIdForCodeQuery:t,searchPublic:l}}},53538:function(e,t,n){"use strict";n.d(t,{Dp:function(){return i},ee:function(){return o},pO:function(){return r}});var l=n(36164),s=n(6618),a=n(1544);let r=e=>{let{className:t,...n}=e;return(0,l.jsx)(s.eh,{className:(0,a.cn)("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",t),...n})},o=s.s_,i=e=>{let{withHandle:t,className:n,...r}=e;return(0,l.jsx)(s.OT,{className:(0,a.cn)("border-bg relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",n),...r,children:t&&(0,l.jsx)("div",{className:"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border"})})}},93877:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var l=n(3546);let s=(e,t)=>{let[n,s]=(0,l.useState)(t),[a,r]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let t=localStorage.getItem(e);t&&s(JSON.parse(t)),r(!1)},[]),[n,t=>{s(t),localStorage.setItem(e,JSON.stringify(t))},a]};class a{get value(){if("undefined"!=typeof localStorage){let e=localStorage.getItem(this.storageKey);if(e)return"true"===e}return this.defaultValue}constructor(e,t,n,l){this.storageKey=e,this.title=t,this.description=n,this.defaultValue=l}}let r=new class{defineGlobalVar(){return new a(this.storageKey,this.title,this.description,this.defaultValue)}defineHook(){return()=>{let[e,t,n]=s(this.storageKey,this.defaultValue);return[{value:e,title:this.title,description:this.description,loading:n},()=>{t(!e)}]}}constructor(e,t,n,l){this.storageKey="EXP_".concat(e),this.title=t,this.description=n,this.defaultValue=null!=l&&l}}("enable_developer_mode","Developer Mode","Enable the developer mode. The features involved include the Answer Engine.",!1);r.defineGlobalVar();let o=r.defineHook()},44645:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var l=n(3546),s=n(11978);function a(){let e=(0,s.usePathname)(),t=(0,s.useRouter)(),n=(0,s.useSearchParams)(),a=(0,l.useCallback)(e=>{let t=new URLSearchParams(n);e&&Object.entries(e).forEach(e=>{let[n,l]=e;return t.set(n,l)});let l=t.toString();return l.length>0?"?".concat(l):""},[n]),r=(0,l.useCallback)(l=>{let s=function(e,t,n){var l,s;let a=null===(l=n.searchParams)||void 0===l?void 0:l.set,r=null===(s=n.searchParams)||void 0===s?void 0:s.del,o=new URLSearchParams(t);a&&Object.entries(a).forEach(e=>{let[t,n]=e;return o.set(t,n)}),r&&(Array.isArray(r)?r.forEach(e=>o.delete(e)):o.delete(r));let i=o.toString(),c=e;return i.length>0&&(c+="?".concat(i)),n.hash&&(c+="#".concat(n.hash.replace(/^#/,""))),c}((null==l?void 0:l.pathname)||e,n,l);return l.replace?t.replace(s):t.push(s),s},[e,n]);return{pathname:e,router:t,searchParams:n,getQueryString:a,updateUrlComponents:r}}},2489:function(){},82030:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var l=n(94219),s=n(79204),a=(0,n(43285).Z)(function(e,t){return null==e?{}:(0,l.Z)(e,t,function(t,n){return(0,s.Z)(e,n)})})}},function(e){e.O(0,[3078,753,1386,55,1058,4007,7674,3643,2578,6345,9421,4421,1454,1722,4546,9275,9148,4405,4553,1266,9073,446,7220,9256,3031,7045,1544,1565,3821,1068,9826,3375,5289,1744],function(){return e(e.s=72845)}),_N_E=e.O()}]);