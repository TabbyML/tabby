(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2436],{10814:function(e,r,t){Promise.resolve().then(t.bind(t,54304))},7846:function(e,r,t){"use strict";t.d(r,{ZP:function(){return P}});var i=t(36164),l=t(3546),n=t(11978),s=t(84381),a=t(94909),o=t(5493),d=t(2578),c=t(40055),u=t(23782),h=t(43240),x=t(18500),p=t(11634),m=t(70410),v=t(57288),f=t(73460),j=t(31458),b=t(98150),g=t(81565),C=t(82394),N=t(5266),y=t(80363),O=t(11208),w=t(48537),G=t(94770),_=t(10221);let I=(0,h.BX)("\n  mutation updateOauthCredential($input: UpdateOAuthCredentialInput!) {\n    updateOauthCredential(input: $input)\n  }\n"),k=(0,h.BX)("\n  mutation deleteOauthCredential($provider: OAuthProvider!) {\n    deleteOauthCredential(provider: $provider)\n  }\n"),S=(0,h.BX)("\n  query OAuthCallbackUrl($provider: OAuthProvider!) {\n    oauthCallbackUrl(provider: $provider)\n  }\n"),z=u.Ry({clientId:u.Z_(),clientSecret:u.Z_(),provider:u.jb(x.O4)}),q=z.extend({clientSecret:u.Z_().optional()}),A="Provider already exists. Please choose another one";function P(e){let{className:r,isNew:t,defaultProvider:h,defaultValues:P,onSuccess:E,existedProviders:M,...R}=e,T=(0,n.useRouter)(),Z=(0,c.m8)(),D=l.useMemo(()=>({...P||{},provider:h||x.O4.Github}),[]),[U,$]=l.useState(!1),[F,X]=l.useState(!1),B=l.useMemo(()=>t?z.extend({provider:u.jb(x.O4).refine(e=>!(null==M?void 0:M.includes(e)),{message:A})}):q,[t,M]),V=(0,o.cI)({resolver:(0,s.F)(B),defaultValues:D}),J=V.watch("provider"),L=!(0,a.Z)(V.formState.dirtyFields),{isSubmitting:W}=V.formState,H=()=>{T.replace("/settings/sso")},Y=(0,p.Db)(I,{onCompleted(e){(null==e?void 0:e.updateOauthCredential)&&(null==E||E(V.getValues()))},form:V}),K=V.watch("provider");l.useEffect(()=>{t&&(K&&(null==M?void 0:M.includes(K))?V.setError("provider",{message:A}):V.clearErrors("provider"))},[K,t,M]);let Q=(0,p.Db)(k),ee=async e=>{if(t){let r=await Z.query(m.Ry,{provider:e.provider}).then(e=>{var r;return!!(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.oauthCredential)});if(r){V.setError("provider",{message:A});return}}Y({input:e})},[{data:er}]=(0,c.aM)({query:S,variables:{provider:J}}),et=l.useMemo(()=>t?"e.g. e363c08d7e9ca4e66e723a53f38a21f6a54c1b83":Array(36).fill("*").join(""),[t]);return(0,i.jsx)(b.l0,{...V,children:(0,i.jsxs)("div",{className:(0,v.cn)("grid gap-2",r),...R,children:[(0,i.jsxs)("form",{className:"grid gap-4",onSubmit:V.handleSubmit(ee),children:[(0,i.jsx)(_.D,{children:"Basic information"}),(0,i.jsx)(b.Wi,{control:V.control,name:"provider",render:e=>{let{field:{onChange:r,...l}}=e;return(0,i.jsxs)(b.xJ,{children:[(0,i.jsx)(b.lX,{children:"Provider"}),(0,i.jsx)(b.NI,{children:(0,i.jsxs)(y.E,{className:"flex gap-8",orientation:"horizontal",onValueChange:r,...l,children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(y.m,{value:x.O4.Github,id:"r_github",disabled:!t}),(0,i.jsxs)(N._,{className:"flex cursor-pointer items-center gap-2 pl-2",htmlFor:"r_github",children:[(0,i.jsx)(g.IconGitHub,{className:"h-5 w-5"}),"GitHub"]})]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(y.m,{value:x.O4.Google,id:"r_google",disabled:!t}),(0,i.jsxs)(N._,{className:"flex cursor-pointer items-center gap-2 pl-2",htmlFor:"r_google",children:[(0,i.jsx)(g.IconGoogle,{className:"h-5 w-5"}),"Google"]})]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(y.m,{value:x.O4.Gitlab,id:"r_gitlab",disabled:!t}),(0,i.jsxs)(N._,{className:"flex cursor-pointer items-center gap-2 pl-2",htmlFor:"r_gitlab",children:[(0,i.jsx)(g.IconGitLab,{className:"h-5 w-5"}),"GitLab"]})]})]})}),(0,i.jsx)(b.zG,{})]})}}),er&&(0,i.jsx)(b.xJ,{className:"mt-4",children:(0,i.jsxs)("div",{className:"flex flex-col gap-2 overflow-hidden rounded-lg border px-3 py-2",children:[(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:"Create your OAuth2 application with the following information"}),(0,i.jsxs)("div",{className:"flex flex-col justify-between sm:flex-row sm:items-center",children:[(0,i.jsx)("div",{className:"text-sm font-medium",children:"Authorization callback URL"}),(0,i.jsxs)("span",{className:"flex items-center text-sm",children:[(0,i.jsx)("span",{className:"truncate",children:er.oauthCallbackUrl}),(0,i.jsx)(w.q,{className:"shrink-0",type:"button",value:er.oauthCallbackUrl})]})]})]})}),(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsx)(_.D,{children:"OAuth provider information"}),(0,i.jsx)(b.pf,{children:"The information is provided by your identity provider."})]}),(0,i.jsx)(b.Wi,{control:V.control,name:"clientId",render:e=>{let{field:r}=e;return(0,i.jsxs)(b.xJ,{children:[(0,i.jsx)(b.lX,{required:!0,children:"Client ID"}),(0,i.jsx)(b.NI,{children:(0,i.jsx)(C.I,{placeholder:"e.g. ae1542c44b154c10c859",autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",...r})}),(0,i.jsx)(b.zG,{})]})}}),(0,i.jsx)(b.Wi,{control:V.control,name:"clientSecret",render:e=>{let{field:r}=e;return(0,i.jsxs)(b.xJ,{children:[(0,i.jsx)(b.lX,{required:t,children:"Client Secret"}),(0,i.jsx)(b.NI,{children:(0,i.jsx)(C.I,{className:(0,v.cn)({"placeholder:translate-y-[10%] !placeholder-foreground":!t}),placeholder:et,autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",type:"password",...r})}),(0,i.jsx)(b.zG,{})]})}}),(0,i.jsx)(O.Z,{className:"my-2"}),(0,i.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,i.jsx)(j.z,{type:"button",variant:"ghost",onClick:H,children:"Back"}),!t&&(0,i.jsxs)(f.aR,{open:U,onOpenChange:$,children:[(0,i.jsx)(f.vW,{asChild:!0,children:(0,i.jsx)(j.z,{variant:"hover-destructive",children:"Delete"})}),(0,i.jsxs)(f._T,{children:[(0,i.jsxs)(f.fY,{children:[(0,i.jsx)(f.f$,{children:"Are you absolutely sure?"}),(0,i.jsx)(f.yT,{children:"This action cannot be undone. It will permanently delete the current credential."})]}),(0,i.jsxs)(f.xo,{children:[(0,i.jsx)(f.le,{children:"Cancel"}),(0,i.jsxs)(f.OL,{className:(0,j.d)({variant:"destructive"}),onClick:e=>{e.preventDefault(),X(!0),Q({provider:J}).then(e=>{var r,t;(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.deleteOauthCredential)?H():(X(!1),(null==e?void 0:e.error)&&d.A.error(null==e?void 0:null===(t=e.error)||void 0===t?void 0:t.message))})},children:[F&&(0,i.jsx)(g.IconSpinner,{className:"mr-2 h-4 w-4 animate-spin"}),"Yes, delete it"]})]})]})]}),(0,i.jsx)(G.M,{licenses:[x.oj.Enterprise],children:e=>{let{hasValidLicense:r}=e;return(0,i.jsxs)(j.z,{type:"submit",disabled:!r||W||!t&&!L,children:[W&&(0,i.jsx)(g.IconSpinner,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Create":"Update"]})}})]})]}),(0,i.jsx)(b.zG,{className:"text-center"})]})})}},54304:function(e,r,t){"use strict";t.r(r),t.d(r,{NewPage:function(){return m}});var i=t(36164),l=t(3546),n=t(11978),s=t(1853),a=t(40055),o=t(18500),d=t(70410),c=t(6230),u=t(90379),h=t(20255),x=t(7846),p=t(31988);function m(){let[e,r]=(0,l.useState)("oauth"),t=(0,n.useRouter)(),[{data:m,fetching:v}]=(0,a.aM)({query:d.Ry,variables:{provider:o.O4.Github}}),[{data:f,fetching:j}]=(0,a.aM)({query:d.Ry,variables:{provider:o.O4.Google}}),[{data:b,fetching:g}]=(0,a.aM)({query:d.Ry,variables:{provider:o.O4.Gitlab}}),[{data:C,fetching:N}]=(0,a.aM)({query:d.wz}),y=!!(null==C?void 0:C.ldapCredential),O=(0,s.Z)([(null==m?void 0:m.oauthCredential)&&o.O4.Github,(null==f?void 0:f.oauthCredential)&&o.O4.Google,(null==b?void 0:b.oauthCredential)&&o.O4.Gitlab]),w=()=>{t.replace("/settings/sso")};return(0,i.jsx)(c.Z,{loading:v||j||g||N,fallback:(0,i.jsx)(u.cg,{}),children:(0,i.jsxs)("div",{children:[(0,i.jsx)(p.w,{value:e,onChange:r}),"oauth"===e?(0,i.jsx)(x.ZP,{isNew:!0,defaultProvider:o.O4.Github,existedProviders:O,onSuccess:w,className:"mt-6"}):(0,i.jsx)(h.u,{isNew:!0,defaultValues:{skipTlsVerify:!1},onSuccess:w,existed:y})]})})}},48537:function(e,r,t){"use strict";t.d(r,{q:function(){return a}});var i=t(36164);t(3546);var l=t(28312),n=t(31458),s=t(81565);function a(e){let{className:r,value:t,onCopyContent:a,text:o,...d}=e,{isCopied:c,copyToClipboard:u}=(0,l.m)({timeout:2e3,onCopyContent:a});return t?(0,i.jsxs)(n.z,{variant:"ghost",size:o?"default":"icon",className:r,onClick:()=>{c||u(t)},...d,children:[c?(0,i.jsx)(s.IconCheck,{className:"text-green-600"}):(0,i.jsx)(s.IconCopy,{}),o&&(0,i.jsx)("span",{children:o}),!o&&(0,i.jsx)("span",{className:"sr-only",children:"Copy"})]}):null}},28312:function(e,r,t){"use strict";t.d(r,{m:function(){return a}});var i=t(3546),l=t(61200),n=t.n(l),s=t(2578);function a(e){let{timeout:r=2e3,onError:t,onCopyContent:l}=e,[a,o]=i.useState(!1),d=()=>{o(!0),setTimeout(()=>{o(!1)},r)},c=e=>{if("function"==typeof t){null==t||t(e);return}s.A.error("Failed to copy.")};return{isCopied:a,copyToClipboard:e=>{var r;if(e){if(l){l(e),d();return}if(null===(r=navigator.clipboard)||void 0===r?void 0:r.writeText)navigator.clipboard.writeText(e).then(d).catch(c);else{let r=n()(e);r?d():c()}}}}}}},function(e){e.O(0,[8415,7430,55,641,340,4007,2546,1283,3449,2578,8511,240,2287,8961,1889,3707,3301,7488,7288,1565,3240,4656,8040,255,3375,5289,1744],function(){return e(e.s=10814)}),_N_E=e.O()}]);