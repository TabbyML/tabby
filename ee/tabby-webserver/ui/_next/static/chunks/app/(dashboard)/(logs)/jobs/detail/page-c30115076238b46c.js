(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1908],{93634:function(e,t,n){Promise.resolve().then(n.bind(n,77930))},77930:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var r=n(36164),s=n(3546),l=n(11978),i=n(70787),u=n(97651),o=n.n(u),c=n(28011),a=n(31213),d=n(8470),f=n(99092),h=n.n(f),v=n(21454),x=n(40055),m=n(3765),g=n(70410),j=n(73492),p=n(81565),b=n(54173),y=n(90379),w=n(17484);function N(){var e,t,n,i;let u=(0,l.useRouter)(),f=(0,l.useSearchParams)(),j=f.get("id"),[N,B]=(0,s.useState)([]),O=(0,s.useRef)(0),A=(0,s.useRef)(0),[S,C]=(0,s.useState)(-1),F=j?"/background-jobs/".concat(j,"/logs"):null,[{data:I,fetching:E},H]=(0,x.aM)({query:g.GG,variables:{ids:[j]},pause:!j}),R=null==I?void 0:null===(n=I.jobRuns)||void 0===n?void 0:null===(t=n.edges)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.node,Y=!!j&&!E&&!(null==R?void 0:R.stdout),{data:M,mutate:T,isLoading:_,isValidating:W}=(0,v.ZP)(F?[F,S+1]:null,e=>{let[t,n]=e;return(0,m.Z)(t,{headers:{Range:"bytes=".concat(n,"-").concat(n+2e4)},responseFormatter:e=>{let t=e.headers.get("Content-Range");if(!t)return null;if(206===e.status){let[n,r]=t.replace(/^bytes\s/,"").split("/"),[s,l]=null==n?void 0:n.split("-");return O.current=parseInt(l),e.text().then(e=>({logs:e,totalBytes:parseInt(r),startByte:parseInt(s),endByte:parseInt(l)}))}},errorHandler:e=>{throw Error(null==e?void 0:e.statusText.toString())}})},{errorRetryCount:1}),Z=_||W;(0,s.useEffect)(()=>{if(M){var e;let t={startByte:M.startByte,endByte:M.endByte,logs:M.logs};B(e=>(0,a.Z)((0,d.Z)((0,c.Z)([t],e),(e,t)=>e.startByte===t.startByte),"startByte")),A.current=null!==(e=null==M?void 0:M.totalBytes)&&void 0!==e?e:0}},[M]);let D=(0,s.useMemo)(()=>{if(null==R?void 0:R.stdout)return null==R?void 0:R.stdout;let e=N.reduce((e,t)=>e+t.logs,"");return function(e){if(!e)return e;let t=e.split("\n"),n=t[t.length-1],r=n.endsWith("\n");return r?t.join("\n"):t.slice(0,-1).join("\n")}(e)},[null==R?void 0:R.stdout,N]),P=(0,w.H)(R),G=!!A.current&&(null===(i=N[N.length-1])||void 0===i?void 0:i.endByte)>=A.current-1;return s.useEffect(()=>{let e;return(null==R?void 0:R.createdAt)&&!(null==R?void 0:R.finishedAt)&&(e=window.setTimeout(()=>{H(),Z||!G&&N.length||T()},5e3)),()=>{e&&clearInterval(e)}},[R,G,null==N?void 0:N.length]),(0,r.jsx)(r.Fragment,{children:E?(0,r.jsx)(y.cg,{}):(0,r.jsx)("div",{className:"flex flex-1 flex-col items-stretch gap-2",children:R&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{onClick:()=>{window.history.length<=1?u.push("/jobs"):u.back()},className:"-ml-1 flex cursor-pointer items-center transition-opacity hover:opacity-60",children:[(0,r.jsx)(p.IconChevronLeft,{className:"mr-1 h-6 w-6"}),(0,r.jsx)("h2",{className:"scroll-m-20 text-3xl font-bold tracking-tight first:mt-0",children:(0,w.Y)(R.job)})]}),(0,r.jsxs)("div",{className:"mb-2 flex gap-x-5 text-sm text-muted-foreground lg:gap-x-10",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.IconStopWatch,{}),(0,r.jsxs)("p",{children:["State: ",P]})]}),R.createdAt&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.IconClock,{}),(0,r.jsxs)("p",{children:["Created:"," ",h()(R.createdAt).format("YYYY-MM-DD HH:mm")]})]}),R.startedAt&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.IconClock,{}),(0,r.jsxs)("p",{children:["Started:"," ",h()(R.startedAt).format("YYYY-MM-DD HH:mm")]})]}),R.createdAt&&R.finishedAt&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.IconHistory,{}),(0,r.jsxs)("p",{children:["Duration:"," ",o()(h().duration(h()(R.finishedAt).diff(R.startedAt)).asMilliseconds())]})]})]}),(0,r.jsx)("div",{className:"flex flex-1 flex-col",children:(0,r.jsx)(k,{value:D,pending:("Pending"===P||"Running"===P)&&!D,children:Y&&!G&&(0,r.jsx)(b.d,{intersectionOptions:{trackVisibility:!0,delay:100,rootMargin:"200px 0px 0px 0px"},itemCount:N.length,onLoad:()=>{if(!Z&&O.current&&O.current+1<A.current){let e=O.current;C(e)}},isFetching:Z,children:(0,r.jsx)("div",{className:"my-8 flex justify-center",children:(0,r.jsx)(p.IconSpinner,{})})})})})]})})})}function k(e){let{children:t,className:n,value:s,pending:l,...u}=e;return(0,r.jsxs)("div",{className:(0,j.cn)("relative mt-2 h-[72vh] w-full overflow-y-auto overflow-x-hidden rounded-lg border bg-gray-50 font-mono text-[0.9rem] dark:bg-gray-800",n),...u,children:[l&&!s&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/60",children:(0,r.jsx)(p.IconSpinner,{className:"h-8 w-8"})}),!!s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("pre",{className:"whitespace-pre-wrap p-4",children:(0,r.jsx)(i.Z,{children:s})}),t]})]})}},17484:function(e,t,n){"use strict";n.d(t,{H:function(){return i},Y:function(){return l}});var r=n(74630);let s={scheduler_git:"Git",scheduler_github_gitlab:"Github / Gitlab",web_crawler:"Docs"};function l(e){return e in s?s[e]:e}function i(e){return e?(0,r.Z)(e.exitCode)?e.startedAt?"Running":"Pending":0===e.exitCode?"Success":"Failed":"Pending"}},54173:function(e,t,n){"use strict";n.d(t,{d:function(){return c}});var r=n(36164),s=n(3546),l=n(76297),i=n(24449),u=n(73492);let o=e=>{let{onLoad:t,isFetching:n,itemCount:o,children:c,className:a,intersectionOptions:d}=e,{ref:f,inView:h}=(0,l.YD)(d),[v,x]=(0,s.useState)(!1),m=(0,i.S)(e=>{x(e)},150);return(0,s.useEffect)(()=>{h&&!v&&(x(!0),t())},[h,v,o]),(0,s.useEffect)(()=>{n||m.run(!1)},[n]),(0,r.jsx)("div",{className:(0,u.cn)("w-full",a),ref:f,children:null!=c?c:(0,r.jsx)("div",{children:"loading..."})})},c=e=>(0,r.jsx)(o,{...e})},90379:function(e,t,n){"use strict";n.d(t,{PF:function(){return o},cg:function(){return i},tB:function(){return u}});var r=n(36164),s=n(73492),l=n(3448);let i=e=>{let{className:t,...n}=e;return(0,r.jsxs)("div",{className:(0,s.cn)("space-y-3",t),...n,children:[(0,r.jsx)(l.O,{className:"h-4 w-full"}),(0,r.jsx)(l.O,{className:"h-4 w-full"}),(0,r.jsx)(l.O,{className:"h-4 w-full"}),(0,r.jsx)(l.O,{className:"h-4 w-full"})]})},u=e=>{let{className:t,...n}=e;return(0,r.jsx)(l.O,{className:(0,s.cn)("h-4 w-full",t),...n})},o=e=>{let{className:t,...n}=e;return(0,r.jsxs)("div",{className:(0,s.cn)("flex flex-col gap-3",t),...n,children:[(0,r.jsx)(l.O,{className:"h-4 w-[20%]"}),(0,r.jsx)(l.O,{className:"h-4 w-full"}),(0,r.jsx)(l.O,{className:"h-4 w-[20%]"}),(0,r.jsx)(l.O,{className:"h-4 w-full"})]})}},3448:function(e,t,n){"use strict";n.d(t,{O:function(){return l}});var r=n(36164),s=n(73492);function l(e){let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,s.cn)("h-4 animate-pulse rounded-md bg-border",t),...n})}},24449:function(e,t,n){"use strict";n.d(t,{S:function(){return u},n:function(){return o}});var r=n(3546),s=n(45391),l=n(16784);let i=e=>{let t=(0,l.d)(e);r.useEffect(()=>()=>{t.current()},[])};function u(e,t,n){let u=(0,l.d)(e),o=r.useMemo(()=>(0,s.Z)(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return u.current(...t)},t,n),[]);return i(()=>{var e;null==n||null===(e=n.onUnmount)||void 0===e||e.call(n,o),o.cancel()}),{run:o,cancel:o.cancel,flush:o.flush}}function o(e,t,n){let[s,l]=r.useState(e),{run:i}=u(()=>{l(e)},t,n);return r.useEffect(()=>{i()},[e]),[s,l]}},16784:function(e,t,n){"use strict";n.d(t,{d:function(){return s}});var r=n(3546);function s(e){let t=r.useRef(e);return t.current=e,t}},3765:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(44745),s=n(57778),l=n(79716),i=n(91302),u=n(66794);async function o(e,t){var n;let r=null!==(n=null==t?void 0:t.customFetch)&&void 0!==n?n:window.fetch;if(function(e){var t;if(e.startsWith("/oauth/providers"))return!1;let n=null===(t=(0,u.bW)())||void 0===t?void 0:t.accessToken,r=(0,u.jW)();if(n)try{let{exp:e}=(0,l.o)(n);return(0,u.pw)(e)}catch(e){return!0}else if(r)return!(null==r?void 0:r.authorization);else return!0}(e))return u.gN.refreshToken(c).then(n=>f(e,t));let s=await r(e,a(t));return 401===s.status?(u.gN.clearAccessToken(),u.gN.refreshToken(c).then(n=>f(e,t))):h(s,t)}async function c(){var e,t;let n=null===(e=(0,u.bW)())||void 0===e?void 0:e.refreshToken;if(!n)return;let r=await d(n);return null==r?void 0:null===(t=r.data)||void 0===t?void 0:t.refreshToken}function a(e){var t,n;let r=new Headers(null==e?void 0:e.headers),s=null===(t=(0,u.bW)())||void 0===t?void 0:t.accessToken,l=(0,u.jW)();if(s)r.append("authorization","Bearer ".concat(null===(n=(0,u.bW)())||void 0===n?void 0:n.accessToken));else if(l){let e={Authorization:"Bearer ".concat(l.authorization),...l.headers},t=Object.keys(e);for(let n of t)r.append(n,e[n])}return{...e||{},headers:r}}async function d(e){let t=new r.KU({url:"/graphql",requestPolicy:"network-only",exchanges:[r.Ek]}),n=t.createRequestOperation("mutation",(0,s.h)(i.Dp,{refreshToken:e}));return t.executeMutation(n)}function f(e,t){var n;let r=null!==(n=null==t?void 0:t.customFetch)&&void 0!==n?n:window.fetch;return r(e,a(t)).then(e=>h(e,t))}function h(e,t){return(null==e?void 0:e.ok)?(null==t?void 0:t.responseFormatter)?t.responseFormatter(e):(null==t?void 0:t.responseFormat)==="blob"?e.blob():e.json():(null==t?void 0:t.errorHandler)?t.errorHandler(e):void 0}}},function(e){e.O(0,[7565,8415,4691,55,436,9906,1454,7070,2529,9561,3492,1565,410,3396,3375,5289,1744],function(){return e(e.s=93634)}),_N_E=e.O()}]);