(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1929],{36865:function(e,n,t){Promise.resolve().then(t.bind(t,32093))},32093:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return nd}});var s=t(36164),l=t(3546),a=t(42891),r=t.n(a),i=t(11978),o=t(23342),d=t(94755),c=t(47190),u=t.n(c),m=t(42450),h=t(36982),x=t(17734);t(76904);let f="0.10.0";var v=t(94974),p=t(31458),g=t(81565),j=t(1853),y=t(78613),N=t(82157),b=t(77735),w=t(66035),C=t(70783),k=t(40055),I=t(21808),S=t(18500),R=t(24449),M=t(16784),L=t(31159),T=t(64566),E=t(63484),A=t(17451),D=t(70410),F=t(73492),Z=t(66790),U=t(6230),_=t(17448),V=t(54767),O=t(28445),P=t(84837),K=t(2578),z=t(28312),q=t(11634),H=t(63795),B=t(72657),J=t(77246),W=t(53863),G=t(94160),Q=t(50292),$=t(59105),Y=t(2435),X=t(19092);t(67325);var ee=t(12978),en=t(31022),et=t(70834),es=t(63057),el=t(31745),ea=t(89502),er=t(65063),ei=t(74787);let eo=e=>{let{node:n}=e,{category:t,label:l}=n.attrs;return(0,s.jsx)(Y.T5,{as:"span",className:"rounded-sm px-1",children:(0,s.jsxs)("span",{className:(0,F.cn)("space-x-0.5 whitespace-nowrap rounded bg-muted px-1.5 py-0.5 align-middle text-sm font-medium text-foreground"),"data-category":t,children:["file"===t?(0,s.jsx)(es.Z,{className:"relative -top-px inline-block h-3.5 w-3.5"}):"symbol"===t?(0,s.jsx)(el.Z,{className:"relative -top-px inline-block h-3.5 w-3.5"}):(0,s.jsx)(ea.Z,{className:"relative -top-px inline-block h-3.5 w-3.5"}),(0,s.jsx)("span",{className:"relative whitespace-normal",children:l})]})})},ed=W.ZP.extend({addNodeView:()=>(0,Y.fW)(eo),renderText(e){let{node:n}=e,t=n.attrs.category;switch(t){case"command":return"[[contextCommand:".concat(n.attrs.command||"default","]]");case"symbol":return"[[symbol:".concat(JSON.stringify(n.attrs.fileItem),"]]");default:let s=n.attrs.fileItem,l=s.filepath;return"[[file:".concat(JSON.stringify(l),"]]")}},addAttributes:()=>({id:{default:null,parseHTML:e=>e.getAttribute("data-file"),renderHTML:e=>e.fileItem?{"data-id":JSON.stringify(e.fileItem.filepath)}:{}},fileItem:{default:null,parseHTML:e=>e.getAttribute("data-file"),renderHTML:e=>e.fileItem?{"data-file":e.fileItem}:{}},category:{default:"file",parseHTML:e=>e.getAttribute("data-category"),renderHTML:e=>e.category?{"data-category":e.category}:{}},command:{default:null,parseHTML:e=>e.getAttribute("data-command"),renderHTML:e=>e.command?{"data-command":e.command}:{}},label:{default:"",parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}})}),ec=(0,l.forwardRef)((e,n)=>{let{items:t,command:a,query:r,listFileInWorkspace:i,listSymbols:o,getChanges:d}=e,[c,u]=(0,l.useState)(t),[m,h]=(0,l.useState)(0),[x,f]=(0,l.useState)("category"),[v,p]=(0,l.useState)(!1),[j]=(0,R.n)(v,100),[y,N]=(0,l.useState)(!0),[b]=(0,R.n)(r||"",150),w=(0,l.useRef)(null),C=(0,l.useMemo)(()=>{let e=[i&&{label:"Files",categoryKind:"file",icon:(0,s.jsx)(es.Z,{className:"h-4 w-4"})},o&&{label:"Symbols",categoryKind:"symbol",icon:(0,s.jsx)(el.Z,{className:"h-4 w-4"})}].filter(Boolean);return 1===e.length&&f(e[0].categoryKind),e},[i,o]),k=1===C.length,I=!k&&"category"===x,S=(0,l.useCallback)(async()=>{p(!0);try{var e;let n=y?r:b;w.current&&(w.current.isCurrent=!1);let t=(async()=>{let e=[];if(I){let t=await (null==i?void 0:i({query:n||""}))||[];if(n){let s=d?[(0,ei.K)((0,ei.GV)())]:[],l=t.map(ei.Gn);e=d&&(0,ei.GV)().name.toLowerCase().startsWith(n.toLowerCase())?[...s,...l]:l}else e=[...C.map(e=>({id:e.categoryKind,name:e.label,category:"category",isRootCategoryItem:!0,fileItem:{},icon:e.icon})),...d?[(0,ei.K)((0,ei.GV)())]:[],...t.map(ei.Gn)]}else if("file"===x){let t=await (null==i?void 0:i({query:n}))||[];e=t.map(ei.Gn)}else{let t=await (null==o?void 0:o({query:n}))||[];e=(0,ee.Z)(t.map(ei.xe),"id")}return e})();t.isCurrent=!0,w.current=t;let s=await t,l=s.map(e=>{if("file"===e.category&&e.fileItem)try{let n=(0,F.eo)(e.fileItem.filepath);e.description=function(e){if(!e||!e.filepath)return"";if(e.gitUrl){let n=function(e){if(!e)return"";try{if(e.includes("@")&&e.includes(":")){let n=e.split(":");if(n.length>1){let e=n[1].split("/"),t=e[e.length-1]||"";return t.replace(/\.git$/,"")}}else try{if(e.includes("?"))return"";let n=new URL(e),t=n.pathname.split("/").filter(Boolean);if(t.length>0){let e=t[t.length-1];return e.replace(/\.git$/,"")}}catch(e){}return""}catch(e){return""}}(e.gitUrl);if(n)return"".concat(n," - ").concat(e.filepath)}if(e.baseDir){let n=e.baseDir.split("/").pop()||e.baseDir;return"".concat(n," - ").concat(e.filepath)}return e.filepath}(n)}catch(e){}return e});(null===(e=w.current)||void 0===e?void 0:e.isCurrent)&&(u(l),h(0),p(!1),y&&N(!1))}catch(e){p(!1)}},[C,b,y,i,o,d,x,r,I]);(0,l.useEffect)(()=>{S()},[x,r,b,y,I,S]),(0,l.useEffect)(()=>()=>{w.current&&(w.current.isCurrent=!1)},[]);let M=e=>{if(e.isRootCategoryItem&&!k){f(e.id);return}if("command"===e.category){a({category:"command",command:e.name,label:e.name});return}let n="file"===e.category?(0,F.UA)((0,F.eo)(e.fileItem.filepath).filepath||""):e.name;a({category:e.category,fileItem:e.fileItem,label:n})};return(0,l.useImperativeHandle)(n,()=>({onKeyDown:e=>{let{event:n}=e;if(v)return!1;let t=c.length-1,s=m;switch(n.key){case"ArrowUp":s=Math.max(0,m-1);break;case"ArrowDown":s=Math.min(t,m+1);break;case"Enter":return c[m]&&(M(c[m]),c[m].isRootCategoryItem&&h(0)),!0;default:return!1}return h(s),!0}})),(0,s.jsxs)("div",{className:"relative flex max-h-[300px] w-[80vw] flex-col overflow-hidden rounded-md border bg-background p-1 sm:w-[420px]",children:[j&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/80",children:(0,s.jsx)(er.Z,{className:"h-6 w-6 animate-spin"})}),!k&&"category"!==x&&(0,s.jsxs)("div",{className:"flex items-center p-1 text-sm text-muted-foreground",children:[(0,s.jsx)("button",{className:"mr-2 rounded p-1 hover:bg-accent",onClick:()=>f("category"),children:(0,s.jsx)(g.IconChevronLeft,{className:"h-4 w-4"})}),"file"===x?"Files":"Symbols"]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===c.length?(0,s.jsx)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:r?"No results found":"Type to search..."}):(0,s.jsx)("div",{className:"grid gap-0.5",children:c.map((e,n)=>(0,s.jsx)(eu,{onClick:()=>M(e),onMouseEnter:()=>h(n),title:e.name,isSelected:n===m,data:e},"".concat(e.id,"-").concat(n)))})})]})});function eu(e){let{isSelected:n,data:t,...a}=e,r=(0,l.useRef)(null),i=(0,l.useMemo)(()=>(0,F.Cn)(t.filepath||""),[t.filepath]);return(0,l.useLayoutEffect)(()=>{if(n&&r.current){var e;null===(e=r.current)||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}},[n]),(0,s.jsxs)("div",{className:(0,F.cn)("flex cursor-pointer flex-nowrap items-center gap-1 overflow-hidden rounded-md px-2 py-1.5 text-sm",{"bg-accent text-accent-foreground":n}),...a,ref:r,children:[(0,s.jsx)("span",{className:"flex h-5 shrink-0 items-center",children:t.icon}),(0,s.jsx)("span",{className:"mr-2 truncate whitespace-nowrap",children:t.name}),t.description&&(0,s.jsx)("span",{className:"flex-1 truncate text-xs text-muted-foreground",children:t.description}),"file"===t.category&&!t.description&&(0,s.jsx)("span",{className:"flex-1 truncate text-xs text-muted-foreground",children:i}),"category"===t.category&&(0,s.jsx)(g.IconChevronRight,{className:"h-4 w-4 text-muted-foreground"})]})}ec.displayName="MentionList";let em=l.forwardRef((e,n)=>{let{onSubmit:t,isLoading:a,onUpdate:r,className:i,...o}=e,{listFileInWorkspace:d,readFileContent:c,relevantContext:u,setRelevantContext:m,listSymbols:h,getChanges:x}=(0,l.useContext)(_.p),{selectedModel:f,models:v}=(0,L.Vq)(),j=(0,l.useRef)([]),y=(0,M.d)(async()=>{if(a||!b)return;let e=b.getText({blockSeparator:I.rZ}).trim();if(!e)return;let n=t(e);return null==b||b.chain().clearContent().focus().run(),n}),N=()=>{y.current()},b=(0,Y.jE)({extensions:[J.Z,G.Z,$.Z,Q.Z.configure({placeholder:d?"Ask anything, @ to mention":"Ask anything ..."}),X.hj.create({addKeyboardShortcuts(){return{Enter:e=>{let{editor:n}=e;return N(),!0},"Shift-Enter":()=>this.editor.commands.first(e=>{let{commands:n}=e;return[()=>n.newlineInCode(),()=>n.createParagraphNear(),()=>n.liftEmptyBlock(),()=>n.splitBlock()]})}}}),ed.configure({deleteTriggerWithBackspace:!0,suggestion:{allow:e=>{let{state:n,range:t}=e,s=n.doc.resolve(t.from),l=n.schema.nodes[W.ZP.name],a=!!s.parent.type.contentMatch.matchType(l);return!!d&&a},char:"@",items:async e=>{let{query:n}=e;if(!d)return[];let t=await d({query:n}),s=[...h?[null!=h?h:{id:"category",name:"Files",category:"category"},{id:"category",name:"Symbols",category:"category"}]:[]];return x&&(!n||"changes".includes(n.toLowerCase()))&&s.push({id:"command",name:"changes",category:"command"}),s.push(...(0,ee.Z)(t.map(ei.Gn),"id")),s},render:()=>{let e,n;return{onStart:t=>{e=new Y.M_(ec,{props:{...t,listFileInWorkspace:d,listSymbols:h,getChanges:x},editor:t.editor}),t.clientRect&&(n=(0,en.ZP)("body",{getReferenceClientRect:t.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"top-start",animation:"shift-away",maxWidth:"90%"}))},onUpdate:n=>{e.updateProps(n)},onExit:()=>{n[0].destroy(),e.destroy()},onKeyDown:t=>{var s,l;return"Escape"===t.event.key?(n[0].hide(),!0):null!==(l=null===(s=e.ref)||void 0===s?void 0:s.onKeyDown(t))&&void 0!==l&&l}}}}})],editorProps:{attributes:{class:(0,F.cn)("prose min-h-[3.5em] font-sans dark:prose-invert focus:outline-none prose-p:my-0")}},onCreate(e){let{editor:n}=e;j.current=(0,ei.U7)(n)},onUpdate(e){null==r||r(e)}},[d,x]),w=(null==b?void 0:b.getText())||"",C=e=>{b&&b.chain().focus().command(n=>{var t,s,l;let{tr:a,state:r}=n,{$from:i}=r.selection,o=0===i.parentOffset,d=null!==(l=null===(s=i.nodeBefore)||void 0===s?void 0:null===(t=s.text)||void 0===t?void 0:t.endsWith(" "))&&void 0!==l&&l;return o||d?a.insertText(e):a.insertText(" "+e),!0}).run()};return(0,l.useImperativeHandle)(n,()=>({focus:()=>null==b?void 0:b.commands.focus(),setInput:e=>null==b?void 0:b.commands.setContent(e),input:w,editor:b}),[b,w]),(0,s.jsxs)("div",{className:(0,F.cn)("relative flex flex-col",i),...o,children:[(0,s.jsx)("div",{className:"relative flex items-start gap-1.5",children:(0,s.jsx)("div",{className:"max-h-32 flex-1 overflow-y-auto py-3",onClick:()=>{b&&!b.isFocused&&(null==b||b.commands.focus())},children:(0,s.jsx)(Y.kg,{editor:b,className:(0,F.cn)("prose overflow-hidden break-words text-foreground focus:outline-none")})})}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"-ml-1.5 flex items-center gap-2",children:[!!d&&(0,s.jsx)(p.z,{variant:"ghost",className:"h-auto shrink-0 gap-2 p-1.5 text-foreground/90",onClick:e=>C("@"),children:(0,s.jsx)(g.IconAtSign,{})}),(0,s.jsx)(et.q,{models:v,value:f,onChange:e=>{(0,A.Eg)(e),setTimeout(()=>{null==b||b.chain().focus().run()})},triggerClassName:"gap-1 py-1 h-auto"})]}),(0,s.jsx)(p.z,{className:"h-6 w-6",size:"icon",disabled:a||""===w,onClick:N,children:(0,s.jsx)(g.IconArrowRight,{className:"h-3 w-3"})})]})]})});em.displayName="PromptForm";var eh=t(29),ex=t(36065),ef=t(84942),ev=t(3448),ep=t(37034);function eg(e){let{repos:n,value:t,onChange:a,isInitializing:r,...i}=e,[o,d]=(0,l.useState)(!1),c=(0,l.useRef)(null),u=e=>{a(e)},m=()=>{requestAnimationFrame(()=>{c.current&&(c.current.scrollTop=0)})},h=t?null==n?void 0:n.find(e=>e.sourceId===t):void 0,x=null==h?void 0:h.sourceName;return r||(null==n?void 0:n.length)?(0,s.jsx)("div",{...i,children:(0,s.jsx)(U.Z,{loading:r,fallback:(0,s.jsx)("div",{className:"w-full pl-2",children:(0,s.jsx)(ev.O,{className:"h-3 w-[10rem]"})}),children:(0,s.jsxs)(ef.J2,{open:o,onOpenChange:d,children:[(0,s.jsxs)(H.C,{variant:"outline",className:(0,F.cn)("h-7 w-full items-center gap-1 overflow-hidden break-all rounded-md px-0 text-sm font-semibold hover:bg-muted/50",{"border-dashed text-muted-foreground italic":!h}),children:[(0,s.jsx)(ef.xo,{className:"outline-none",asChild:!0,children:(0,s.jsxs)("div",{className:(0,F.cn)("flex flex-1 cursor-pointer items-center gap-1.5 overflow-hidden pl-2.5",{"min-w-[10rem]":!h}),children:[h?(0,s.jsx)(ep.k,{kind:h.sourceKind,className:"h-3.5 w-3.5 shrink-0"}):(0,s.jsx)(g.IconFolderGit,{className:"shrink-0"}),(0,s.jsx)("div",{className:"flex flex-1 items-center gap-1.5 truncate break-all",children:(0,s.jsx)("span",{className:(0,F.cn)("truncate",{"text-muted-foreground":!x}),children:x||"Workspace"})}),!t&&(0,s.jsx)("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center text-foreground",children:(0,s.jsx)(g.IconChevronUpDown,{})})]})}),!!t&&(0,s.jsx)(p.z,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 rounded-l-none bg-background hover:bg-muted/50",onClick:e=>{e.stopPropagation(),a(void 0)},children:(0,s.jsx)(g.IconRemove,{})})]}),(0,s.jsx)(ef.yk,{side:"top",align:"start",className:"dropdown-menu w-[80vw] overflow-x-hidden rounded-md border bg-popover p-2 text-popover-foreground shadow animate-in",children:(0,s.jsxs)(ex.mY,{children:[(0,s.jsx)(ex.sZ,{placeholder:"Select repository ...",onValueChange:()=>{m()}}),(0,s.jsxs)(ex.e8,{className:"max-h-[30vh]",ref:c,children:[(0,s.jsx)(ex.rb,{children:"No repository found"}),(0,s.jsx)(ex.fu,{children:null==n?void 0:n.map(e=>{let n=e.sourceId===t;return(0,s.jsxs)(ex.di,{onSelect:()=>{u(e.sourceId),d(!1)},title:e.sourceName,className:"cursor-pointer",children:[(0,s.jsx)(g.IconCheck,{className:(0,F.cn)("mr-1 shrink-0",e.sourceId===t?"opacity-100":"opacity-0")}),(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-1 overflow-x-hidden",children:[(0,s.jsx)(ep.k,{kind:e.sourceKind,className:"shrink-0"}),(0,s.jsx)("div",{className:(0,F.cn)("truncate font-medium",{"font-semibold":n}),children:e.sourceName})]})]},e.sourceId)})})]})]})})]})})}):null}let ej=l.forwardRef((e,n)=>{var t;let{stop:a,reload:r,className:i,onSubmit:o,onUpdate:c,chatInputRef:u}=e,{threadId:m,container:h,onClearMessages:x,qaPairs:f,isLoading:v,relevantContext:y,activeSelection:N,onCopyContent:b,selectedRepoId:w,setSelectedRepoId:C,repos:k,initialized:S,setRelevantContext:R,openInEditor:L}=l.useContext(_.p),T=(0,A.aK)(e=>e.enableActiveSelection),[E,Z]=(0,l.useState)(!1),{width:U}=(0,d.iP)(),J="number"==typeof U&&U<376,W=(0,l.useMemo)(()=>{var e;if(!m)return"";let n=null===(e=f[0])||void 0===e?void 0:e.user.content;if(!n)return m;let t=(0,F.i8)([],n,{maxLength:I.$I}),s=(0,V.Z)(t),l=(0,j.Z)([s,m]).join("-");return l},[null===(t=f[0])||void 0===t?void 0:t.user.content,m]),G=(0,q.Db)(D.md,{onError(e){K.A.error(e.message)}}),{isCopied:Q,copyToClipboard:$}=(0,z.m)({timeout:2e3,onCopyContent:b}),Y=async()=>{if(m&&!Q&&!E)try{var e,n;Z(!0);let t=await G({threadId:m});if(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.setThreadPersisted){let e=new URL(window.location.origin);e.pathname="/search/".concat(W),$(e.toString())}else K.A.error((null==t?void 0:null===(n=t.error)||void 0===n?void 0:n.message)||"Failed to share")}catch(e){}finally{Z(!1)}},X=(0,M.d)(e=>{var n;let t=null===(n=u.current)||void 0===n?void 0:n.editor;t&&(R(n=>n.filter((n,t)=>t!==e)),t.commands.focus())});return l.useImperativeHandle(n,()=>{var e,n;return{focus:()=>{var e;null===(e=u.current)||void 0===e||e.focus()},setInput:e=>{var n;null===(n=u.current)||void 0===n||n.setInput(e)},input:null!==(n=null===(e=u.current)||void 0===e?void 0:e.input)&&void 0!==n?n:""}},[u]),(0,s.jsxs)("div",{className:i,children:[(0,s.jsx)(B.K,{container:h}),(0,s.jsxs)("div",{className:"mx-auto max-w-5xl px-[16px]",children:[(0,s.jsxs)("div",{className:(0,F.cn)("mb-1 flex h-10 items-center justify-center",J?"gap-3":"gap-2"),children:[v?(0,s.jsxs)(eh.u,{children:[(0,s.jsx)(eh.aJ,{asChild:!0,children:(0,s.jsxs)(p.z,{variant:"outline",onClick:()=>a(),className:"gap-2 bg-background",children:[(0,s.jsx)(g.IconStop,{}),!J&&"Stop generating"]})}),(0,s.jsx)(eh._v,{hidden:!J,children:"Stop generating"})]}):(null==f?void 0:f.length)>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eh.u,{children:[(0,s.jsx)(eh.aJ,{asChild:!0,children:(0,s.jsxs)(p.z,{variant:"outline",onClick:()=>r(),className:"gap-2 bg-background",children:[(0,s.jsx)(g.IconRefresh,{}),!J&&"Regenerate"]})}),(0,s.jsx)(eh._v,{hidden:!J,children:"Regenerate"})]}),(0,s.jsxs)(eh.u,{children:[(0,s.jsx)(eh.aJ,{asChild:!0,children:(0,s.jsxs)(p.z,{variant:"outline",className:"gap-2 bg-background",onClick:Y,children:[Q?(0,s.jsx)(g.IconCheck,{}):(0,s.jsx)(g.IconShare,{}),!J&&"Share"]})}),(0,s.jsx)(eh._v,{hidden:!J,children:"Share"})]})]}),(null==f?void 0:f.length)>0&&(0,s.jsxs)(eh.u,{children:[(0,s.jsx)(eh.aJ,{asChild:!0,children:(0,s.jsxs)(p.z,{variant:"outline",onClick:x,className:"gap-2 bg-background",children:[(0,s.jsx)(g.IconTrash,{}),!J&&"Clear"]})}),(0,s.jsx)(eh._v,{hidden:!J,children:"Clear"})]})]}),(0,s.jsxs)("div",{id:"chat-panel-container",className:"rounded-md border bg-background px-4 pb-1.5 pt-3 outline-none transition-shadow duration-300 focus-within:ring-1 focus-within:!ring-ring hover:ring-1 hover:ring-ring/60 focus-visible:ring-offset-2",children:[(0,s.jsxs)("div",{className:"flex w-full flex-wrap gap-1.5",children:[(0,s.jsx)(eg,{id:"repo-select",className:"overflow-hidden",value:w,onChange:e=>{C(e),setTimeout(()=>{var e;null===(e=u.current)||void 0===e||e.focus()})},repos:k,isInitializing:!S}),N?(0,s.jsxs)(H.C,{id:"active-selection-badge",variant:"outline",className:(0,F.cn)("inline-flex h-7 flex-nowrap items-center gap-1.5 overflow-hidden rounded-md border pr-0 text-sm font-semibold",{"border-dashed !text-muted-foreground italic line-through":!T}),children:["file"===N.kind&&(0,s.jsx)(g.IconFileText,{className:"shrink-0"}),"terminal"===N.kind&&(0,s.jsx)(g.IconTerminalSquare,{className:"shrink-0"}),(0,s.jsx)(ey,{context:N,className:"flex-1 truncate"}),(0,s.jsx)("span",{className:"shrink-0 text-muted-foreground",children:"Current file"}),(0,s.jsx)(p.z,{size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 rounded-l-none hover:bg-muted/50",onClick:e=>{(0,A.qs)(!T)},children:T?(0,s.jsx)(g.IconEye,{}):(0,s.jsx)(g.IconEyeOff,{})})]}):null,(0,s.jsx)(O.M,{children:y.map((e,n)=>{var t,l;let a="file"===e.kind?"".concat(e.gitUrl,"_").concat(e.filepath,"_").concat(null===(t=e.range)||void 0===t?void 0:t.start,"_").concat(null===(l=e.range)||void 0===l?void 0:l.end):"".concat(e.name,"_").concat(e.processId,"_").concat(e.selection.length,"_").concat(n);return(0,s.jsx)(P.E.div,{initial:{opacity:0,scale:.9,y:-5},animate:{opacity:1,scale:1,y:0},transition:{ease:"easeInOut",duration:.1},exit:{opacity:0,scale:.9,y:-5},layout:!0,className:"overflow-hidden",children:(0,s.jsxs)(H.C,{variant:"outline",className:(0,F.cn)("inline-flex h-7 w-full cursor-pointer flex-nowrap items-center gap-1 overflow-hidden rounded-md pr-0 text-sm font-semibold"),onClick:()=>{"file"===e.kind&&L((0,F.Uw)(e))},children:["file"===e.kind&&(0,s.jsx)(g.IconFileText,{className:"shrink-0"}),"terminal"===e.kind&&(0,s.jsx)(g.IconTerminalSquare,{className:"shrink-0"}),(0,s.jsx)(ey,{context:e}),(0,s.jsx)(p.z,{size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 rounded-l-none hover:bg-muted/50",onClick:e=>{e.stopPropagation(),X.current(n)},children:(0,s.jsx)(g.IconRemove,{})})]})},a)})})]}),(0,s.jsx)(em,{ref:u,onSubmit:o,onUpdate:c,isLoading:v})]})]})]})});function ey(e){let{context:n,className:t}=e;if("terminal"===n.kind){var l;return(0,s.jsx)("span",{className:(0,F.cn)("truncate",t),title:n.selection,children:(0,s.jsx)("span",{className:"text-muted-foreground",children:null!==(l=n.name)&&void 0!==l?l:"Terminal Selection"})})}let a=n.range?n.range.start===n.range.end?":".concat(n.range.start):":".concat(n.range.start,"-").concat(n.range.end):"";return(0,s.jsxs)("span",{className:(0,F.cn)("truncate",t),children:[(0,F.UA)(n.filepath),!!n.range&&(0,s.jsx)("span",{className:"text-muted-foreground",children:a})]})}ej.displayName="ChatPanel";var eN=t(76297),eb=t(12624);function ew(e){let{trackVisibility:n}=e,{container:t}=l.useContext(_.p),a=(0,eb.e)(100,t),{ref:r,entry:i,inView:o}=(0,eN.YD)({trackVisibility:n,delay:100,rootMargin:"0px 0px -150px 0px",root:t});return l.useEffect(()=>{a&&n&&!o&&(null==i||i.target.scrollIntoView({block:"start"}))},[o,i,a,n]),(0,s.jsx)("div",{ref:r,className:"h-px w-full"})}var eC=t(83171);function ek(e){var n,t,l;let{data:a,sources:r,fetchingSources:i,onNavigate:o,onDeleteThread:d}=e,c=a.node.id,[{data:u,fetching:m}]=(0,k.aM)({query:D.r4,variables:{first:1,threadId:c}}),h=null==u?void 0:null===(n=u.threadMessages)||void 0===n?void 0:n.edges;return m||(null==h?void 0:h.length)?(0,s.jsx)("div",{onClick:e=>o(a.node.id),className:"group cursor-pointer overflow-hidden rounded-md bg-background/70 px-4 py-3 transition-colors hover:bg-accent/60",children:(0,s.jsxs)("div",{className:"flex flex-nowrap justify-between gap-2 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,s.jsx)(U.Z,{loading:m||i,fallback:(0,s.jsx)("div",{className:"w-full py-1.5",children:(0,s.jsx)(ev.O,{className:"w-[60%]"})}),children:(0,s.jsx)(eC.fh,{className:"break-anywhere truncate text-base font-medium text-foreground/90",sources:r,message:(0,ei.HV)(null!==(l=null==h?void 0:null===(t=h[0])||void 0===t?void 0:t.node.content)&&void 0!==l?l:"")})}),(0,s.jsx)("div",{className:"mt-1 truncate whitespace-nowrap text-xs text-muted-foreground",children:(0,F.sx)(a.node.createdAt,"Asked")})]}),!!d&&(0,s.jsx)(p.z,{size:"icon",variant:"hover-destructive",className:"hidden shrink-0 p-0 group-hover:flex",onClick:e=>{e.stopPropagation(),d(a.node.id)},children:(0,s.jsx)(g.IconTrash,{})})]})}):null}let eI=[{heading:"Convert list of string to numbers",message:"How to convert a list of string to numbers in python"},{heading:"How to parse email address",message:"How to parse email address with regex"}];function eS(e){var n;let{setInput:t,welcomeMessage:a,setShowHistory:r,onSelectThread:i}=e,{contextInfo:o,fetchingContextInfo:d}=(0,l.useContext)(_.p),[{data:c}]=(0,k.aM)({query:D.rm,variables:{last:5}}),u=(0,l.useMemo)(()=>{var e,n;return null==c?void 0:null===(n=c.myThreads)||void 0===n?void 0:null===(e=n.edges)||void 0===e?void 0:e.slice(-5).reverse()},[null==c?void 0:null===(n=c.myThreads)||void 0===n?void 0:n.edges]),m=e=>{i(e),r(!1)};return(0,s.jsxs)("div",{className:"mx-auto max-w-5xl",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"mb-2 text-2xl font-semibold",children:a||"Welcome"}),(0,s.jsx)("p",{className:"leading-normal text-muted-foreground",children:"You can start a conversation here or try the following examples:"}),(0,s.jsx)("div",{className:"mt-4 flex flex-col items-start space-y-2",children:eI.map((e,n)=>(0,s.jsxs)(p.z,{variant:"link",className:"h-auto p-0 text-base",onClick:()=>t(e.message),children:[(0,s.jsx)(g.IconArrowRight,{className:"mr-2 text-muted-foreground"}),(0,s.jsx)("p",{className:"text-left",children:e.heading})]},n))})]}),!!(null==u?void 0:u.length)&&(0,s.jsxs)("div",{className:"mt-10",children:[(0,s.jsx)("div",{className:"mb-3 flex items-center gap-2",children:(0,s.jsx)("span",{className:"text-lg font-semibold",children:"Recent Activities"})}),(0,s.jsx)("div",{className:"space-y-4",children:null==u?void 0:u.map(e=>(0,s.jsx)(ek,{data:e,onNavigate:m,sources:null==o?void 0:o.sources,fetchingSources:d},e.node.id))}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)(p.z,{size:"sm",variant:"ghost",onClick:e=>r(!0),className:"mt-4 text-foreground/70",children:"View all history"})})]})]})}var eR=t(94909),eM=t(74630),eL=t(74038),eT=t(93877),eE=t(98454),eA=t(21008),eD=t(48537),eF=t(22507),eZ=t(11208),eU=t(52569),e_=t(65858);let eV=(0,l.forwardRef)((e,n)=>{var t,a;let{contexts:r,clientContexts:i,className:o,triggerClassname:d,onContextClick:c,enableTooltip:u,onTooltipClick:m,highlightIndex:h,showExternalLink:x,showClientCodeIcon:f,supportsOpenInEditor:v,title:p}=e,g=null!==(t=null==r?void 0:r.length)&&void 0!==t?t:0,j=null!==(a=null==i?void 0:i.length)&&void 0!==a?a:0,y=g+j,N=y>1,[b,w]=(0,l.useState)(y<=5?"references":void 0);return((0,l.useEffect)(()=>{y<=5?w("references"):w(void 0)},[y]),y)?(0,s.jsx)(e_.UQ,{type:"single",collapsible:!0,className:(0,F.cn)("bg-transparent text-foreground",o),ref:n,value:b,onValueChange:w,children:(0,s.jsxs)(e_.Qd,{value:"references",className:"my-0 border-0",children:[(0,s.jsx)(e_.o4,{className:(0,F.cn)("my-0 py-2 font-semibold outline-none focus-visible:ring-1 focus-visible:ring-ring",d),children:p||(0,s.jsx)("span",{className:"mr-2",children:"Read ".concat(y," file").concat(N?"s":"")})}),(0,s.jsxs)(e_.vF,{className:"space-y-2",children:[null==i?void 0:i.map((e,n)=>"terminal"===e.kind?(0,s.jsx)(eP,{context:e},"client-terminal-".concat(n)):(0,s.jsx)(eO,{context:e,onContextClick:e=>null==c?void 0:c(e,!0),isHighlighted:h===n,clickable:v,showClientCodeIcon:f},"user-".concat(n))),r.map((e,n)=>"terminal"===e.kind?(0,s.jsx)(eP,{context:e},"terminal-".concat(n)):(0,s.jsx)(eO,{context:e,onContextClick:e=>null==c?void 0:c(e,!1),enableTooltip:u,onTooltipClick:m,showExternalLinkIcon:x,isHighlighted:h===n+((null==i?void 0:i.length)||0)},"assistant-".concat(n)))]})]})}):null});function eO(e){var n,t,a,r,i,o,d;let{context:c,clickable:u=!0,onContextClick:m,enableTooltip:h,onTooltipClick:x,showExternalLinkIcon:f,showClientCodeIcon:v,isHighlighted:p}=e,[j,y]=(0,l.useState)(!1),N=c.range&&!(0,eM.Z)(null===(n=c.range)||void 0===n?void 0:n.start)&&!(0,eM.Z)(null===(t=c.range)||void 0===t?void 0:t.end)&&c.range.start<c.range.end,b=(0,F.Cn)(c.filepath),w=null==c?void 0:null===(a=c.extra)||void 0===a?void 0:a.scores;return(0,s.jsxs)(eh.u,{open:j,onOpenChange:e=>{h&&w&&y(e)},delayDuration:0,children:[(0,s.jsx)(eh.aJ,{asChild:!0,children:(0,s.jsx)("div",{className:(0,F.cn)("rounded-md border p-2",{"cursor-pointer hover:bg-accent":u,"cursor-default pointer-events-auto":!u,"bg-accent transition-all":p}),onClick:e=>u&&(null==m?void 0:m(c)),children:(0,s.jsxs)("div",{className:"flex items-center gap-1 overflow-hidden",children:[(0,s.jsx)(g.IconFile,{className:"shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 truncate",title:c.filepath,children:[(0,s.jsx)("span",{children:(0,F.UA)(c.filepath)}),c.range?(0,s.jsxs)(s.Fragment,{children:[(null===(r=c.range)||void 0===r?void 0:r.start)&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:[":",c.range.start]}),N&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:["-",c.range.end]})]}):null,(0,s.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:b})]}),v&&(0,s.jsx)(g.IconFileSearch2,{className:"shrink-0 text-muted-foreground"}),f&&(0,s.jsx)(g.IconExternalLink,{className:"shrink-0 text-muted-foreground"})]})})}),(0,s.jsx)(eh._v,{align:"start",onClick:x,className:"cursor-pointer p-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-2 font-semibold",children:"Scores"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"rrf:"}),null!==(i=null==w?void 0:w.rrf)&&void 0!==i?i:"-"]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"bm25:"}),null!==(o=null==w?void 0:w.bm25)&&void 0!==o?o:"-"]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"embedding:"}),null!==(d=null==w?void 0:w.embedding)&&void 0!==d?d:"-"]})]})]})})]})}eV.displayName="CodeReferences";let eP=e=>{var n;let{context:t}=e;return(0,s.jsx)("div",{className:"rounded-md border p-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-1 overflow-hidden",children:[(0,s.jsx)(g.IconTerminalSquare,{className:"shrink-0"}),(0,s.jsx)("div",{className:"flex-1 truncate",title:t.selection,children:(0,s.jsx)("span",{children:null!==(n=t.name)&&void 0!==n?n:"Terminal Selection"})})]})})};var eK=t(90615),ez=t(64219),eq=t(89811);function eH(e){let{isLoading:n,children:t,title:a,defaultOpen:r,isLastItem:i,triggerClassname:o}=e,d="item",[c,u]=(0,l.useState)(!!r),m=!!t;return(0,l.useEffect)(()=>{m&&!c&&u(!0)},[m]),(0,s.jsx)("div",{children:(0,s.jsx)(e_.UQ,{type:"single",value:c?d:"",collapsible:m,className:"z-10",onValueChange:e=>{u(e===d)},children:(0,s.jsxs)(e_.Qd,{value:d,className:"relative border-0",children:[(!i||c&&m)&&(0,s.jsx)("div",{className:"absolute left-2 top-5 block h-full w-0.5 shrink-0 translate-x-px rounded-full bg-muted"}),(0,s.jsx)(e_.o4,{className:(0,F.cn)("group w-full gap-2 rounded-lg py-1 pl-0.5 pr-2 !no-underline hover:bg-accent/70",o),showChevron:!!t,children:(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-4 overflow-x-hidden",children:[(0,s.jsx)("div",{className:"relative z-10 shrink-0 ",children:n?(0,s.jsx)(g.IconSpinner,{}):(0,s.jsx)(g.IconCheckFull,{className:"h-4 w-4"})}),(0,s.jsx)("span",{className:"truncate",children:a})]})}),!!t&&(0,s.jsx)(e_.vF,{className:"pb-0 pl-9",children:t})]})})})}function eB(e){var n,t;let{codeSourceId:l,isReadingDocs:a,readingDoc:r,docQuerySources:i,webDocs:o,pages:d,openExternal:c}=e,u=null!==(n=null==o?void 0:o.length)&&void 0!==n?n:0,m=null!==(t=null==d?void 0:d.length)&&void 0!==t?t:0,h=u+m,x=(null==r?void 0:r.sourceIds.includes("page"))||!!(null==d?void 0:d.length),f=!!r&&r.sourceIds.filter(e=>l?"page"!==e&&e!==l:"page"!==e).length>0||!!(null==o?void 0:o.length);return(0,s.jsx)(e_.UQ,{collapsible:!0,type:"single",defaultValue:"readingCode",children:(0,s.jsxs)(e_.Qd,{value:"readingCode",className:"border-0",children:[(0,s.jsx)(e_.o4,{className:"w-full py-2 pr-2",children:(0,s.jsxs)("div",{className:"flex flex-1 items-center justify-between pr-2",children:[(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,s.jsx)(g.IconBlocks,{className:"mr-2 h-5 w-5 shrink-0"}),(0,s.jsx)("span",{className:"shrink-0",children:"Look into"}),(0,s.jsx)("div",{className:"flex flex-1 flex-nowrap gap-2 truncate",children:null==i?void 0:i.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-1 rounded-lg border px-2 py-0 font-medium no-underline",children:[e.sourceKind===S.ri.Web?(0,s.jsx)(g.IconEmojiGlobe,{className:"h-3 w-3 shrink-0",emojiClassName:"text-sm"}):e.sourceKind===S.ri.Page?(0,s.jsx)(g.IconBookOpen,{className:"h-3.5 w-3.5 shrink-0"}):e.sourceKind===S.ri.Ingested?(0,s.jsx)(g.IconFolderUp,{className:"shrink-0"}):(0,s.jsx)(g.IconEmojiBook,{className:"h-3 w-3 shrink-0",emojiClassName:"text-sm"}),e.sourceName]},e.sourceId))})]}),(0,s.jsx)("div",{className:"shrink-0",children:h?(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[h," sources"]}):null})]})}),(0,s.jsx)(e_.vF,{className:"pb-0",children:(0,s.jsxs)("div",{className:"space-y-2 text-sm text-muted-foreground",children:[x&&(0,s.jsx)(eH,{title:"Search pages ...",isLoading:a,defaultOpen:!!(null==d?void 0:d.length),isLastItem:!f,children:!!(null==d?void 0:d.length)&&(0,s.jsx)("div",{className:"mb-3 mt-2 space-y-2",children:d.map((e,n)=>{let t=e.link;return(0,s.jsx)("div",{children:(0,s.jsxs)(eK.zs,{openDelay:100,closeDelay:100,children:[(0,s.jsx)(eK.Yi,{children:(0,s.jsx)("div",{className:"group cursor-pointer pl-2",onClick:()=>{c(e.link)},children:(0,s.jsx)(eG,{doc:e})})}),(0,s.jsx)(eK.bZ,{className:"w-[60vw] bg-background text-sm text-foreground dark:border-muted-foreground/60 sm:w-96",children:(0,s.jsx)(ez.Z,{relevantDocument:e,onLinkClick:e=>{c(e)}})})]})},"".concat(t,"_").concat(n))})})}),f&&(0,s.jsx)(eH,{title:"Collect documents ...",isLastItem:!0,isLoading:a,defaultOpen:!!(null==o?void 0:o.length),children:!!(null==o?void 0:o.length)&&(0,s.jsx)("div",{className:"mb-3 mt-2 space-y-2",children:o.map((e,n)=>{let t=(0,F.LM)(e)?e.link:e.ingestedDocLink;return(0,s.jsx)("div",{children:(0,s.jsxs)(eK.zs,{openDelay:100,closeDelay:100,children:[(0,s.jsx)(eK.Yi,{children:(0,s.jsx)("div",{className:"group cursor-pointer pl-2",onClick:()=>{t&&c(t)},children:(0,s.jsx)(eJ,{doc:e})})}),(0,s.jsx)(eK.bZ,{className:"w-[60vw] bg-background text-sm text-foreground dark:border-muted-foreground/60 sm:w-96",children:(0,s.jsx)(ez.Z,{relevantDocument:e,onLinkClick:e=>{c(e)}})})]})},"".concat(t,"_").concat(n))})})})]})})]})})}function eJ(e){let{doc:n}=e,t=(0,F.LM)(n),l=(0,F.Rx)(n);return t||l?(0,s.jsxs)("div",{children:[t&&(0,s.jsx)(eW,{doc:n}),l&&(0,s.jsx)(eQ,{doc:n})]}):null}function eW(e){let{doc:n}=e,t=(0,F.LM)(n),a=(0,l.useMemo)(()=>{if(!t)return null;try{return n?new URL(n.link):null}catch(e){return null}},[n]);return t&&a?(0,s.jsxs)("div",{className:"flex flex-nowrap items-center gap-2 rounded-md px-1.5 py-0.5 font-semibold text-foreground hover:bg-accent hover:text-accent-foreground",children:[(0,s.jsx)(eq.V,{hostname:a.hostname,className:"m-0 shrink-0"}),(0,s.jsx)("span",{className:"flex-1 truncate text-foreground",children:n.title}),(0,s.jsx)("span",{className:"m-0 ml-1 shrink-0 text-muted-foreground",children:a.hostname})]}):null}function eG(e){let{doc:n}=e;return(0,F._n)(n)?(0,s.jsxs)("div",{className:"flex flex-nowrap items-center gap-2 rounded-md px-1.5 py-0.5 font-semibold text-foreground hover:bg-accent hover:text-accent-foreground",children:[(0,s.jsx)(g.IconBookOpen,{className:"h-3.5 w-3.5 shrink-0"}),(0,s.jsx)("span",{className:"flex-1 truncate text-foreground",children:(0,F.PJ)(n.title)})]}):null}function eQ(e){let{doc:n}=e,t=(0,F.Rx)(n);return t?(0,s.jsxs)("div",{className:"flex flex-nowrap items-center gap-2 rounded-md px-1.5 py-0.5 font-semibold text-foreground hover:bg-accent hover:text-accent-foreground",children:[(0,s.jsx)(g.IconFileUp,{className:"h-3.5 w-3.5 shrink-0"}),(0,s.jsx)("p",{children:(0,F.PJ)(n.title,20)})]}):null}function e$(e){var n,t,a;let{codeSourceId:r,codeFileList:i,clientCodeContexts:o,serverCodeContexts:d,docs:c,readingCode:u,readingDoc:m,isReadingCode:h,isReadingDocs:x,isReadingFileList:f,onContextClick:v,openExternal:p}=e,{repos:j}=(0,l.useContext)(_.p),y=((null==o?void 0:o.length)||0)+d.length+((null==c?void 0:c.length)||0),N=(0,l.useMemo)(()=>null==j?void 0:j.find(e=>e.sourceId===r),[j,r]),b=!!(null==u?void 0:u.fileList)||!!(null==i?void 0:null===(n=i.fileList)||void 0===n?void 0:n.length),w=(null==u?void 0:u.snippet)||!!(null==d?void 0:d.length),C=!!r&&((null==m?void 0:m.sourceIds.includes(r))||!!(null==c?void 0:c.length)),k=(0,l.useMemo)(()=>{let e=[];return(null==o?void 0:o.length)&&e.push("clientCode"),b&&e.push("fileList"),w&&e.push("snippet"),C&&e.push("docs"),e},[null==o?void 0:o.length,b,w,C]),I=(0,l.useMemo)(()=>k.slice().pop(),[k]);return(0,s.jsx)(e_.UQ,{defaultValue:"readingRepo",collapsible:!0,type:"single",children:(0,s.jsxs)(e_.Qd,{value:"readingRepo",className:"border-none",children:[(0,s.jsx)(e_.o4,{className:"w-full py-2 pr-2",children:(0,s.jsxs)("div",{className:"flex flex-1 flex-nowrap items-center justify-between gap-0.5 truncate whitespace-nowrap pr-2",children:[(0,s.jsxs)("div",{className:"flex flex-1 items-center gap-2 overflow-x-hidden",children:[(0,s.jsx)(g.IconCode,{className:"mr-2 h-5 w-5 shrink-0"}),(0,s.jsx)("span",{children:"Look into"}),!!N&&(0,s.jsxs)("div",{className:"inline-flex cursor-pointer items-center gap-0.5 truncate font-medium",children:[(0,s.jsx)(ep.k,{kind:N.sourceKind,className:"h-3.5 w-3.5 shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:N.sourceName})]})]}),(0,s.jsx)("div",{className:"shrink-0",children:y?(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[y," sources"]}):null})]})}),(0,s.jsx)(e_.vF,{className:"pb-0",children:(0,s.jsxs)("div",{className:"space-y-2 text-xs text-muted-foreground",children:[!!(null==o?void 0:o.length)&&(0,s.jsx)(eH,{title:"Read code ...",isLoading:!1,triggerClassname:"text-sm",defaultOpen:!0,isLastItem:"clientCode"===I,children:(0,s.jsx)("div",{className:"mb-3 mt-2",children:(0,s.jsx)(eY,{children:o.map((e,n)=>"terminal"===e.kind?(0,s.jsx)(e1,{context:e},"terminal-".concat(n)):(0,s.jsx)(eX,{context:e,onContextClick:e=>null==v?void 0:v(e,!0)},"clientCode-".concat(n)))})})},"clientCode"),b&&(0,s.jsx)(eH,{title:"Read codebase structure ...",isLoading:f,triggerClassname:"text-sm",defaultOpen:!!(null==i?void 0:null===(t=i.fileList)||void 0===t?void 0:t.length),isLastItem:"fileList"===I,children:(null==i?void 0:null===(a=i.fileList)||void 0===a?void 0:a.length)?(0,s.jsxs)("div",{className:"mb-3 ml-2 mt-2 flex flex-nowrap items-center gap-2 whitespace-nowrap rounded-md px-1 py-0.5 text-sm font-semibold text-foreground hover:bg-accent",children:[(0,s.jsx)(g.IconListTree,{className:"shrink-0"}),(0,s.jsxs)("span",{children:[i.fileList.length," items"]}),!!i.truncated&&(0,s.jsx)("span",{className:"ml-2 truncate text-muted-foreground",children:"File list truncated. (Maximum number of items has been reached)"})]}):null},"fileList"),w&&(0,s.jsx)(eH,{title:"Search for relevant code snippets ...",isLoading:h,defaultOpen:!!(null==d?void 0:d.length),triggerClassname:"text-sm",isLastItem:"snippet"===I,children:!!(null==d?void 0:d.length)&&(0,s.jsx)("div",{className:"mb-3 mt-2",children:(0,s.jsx)(eY,{children:null==d?void 0:d.map((e,n)=>"terminal"===e.kind?(0,s.jsx)(e1,{context:e},"terminal-".concat(n)):(0,s.jsx)(eX,{context:e,onContextClick:e=>null==v?void 0:v(e,!1)},"serverCode-".concat(n)))})})},"snippet"),C&&(0,s.jsx)(eH,{title:"Collect documents ...",isLoading:x,triggerClassname:"text-sm",defaultOpen:!!(null==c?void 0:c.length),isLastItem:"docs"===I,children:!!(null==c?void 0:c.length)&&(0,s.jsx)("div",{className:"mb-3 mt-2",children:(0,s.jsx)("div",{className:"space-y-2 pl-2 text-sm",children:null==c?void 0:c.map((e,n)=>{let t=(0,F.Rx)(e)?e.id:(0,F.j9)(e)?e.sha:e.link;return(0,s.jsx)("div",{children:(0,s.jsxs)(eK.zs,{openDelay:100,closeDelay:100,children:[(0,s.jsx)(eK.Yi,{children:(0,s.jsx)(e0,{doc:e,openExternal:p})}),(0,s.jsx)(eK.bZ,{className:"w-[50vw] bg-background text-sm text-foreground dark:border-muted-foreground/60 sm:w-96",children:(0,s.jsx)(ez.Z,{relevantDocument:e,onLinkClick:p})})]})},"".concat(t,"_").concat(n))})})})},"docs")]})})]})})}function eY(e){let{children:n}=e;return n?(0,s.jsx)("div",{className:"space-y-2 overflow-y-auto pl-2",children:n}):null}function eX(e){var n,t,a,r,i,o,d;let{context:c,clickable:u=!0,onContextClick:m,enableTooltip:h,onTooltipClick:x,showExternalLinkIcon:f,showClientCodeIcon:v}=e,[p,j]=(0,l.useState)(!1),y=c.range&&!(0,eM.Z)(null===(n=c.range)||void 0===n?void 0:n.start)&&!(0,eM.Z)(null===(t=c.range)||void 0===t?void 0:t.end)&&c.range.start<c.range.end,N=(0,F.Cn)(c.filepath),b=null==c?void 0:null===(a=c.extra)||void 0===a?void 0:a.scores;return(0,s.jsxs)(eh.u,{open:p,onOpenChange:e=>{h&&b&&j(e)},delayDuration:0,children:[(0,s.jsx)(eh.aJ,{asChild:!0,children:(0,s.jsx)("div",{className:(0,F.cn)("rounded-md px-1 py-0.5 text-foreground",{"cursor-pointer hover:bg-accent":u,"cursor-default pointer-events-auto":!u}),onClick:e=>u&&(null==m?void 0:m(c)),children:(0,s.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden text-foreground",children:[(0,s.jsx)(g.IconFile,{className:"shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 truncate font-semibold",title:c.filepath,children:[(0,s.jsx)("span",{children:(0,F.UA)(c.filepath)}),c.range?(0,s.jsxs)(s.Fragment,{children:[(null===(r=c.range)||void 0===r?void 0:r.start)&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:[":",c.range.start]}),y&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:["-",c.range.end]})]}):null,(0,s.jsx)("span",{className:"ml-2 text-muted-foreground",children:N})]}),v&&(0,s.jsx)(g.IconFileSearch2,{className:"shrink-0 text-muted-foreground"}),f&&(0,s.jsx)(g.IconExternalLink,{className:"shrink-0 text-muted-foreground"})]})})}),(0,s.jsx)(eh._v,{align:"start",onClick:x,className:"cursor-pointer p-2",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-2 font-semibold",children:"Scores"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"rrf:"}),null!==(i=null==b?void 0:b.rrf)&&void 0!==i?i:"-"]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"bm25:"}),null!==(o=null==b?void 0:b.bm25)&&void 0!==o?o:"-"]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("span",{className:"w-20",children:"embedding:"}),null!==(d=null==b?void 0:b.embedding)&&void 0!==d?d:"-"]})]})]})})]})}function e0(e){let{doc:n,openExternal:t}=e,l=(0,F.Jd)(n),a=(0,F.XK)(n),r=(0,F.j9)(n);if(!l&&!a&&!r)return null;let i=r?"Commit-".concat(n.sha.slice(0,7)):n.title,o=r?void 0:n.link,d=null;return l&&(d=n.closed?(0,s.jsx)(g.IconCheckCircled,{}):(0,s.jsx)(g.IconCircleDot,{})),a&&(d=n.merged?(0,s.jsx)(g.IconGitMerge,{}):(0,s.jsx)(g.IconGitPullRequest,{})),r&&(d=(0,s.jsx)(g.IconGitCommit,{})),(0,s.jsxs)("div",{className:(0,F.cn)("flex flex-nowrap items-center gap-2 rounded-md px-1.5 py-0.5 font-semibold text-foreground hover:bg-accent hover:text-accent-foreground",{"cursor-pointer":!!o}),onClick:()=>{o&&t(o)},children:[(0,s.jsx)("span",{className:"shrink-0",children:d}),(0,s.jsx)("span",{className:"truncate whitespace-nowrap",children:i})]})}let e1=e=>{var n;let{context:t}=e;return(0,s.jsxs)("div",{className:"flex flex-nowrap items-center gap-2 rounded-md px-1.5 py-0.5 font-semibold text-foreground hover:bg-accent hover:text-accent-foreground",children:[(0,s.jsx)(g.IconCode,{className:"shrink-0"}),(0,s.jsx)("span",{className:"truncate whitespace-nowrap",children:null!==(n=t.name)&&void 0!==n?n:"Terminal Selection"})]})};function e2(e){let{messages:n}=e,{isLoading:t}=l.useContext(_.p);return(0,s.jsx)("div",{className:"relative",children:null==n?void 0:n.map((e,a)=>{let r=a===n.length-1;return(0,s.jsxs)(l.Fragment,{children:[(0,s.jsx)(e5,{isLoading:!!r&&t,message:e,isLastItem:r}),!r&&(0,s.jsx)(eZ.Z,{className:"my-4"})]},e.user.id)})})}function e5(e){let{message:n,isLoading:t,isLastItem:l}=e,{user:a,assistant:r}=n;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e4,{message:a}),!!r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eZ.Z,{className:"my-4"}),(0,s.jsx)(e6,{message:r,userMessage:a,isLoading:t,userMessageId:a.id,enableRegenerating:l})]})]})}function e4(e){var n;let{message:t}=e,[{data:a}]=(0,eE.P)(),r=t.selectContext,{openInEditor:i,supportsOnApplyInEditorV2:o,contextInfo:d,fetchingContextInfo:c}=l.useContext(_.p),u=l.useMemo(()=>{var e;if((null==r?void 0:r.kind)==="terminal")return(0,F.VK)(null==r?void 0:r.selection,"shell");if(!(null==r?void 0:r.content))return"";let n=(null==r?void 0:r.filepath)&&null!==(e=(0,E.U$)(null==r?void 0:r.filepath)[0])&&void 0!==e?e:"";return(0,F.VK)(null==r?void 0:r.content,n)},[r]),m=null;if(u&&t.selectContext&&"file"===t.selectContext.kind){let{range:e,filepath:n}=t.selectContext;m={filepath:n,isMultiLine:!!e&&!(0,eM.Z)(null==e?void 0:e.start)&&!(0,eM.Z)(null==e?void 0:e.end)&&e.start<e.end}}let h=(0,l.useMemo)(()=>(0,Z.Tu)(t.content),[t.content]);return(0,s.jsxs)("div",{className:(0,F.cn)("group relative mb-4 flex flex-col items-start gap-y-2"),...e,children:[(0,s.jsxs)("div",{className:(0,F.cn)("flex min-h-[2rem] w-full items-center justify-between",{hidden:!(null==a?void 0:a.me.name)}),children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("div",{className:"shrink-0 select-none rounded-full border bg-background shadow",children:(0,s.jsx)(eU.SQ,{className:"h-8 w-8",fallback:(0,s.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,s.jsx)(g.IconUser,{className:"h-8 w-8"})})})}),(0,s.jsx)("p",{className:"block text-sm font-bold",children:null==a?void 0:a.me.name})]}),(0,s.jsx)(e3,{...e})]}),(0,s.jsx)("div",{className:"group relative flex w-full justify-between gap-x-2",children:(0,s.jsxs)("div",{className:"flex-1 space-y-2 overflow-hidden px-1",children:[(0,s.jsx)(eF.J,{message:h,supportsOnApplyInEditorV2:o,openInEditor:i,contextInfo:d,fetchingContextInfo:c}),m&&t.selectContext&&"file"===t.selectContext.kind&&(0,s.jsxs)("div",{className:"flex cursor-pointer items-center gap-1 overflow-x-auto text-xs text-muted-foreground hover:underline",onClick:()=>{let e=t.selectContext;"file"===e.kind&&i((0,F.Uw)(e))},children:[(0,s.jsx)(g.IconFile,{className:"h-3 w-3"}),(0,s.jsxs)("p",{className:"flex-1 truncate pr-1",children:[(0,s.jsx)("span",{children:m.filepath}),(0,s.jsx)(eA.o,{range:t.selectContext.range})]})]}),(null===(n=t.selectContext)||void 0===n?void 0:n.kind)==="terminal"&&(0,s.jsxs)("div",{className:"flex cursor-pointer items-center gap-1 overflow-x-auto text-xs text-muted-foreground hover:underline",children:[(0,s.jsx)(g.IconTerminalSquare,{className:"h-3 w-3"}),(0,s.jsx)("p",{className:"flex-1 truncate pr-1",title:t.selectContext.selection,children:(0,s.jsx)("span",{children:t.selectContext.name})})]})]})})]})}function e3(e){let{message:n}=e,{handleMessageAction:t,isLoading:a}=l.useContext(_.p);return(0,s.jsxs)(ne,{className:"opacity-0 group-hover:opacity-100",children:[!a&&(0,s.jsxs)(p.z,{variant:"ghost",size:"icon",onClick:e=>t(n.id,"edit"),children:[(0,s.jsx)(g.IconEdit,{}),(0,s.jsx)("span",{className:"sr-only",children:"Edit message"})]}),!a&&(0,s.jsxs)(p.z,{variant:"ghost",size:"icon",onClick:e=>t(n.id,"delete"),children:[(0,s.jsx)(g.IconTrash,{}),(0,s.jsx)("span",{className:"sr-only",children:"Delete message"})]})]})}function e6(e){var n,t,a;let{message:r,userMessage:i,isLoading:o,userMessageId:d,enableRegenerating:c,...u}=e,{onApplyInEditor:m,onCopyContent:h,onLookupSymbol:x,openInEditor:f,openExternal:v,supportsOnApplyInEditorV2:p,runShell:g,contextInfo:y}=l.useContext(_.p),[b]=(0,eT.qB)(),w=l.useMemo(()=>{var e;return(0,C.Z)((0,j.Z)([i.activeContext,...null!==(e=null==i?void 0:i.relevantContext)&&void 0!==e?e:[]]).map(e=>{var n;if("terminal"===e.kind)return e;let t=(0,F.zO)(e);return t||{kind:"file",range:(0,F.OV)(e),filepath:e.filepath,content:e.content,gitUrl:e.gitUrl,commit:null!==(n=e.commit)&&void 0!==n?n:void 0}}),N.Z)},[i.activeContext,i.relevantContext]),k=l.useMemo(()=>{var e,n,t;return null!==(t=null==r?void 0:null===(n=r.attachment)||void 0===n?void 0:null===(e=n.code)||void 0===e?void 0:e.map(e=>{var n;let t=(0,F.zO)(e);return t||{kind:"file",range:(0,F.OV)(e),filepath:e.filepath,content:e.content,gitUrl:e.gitUrl,commit:null!==(n=e.commit)&&void 0!==n?n:void 0}}))&&void 0!==t?t:[]},[null==r?void 0:null===(n=r.attachment)||void 0===n?void 0:n.code]),I=(0,l.useMemo)(()=>{var e;let n=null!==(e=null==w?void 0:w.map(e=>{var n;return"terminal"===e.kind?{content:e.selection,filepath:"",gitUrl:"",baseDir:"",startLine:void 0,language:"shell",isClient:!0}:{content:e.content,filepath:e.filepath,gitUrl:e.gitUrl,baseDir:e.baseDir,startLine:e.range?e.range.start:void 0,language:(0,E.U$)(null!==(n=e.filepath)&&void 0!==n?n:"")[0],isClient:!0}}))&&void 0!==e?e:[];return n},[w]),R=(0,l.useMemo)(()=>{var e;let n=null!==(e=null==k?void 0:k.map(e=>{var n,t,s;return"terminal"===e.kind?{content:e.selection,filepath:"",gitUrl:"",baseDir:"",startLine:void 0,language:"shell",isClient:!1}:{content:e.content,filepath:e.filepath,gitUrl:null!==(t=e.gitUrl)&&void 0!==t?t:"",startLine:null===(n=e.range)||void 0===n?void 0:n.start,language:(0,E.U$)(null!==(s=e.filepath)&&void 0!==s?s:"")[0],isClient:!1}}))&&void 0!==e?e:[];return(0,j.Z)([...n])},[k]),M=null==r?void 0:null===(t=r.attachment)||void 0===t?void 0:t.doc,L=(0,l.useMemo)(()=>null==M?void 0:M.filter(e=>(0,F.XK)(e)||(0,F.Jd)(e)||(0,F.j9)(e)),[M]),T=(0,l.useMemo)(()=>null==M?void 0:M.filter(e=>(0,F.LM)(e)||(0,F.Rx)(e)),[M]),A=(0,l.useMemo)(()=>null==M?void 0:M.filter(e=>(0,F._n)(e)),[M]),D=(0,l.useMemo)(()=>{if(!(null==y?void 0:y.sources)||!(null==i?void 0:i.content))return[];let e=(0,F.b)(i.content,null==y?void 0:y.sources),n=e.filter(e=>(0,F._q)(e.kind)).map(e=>({sourceId:e.id,sourceKind:e.kind,sourceName:e.label}));return(b.value||(null==A?void 0:A.length))&&n.unshift({sourceId:"page",sourceKind:S.ri.Page,sourceName:"Pages"}),n},[null==y?void 0:y.sources,null==i?void 0:i.content,b.value,null==A?void 0:A.length]),Z=!!m,U=(e,n)=>{if("file"===e.kind){if(n||!Z)f((0,F.Uw)(e));else{let n=(0,F.XX)(window.location.href,e);v(n)}}};return(0,s.jsxs)("div",{className:(0,F.cn)("group relative mb-4 flex flex-col items-start gap-y-2"),...u,children:[(0,s.jsxs)("div",{className:"flex min-h-[2rem] w-full items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("div",{className:"shrink-0 select-none rounded-full border bg-background shadow",children:(0,s.jsx)(e9,{className:"h-8 w-8"})}),(0,s.jsx)("p",{className:"block text-sm font-bold",children:"Tabby"})]}),(0,s.jsx)(e7,{message:r,userMessageId:d,enableRegenerating:c,attachmentCode:R})]}),(0,s.jsxs)("div",{className:"mb-1 w-full flex-1 space-y-2 overflow-hidden px-1",children:[r.codeSourceId?(0,s.jsx)(e$,{codeSourceId:r.codeSourceId,isReadingCode:r.isReadingCode,isReadingDocs:r.isReadingDocs,isReadingFileList:r.isReadingFileList,clientCodeContexts:w,serverCodeContexts:k,codeFileList:null===(a=r.attachment)||void 0===a?void 0:a.codeFileList,docs:L,readingCode:r.readingCode,readingDoc:r.readingDoc,onContextClick:U,openExternal:v}):(0,s.jsx)(eV,{contexts:k,clientContexts:w,onContextClick:U,showExternalLink:Z,supportsOpenInEditor:!!f,showClientCodeIcon:!Z}),!!(null==D?void 0:D.length)&&(0,s.jsx)(eB,{codeSourceId:r.codeSourceId,docQuerySources:D,readingDoc:r.readingDoc,isReadingDocs:r.isReadingDocs,webDocs:T,pages:A,openExternal:v}),!o||(null==r?void 0:r.content)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eF.J,{message:r.content,onApplyInEditor:m,onCopyContent:h,attachmentClientCode:I,attachmentCode:R,attachmentDocs:M,onCodeCitationClick:e=>{let n={gitUrl:e.gitUrl,content:e.content,filepath:e.filepath,kind:"file",range:(0,F.OV)(e)};U(n,e.isClient)},onLinkClick:e=>{v(e)},isStreaming:o,onLookupSymbol:x,openInEditor:f,supportsOnApplyInEditorV2:p,activeSelection:i.activeContext,runShell:g}),!!r.error&&(0,s.jsx)(eF.m,{error:r.error})]}):(0,s.jsx)(e8,{})]})]})}function e7(e){let{handleMessageAction:n,isLoading:t,onCopyContent:a}=l.useContext(_.p),{message:r,userMessageId:i,enableRegenerating:o,attachmentCode:d}=e,c=(0,l.useMemo)(()=>(function(e,n){var t;if(!n||(0,eR.Z)(n))return e;let s=e.replace(eL.Hc,e=>{let n=null==e?void 0:e.match(/\d+/);return"[".concat(n,"]")}).trim(),l=null!==(t=n.map((e,n)=>{let t=(0,F.tf)(e),s=(0,j.Z)([e.filepath,t]).join(":");return"[".concat(n+1,"] ").concat(s)}).join("\n"))&&void 0!==t?t:"";return"".concat(s,"\n\nCitations:\n").concat(l)})(r.content,d),[r.content,d]);return(0,s.jsxs)(ne,{children:[!t&&o&&(0,s.jsxs)(p.z,{variant:"ghost",size:"icon",onClick:e=>n(i,"regenerate"),children:[(0,s.jsx)(g.IconRefresh,{}),(0,s.jsx)("span",{className:"sr-only",children:"Regenerate message"})]}),(0,s.jsx)(eD.q,{value:c,onCopyContent:a})]})}function e8(){return(0,s.jsxs)("div",{className:"space-y-2 py-2",children:[(0,s.jsx)(ev.O,{className:"h-3 w-full"}),(0,s.jsx)(ev.O,{className:"h-3 w-full"})]})}function e9(e){let{className:n}=e;return(0,s.jsx)(r(),{style:{backgroundColor:"#E8E2D2"},className:(0,F.cn)("rounded-full p-0.5",n),src:o.Z,alt:"tabby"})}function ne(e){let{className:n,...t}=e;return(0,s.jsx)("div",{className:(0,F.cn)("flex items-center justify-end transition-opacity",n),...t})}function nn(){return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(ev.O,{className:"h-8 w-8 rounded-full"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(ev.O,{className:"w-full"}),(0,s.jsx)(ev.O,{className:"w-[60%]"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(ev.O,{className:"h-8 w-8 rounded-full"})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(ev.O,{className:"w-full"}),(0,s.jsx)(ev.O,{className:"w-full"}),(0,s.jsx)(ev.O,{className:"w-[80%]"})]})]})]})}let nt=l.forwardRef((e,n)=>{var t,a;let{className:r,threadId:i,setThreadId:o,initialMessages:d,onLoaded:c,onThreadUpdates:u,container:m,docQuery:h,generateRelevantQuestions:x,welcomeMessage:f,promptFormClassname:v,onCopyContent:p,onApplyInEditor:g,onLookupSymbol:V,openInEditor:O,openExternal:P,chatInputRef:K,supportsOnApplyInEditorV2:z,readWorkspaceGitRepositories:q,getActiveEditorSelection:H,getActiveTerminalSelection:B,fetchSessionState:J,storeSessionState:W,listFileInWorkspace:G,readFileContent:Q,listSymbols:$,setShowHistory:Y,runShell:X,getChanges:ee,...en}=e,[et,es]=l.useState(),[el,ea]=l.useState(!1),[er,eo]=l.useState(!1),ed=l.useRef(!1),[ec,eu]=l.useState(null!=d?d:[]),[em,eh]=l.useState([]),[ex,ef]=l.useState(null),[ev,ep]=l.useState();l.useEffect(()=>{i&&(es(i),eu([]))},[i]);let[{data:eg,error:ey,fetching:eN,stale:eb}]=(0,k.aM)({query:D.r4,variables:{threadId:i},pause:!i});l.useEffect(()=>{var e,n;if(!eb){if((null==eg?void 0:null===(n=eg.threadMessages)||void 0===n?void 0:null===(e=n.edges)||void 0===e?void 0:e.length)&&i){let e=(e=>{let n=[],t={};return e.forEach(e=>{let s=e.node;if(s.role===S.uU.User){var l;t.user={id:s.id,content:s.content,relevantContext:null===(l=s.attachment.clientCode)||void 0===l?void 0:l.map(e=>{var n;return{kind:"file",content:e.content,filepath:null!==(n=e.filepath)&&void 0!==n?n:"",startLine:e.startLine,gitUrl:""}})}}else e.node.role===S.uU.Assistant&&!t.assistant&&(t.assistant=e.node,t.user&&t.assistant&&(n.push(t),t={}))}),n})(eg.threadMessages.edges);eu(e)}else eu([])}},[eg]),l.useEffect(()=>{el&&(null==W||W({selectedRepoId:ev}))},[ev,el,W]);let eC=(0,A.aK)(e=>e.enableActiveSelection),ek=l.useRef(null),eI=e=>{var n;null===(n=ek.current)||void 0===n||n.setInput(e)},eR=null!==(a=null===(t=ek.current)||void 0===t?void 0:t.input)&&void 0!==a?a:"",[{data:eM,fetching:eL}]=(0,k.aM)({query:D.Gx}),[{data:eT,fetching:eE}]=(0,k.aM)({query:D.K5}),eA=null==eT?void 0:eT.repositoryList,{selectedModel:eD}=(0,L.Vq)(),{sendUserMessage:eF,isLoading:eZ,error:eU,answer:e_,stop:eV,regenerate:eO,deleteThreadMessagePair:eP}=(0,T.x)({threadId:et}),eK=async e=>{var n;if(!et)return;let t=ec.find(n=>n.user.id===e);if(!(null==t?void 0:t.user)||!t.assistant)return;let s=ec.filter(n=>n.user.id!==e);eu(s),null==W||W({qaPairs:s}),eP(et,null==t?void 0:t.user.id,null==t?void 0:null===(n=t.assistant)||void 0===n?void 0:n.id)},ez=async e=>{if(!et)return;let n=(0,y.Z)(ec,n=>n.user.id===e);if(n>-1){let e=ec[n];if(!e.assistant)return;let t=(0,F.x0)(),s=(0,F.x0)();eu([...ec.slice(0,n),{user:{...e.user,id:t},assistant:{codeSourceId:e.assistant.codeSourceId,id:s,content:"",error:void 0}}]);let[l,a]=await eG(e.user,e.assistant.codeSourceId);return eO({threadId:et,userMessageId:e.user.id,assistantMessageId:e.assistant.id,userMessage:l,threadRunOptions:a})}},eq=async e=>{var n,t,s,l;if(!et)return;let a=ec.find(n=>n.user.id===e);if(!(null==a?void 0:a.user)||!a.assistant)return;let r=a.user,i=[];(null===(n=r.relevantContext)||void 0===n?void 0:n.length)&&(i=i.concat(r.relevantContext));let o=(0,C.Z)(i,N.Z);eh(o);let d=ec.filter(n=>n.user.id!==e);eu(d),null==W||W({qaPairs:d});let c=(0,ei._t)((0,Z.Tu)(r.content),null!==(l=null==eM?void 0:null===(t=eM.contextInfo)||void 0===t?void 0:t.sources)&&void 0!==l?l:[]);eI({type:"doc",content:c}),r.activeContext&&"file"===r.activeContext.kind&&O((0,F.Uw)(r.activeContext)),eP(et,null==a?void 0:a.user.id,null==a?void 0:null===(s=a.assistant)||void 0===s?void 0:s.id)},eH=async()=>{if(!(null==ec?void 0:ec.length))return;let e=ec[ec.length-1].user.id;return ez(e)},eB=()=>{eV(!0),eu([]),es(void 0),o(void 0),null==W||W({qaPairs:[],threadId:void 0})},eJ=()=>{eB()};l.useEffect(()=>{if(!(null==ec?void 0:ec.length)||!e_)return;let e=ec[ec.length-1];e_.threadId&&!et&&es(e_.threadId),eu(n=>{var t,s,l,a,r,i,o,d,c;let u=n[n.length-1].assistant,m={...u,id:e_.assistantMessageId||(null==u?void 0:u.id)||(0,F.x0)(),content:e_.content,error:void 0};return"isReadingCode"in e_&&(m.isReadingCode=e_.isReadingCode),"isReadingFileList"in e_&&(m.isReadingFileList=e_.isReadingFileList),"isReadingDocs"in e_&&(m.isReadingDocs=e_.isReadingDocs),m.readingCode=null==e_?void 0:e_.readingCode,m.readingDoc=null==e_?void 0:e_.readingDoc,(null===(t=m.attachment)||void 0===t?void 0:t.code)||!e_.attachmentsCode||(m.attachment={clientCode:null,doc:(null===(i=m.attachment)||void 0===i?void 0:i.doc)||null,code:e_.attachmentsCode.map(e=>({...e.code,extra:{scores:e.scores}}))||null}),(null===(s=m.attachment)||void 0===s?void 0:s.doc)||!e_.attachmentsDoc||(m.attachment={clientCode:null,doc:e_.attachmentsDoc.map(e=>({...e.doc,extra:{score:e.score}}))||null,code:(null===(o=m.attachment)||void 0===o?void 0:o.code)||null}),!(null===(l=m.attachment)||void 0===l?void 0:l.codeFileList)&&(null==e_?void 0:null===(r=e_.attachmentsFileList)||void 0===r?void 0:null===(a=r.codeFileList)||void 0===a?void 0:a.length)&&(m.attachment={clientCode:null,doc:(null===(d=m.attachment)||void 0===d?void 0:d.doc)||null,codeFileList:{fileList:e_.attachmentsFileList.codeFileList,truncated:e_.attachmentsFileList.truncated},code:(null===(c=m.attachment)||void 0===c?void 0:c.code)||null}),[...n.slice(0,n.length-1),{user:{...e.user,id:(null==e_?void 0:e_.userMessageId)||e.user.id},assistant:m}]}),eZ||null==W||W({qaPairs:ec})},[e_,eZ]);let eW=(0,R.S)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth";m?m.scrollTo({top:m.scrollHeight,behavior:e}):window.scrollTo({top:document.body.offsetHeight,behavior:e})},100);l.useLayoutEffect(()=>{eZ&&eW.run()},[eZ]),l.useEffect(()=>{eU&&(null==ec?void 0:ec.length)&&eu(e=>{var n,t,s;let l=e[e.length-1],a=[...e.slice(0,e.length-1),{...l,assistant:{...l.assistant,id:(null===(n=l.assistant)||void 0===n?void 0:n.id)||(0,F.x0)(),content:null!==(s=null===(t=l.assistant)||void 0===t?void 0:t.content)&&void 0!==s?s:"",error:eU?"401"===eU.message?"Unauthorized":(0,w.Z)(eU.graphQLErrors,e=>{var n;return(null===(n=e.extensions)||void 0===n?void 0:n.code)===I.ir})?"The thread has expired, please click 'Clear' and try again.":eU.message||"Failed to fetch":"Failed to fetch"}}];return null==W||W({qaPairs:a}),a}),(null==eU?void 0:eU.message)!=="Thread not found"||(null==ec?void 0:ec.length)||eJ()},[eU]);let eG=async(e,n)=>{var t;let s=eC&&!!e.activeContext,l=(0,C.Z)((0,j.Z)([e.selectContext,s&&e.activeContext,...(null==e?void 0:e.relevantContext)||[]]),N.Z),a=l.map(e=>{var n;return"terminal"===e.kind?(0,F.zP)(e):{content:e.content,filepath:e.filepath,startLine:null===(n=e.range)||void 0===n?void 0:n.start}}),r=e.content,i=n?{content:r,sourceId:n,filepath:null==a?void 0:null===(t=a[0])||void 0===t?void 0:t.filepath}:null;return[{content:r,attachments:{code:a}},{docQuery:n?{content:r,sourceIds:[n],searchPublic:!1}:null,codeQuery:i,generateRelevantQuestions:!!x,modelName:eD}]},eQ=(0,M.d)(async(e,n)=>{var t,s,l,a,r,i,o,d;if(eZ)return;let c="";if((null==e?void 0:null===(t=e.selectContext)||void 0===t?void 0:t.kind)==="file"){let n=null==e?void 0:null===(l=e.selectContext)||void 0===l?void 0:l.content;if(n){let t=(null==e?void 0:null===(a=e.selectContext)||void 0===a?void 0:a.filepath)&&null!==(i=(0,E.U$)(null==e?void 0:null===(r=e.selectContext)||void 0===r?void 0:r.filepath)[0])&&void 0!==i?i:"";c=(0,F.VK)(n,t)}}else if((null==e?void 0:null===(s=e.selectContext)||void 0===s?void 0:s.kind)==="terminal"){let n=null==e?void 0:null===(o=e.selectContext)||void 0===o?void 0:o.selection;n&&(c=(0,F.VK)(n,"shell"))}e.content=await (0,F.at)(e.content,{getChanges:ee,readFileContent:Q});let u={...e,content:e.content+c,id:null!==(d=e.id)&&void 0!==d?d:(0,F.x0)(),selectContext:e.selectContext,activeContext:eC&&ex?ex:void 0,relevantContext:[...e.relevantContext||[]]},m=[...ec,{user:u,assistant:{id:(0,F.x0)(),content:"",error:void 0,codeSourceId:n}}];eu(m),null==W||W({qaPairs:m});let h=await eG(u,n);eF(...h)}),e$=(e,n)=>{var t;return null===(t=eQ.current)||void 0===t?void 0:t.call(eQ,e,n)},eY=(0,M.d)(async e=>{var n;let t=(0,F.QZ)(e);e$({content:t,selectContext:"explain-terminal"==e?null!==(n=await (null==B?void 0:B()))&&void 0!==n?n:void 0:null!=ex?ex:void 0},ev)}),eX=async e=>{var n;return null===(n=eY.current)||void 0===n?void 0:n.call(eY,e)},e0=async e=>{e$({content:e,relevantContext:em},ev),eh([])},e1=(0,M.d)(e=>{eh(n=>{let t=function(e,n){let t=["content"],s=(e,n)=>(0,b.Z)(e,n,(e,n,s)=>{if(t.includes(s))return!0});return e.some(e=>s(e,n))?e:e.concat([n])}(n,e);return t})}),e5=e=>{var n;let t=(0,F.VU)(e);null===(n=e1.current)||void 0===n||n.call(e1,t)};l.useEffect(()=>{ed.current&&(null==u||u(ec))},[ec]),l.useEffect(()=>{el&&(null==W||W({relevantContext:em}))},[em,el,W]);let e4=(0,R.S)(e=>{ef(e)},300),e3=e=>{let n=e?(0,F.VU)(e):null;e4.run((null==n?void 0:n.kind)==="file"?n:null)},e6=()=>q?q():[],e7=async()=>null==H?void 0:H();return l.useEffect(()=>{let e=async()=>{let[e,n]=await Promise.all([null==J?void 0:J(),e7()]);if((null==e?void 0:e.threadId)&&es(e.threadId),(null==e?void 0:e.qaPairs)&&eu(e.qaPairs),(null==e?void 0:e.input)&&eI(e.input),(null==e?void 0:e.relevantContext)&&eh(e.relevantContext),eW.run("instant"),(null==e?void 0:e.selectedRepoId)&&(null==eA?void 0:eA.find(n=>n.sourceId===e.selectedRepoId)))ep(e.selectedRepoId);else{let e=await e6();if((null==e?void 0:e.length)&&(null==eA?void 0:eA.length)){let n=e[0].url,t=(0,F.Ch)(eA.map(e=>({url:e.gitUrl,sourceId:e.sourceId})),n);t&&ep(t.sourceId)}}if(n){let e=(0,F.VU)(n);ef("file"===e.kind?e:null)}};eE||el||e().finally(()=>{ea(!0)})},[eE,el]),l.useEffect(()=>{el&&(null==c||c(),eo(!0))},[el]),l.useEffect(()=>{ey&&!d&&eo(!0)},[ey]),l.useEffect(()=>{null==W||W({threadId:et})},[et]),l.useImperativeHandle(n,()=>({executeCommand:eX,stop:eV,isLoading:eZ,addRelevantContext:e5,focus:()=>{var e;return null===(e=ek.current)||void 0===e?void 0:e.focus()},updateActiveSelection:e3,newChat:eB}),[]),(0,s.jsx)(_.p.Provider,{value:{threadId:et,isLoading:eZ,qaPairs:ec,handleMessageAction:(e,n)=>{switch(n){case"delete":eK(e);break;case"regenerate":ez(e);break;case"edit":eq(e)}},onClearMessages:eJ,container:m,onCopyContent:p,onApplyInEditor:g,onLookupSymbol:V,openInEditor:O,openExternal:P,relevantContext:em,setRelevantContext:eh,chatInputRef:K,activeSelection:ex,supportsOnApplyInEditorV2:z,selectedRepoId:ev,setSelectedRepoId:ep,repos:eA,fetchingRepos:eE,initialized:er,listFileInWorkspace:G,readFileContent:Q,listSymbols:$,runShell:X,getChanges:ee,contextInfo:null==eM?void 0:eM.contextInfo,fetchingContextInfo:eL},children:(0,s.jsx)("div",{className:"flex justify-center overflow-x-hidden",...en,children:(0,s.jsxs)("div",{className:"mx-auto w-full max-w-5xl px-[16px]",children:[er&&(0,s.jsxs)("div",{className:(0,F.cn)("pb-[200px] pt-4 md:pt-10",r),children:[(0,s.jsx)(U.Z,{loading:eN||eb,triggerOnce:!1,fallback:(0,s.jsx)(nn,{}),delay:i?0:200,children:(null==ec?void 0:ec.length)?(0,s.jsx)(e2,{messages:ec}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(eS,{setInput:eI,welcomeMessage:f,setShowHistory:Y,onSelectThread:o})})}),(0,s.jsx)(ew,{trackVisibility:eZ})]}),(0,s.jsx)(ej,{onSubmit:e0,className:(0,F.cn)("fixed inset-x-0 bottom-0 z-40 mb-4",v),stop:()=>{eV()},reload:eH,input:eR,setInput:eI,onUpdate:e=>{el&&(null==W||W({input:e.editor.getJSON()}))},ref:ek,chatInputRef:K})]})})})});nt.displayName="Chat";var ns=t(73033);t(2596);var nl=t(66794),na=t(79972),nr=t(54173);function ni(e){var n,t,a,r,i;let{onClose:o,onNavigate:d,onDeleted:c}=e,[{data:u,fetching:m}]=(0,k.aM)({query:D.Gx}),[h,x]=(0,l.useState)(),[{data:f,fetching:v}]=(0,k.aM)({query:D.rm,variables:{last:25,before:h}}),j=null==f?void 0:null===(n=f.myThreads)||void 0===n?void 0:n.pageInfo,y=(0,l.useMemo)(()=>{var e;return null==f?void 0:null===(e=f.myThreads)||void 0===e?void 0:e.edges.slice().reverse()},[null==f?void 0:null===(t=f.myThreads)||void 0===t?void 0:t.edges]),N=e=>{d(e),setTimeout(()=>{o()},100)},b=(0,q.Db)(D.zW),w=e=>b({id:e}).then(n=>{var t;(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.deleteThread)&&c(e)});return(0,s.jsx)("div",{className:"editor-bg fixed inset-0 z-50 overflow-hidden px-[16px] pt-4 md:pt-10",children:(0,s.jsxs)("div",{className:"mx-auto h-full max-w-5xl overflow-y-auto pb-8",children:[(0,s.jsxs)("div",{className:"editor-bg sticky top-0 flex items-center justify-between pb-3",children:[(0,s.jsx)("span",{className:"text-lg font-semibold",children:"History"}),(0,s.jsx)(p.z,{size:"sm",onClick:o,children:"Done"})]}),(0,s.jsx)("div",{className:"mt-4 space-y-4",children:(0,s.jsx)(U.Z,{loading:v,fallback:(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(g.IconSpinner,{className:"h-6 w-6"})}),children:(null==y?void 0:y.length)?(0,s.jsxs)(s.Fragment,{children:[null==y?void 0:y.map(e=>{var n;return(0,s.jsx)(ek,{data:e,sources:null==u?void 0:null===(n=u.contextInfo)||void 0===n?void 0:n.sources,fetchingSources:m,onNavigate:N,onDeleteThread:w},e.node.id)}),!!(null==j?void 0:j.hasPreviousPage)&&(0,s.jsx)(nr.d,{onLoad:()=>{let e=null==j?void 0:j.startCursor;if(e&&(null==f?void 0:f.myThreads.edges.length)&&f.myThreads.edges.findIndex(n=>n.cursor===e)>-1)x(e);else{var n;x(null==f?void 0:null===(n=f.myThreads.edges[0])||void 0===n?void 0:n.cursor)}},isFetching:v,itemCount:null!==(i=null==f?void 0:null===(r=f.myThreads)||void 0===r?void 0:null===(a=r.edges)||void 0===a?void 0:a.length)&&void 0!==i?i:0,children:(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(g.IconSpinner,{className:"h-6 w-6"})})})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(na.aY,{className:"mt-6 flex items-center justify-center gap-1 rounded-lg border py-12",children:[(0,s.jsx)(g.IconFileSearch,{className:"h-6 w-6"}),(0,s.jsx)("p",{className:"font-semibold",children:"No data"})]})})})})]})})}let no=e=>u()(e).hsl().toString().replace(/hsla?\(/,"").replace(")","").split(",").slice(0,3).map((e,n)=>0===n?parseFloat(e).toFixed(1):e).join("");function nd(){let[e,n]=(0,l.useState)(!1),[t,a]=(0,l.useState)(!1),[c,u]=(0,l.useState)(null),[j,y]=(0,l.useState)(!1),[N,b]=(0,l.useState)(),[w,C]=(0,l.useState)(),[k,I]=(0,l.useState)([]),[S,R]=(0,l.useState)(null),[M,L]=(0,l.useState)(null),[T,E]=(0,l.useState)(!1),A=(0,l.useRef)(null),{width:D}=(0,d.iP)(),F=(0,l.useRef)(D),Z=(0,l.useRef)(null),U=(0,i.useSearchParams)(),_=U.get("client"),V=!!_||void 0,O=(0,l.useRef)(),P=()=>{y(!1)},K=()=>{y(!0)},z=e=>{A.current?(P(),A.current.executeCommand(e)):C(e)},q=async e=>{if(A.current)P(),A.current.addRelevantContext(e);else{let n=[...k];n.push(e),I(n)}},H=async e=>{A.current?A.current.updateActiveSelection(null!=e?e:null):e&&R(e)},B=async e=>{switch(e){case"history":K();break;case"new-chat":var n;null===(n=A.current)||void 0===n||n.newChat(),P()}},J=(0,v.H)({init:async e=>{A.current||(_&&(0,nl.zr)(e.fetcherOptions),u(e.fetcherOptions),O.current=e.useMacOSKeyboardEventHandler)},getVersion:async()=>f,executeCommand:async e=>z(e),showError:async e=>{L(e)},cleanError:async()=>{L(null)},addRelevantContext:q,updateTheme:async(e,n)=>{let t=e.split(";").filter(e=>e).map(e=>{let[n,t]=e.split(":"),s=t.trim(),l=s.startsWith("#")||s.startsWith("rgb");if(!l)return"".concat(n,": ").concat(t);let a=no(s);return"".concat(n,": ").concat(a)}).join(";");document.documentElement.style.cssText=t,document.documentElement.className=n+" client client-".concat(_)},updateActiveSelection:H,navigate:B});(0,l.useEffect)(()=>{let e=()=>{setTimeout(()=>{var e;null===(e=Z.current)||void 0===e||e.focus()},0)};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}}),(0,l.useEffect)(()=>{let e=(e,n)=>{var t;null==J||null===(t=J.onKeyboardEvent)||void 0===t||t.call(J,e,{code:n.code,isComposing:n.isComposing,key:n.key,altKey:n.altKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey,shiftKey:n.shiftKey,location:n.location,repeat:n.repeat,keyCode:n.keyCode})},n=n=>{O.current?n.metaKey&&"KeyC"===n.code?document.execCommand("copy"):n.metaKey&&"KeyX"===n.code?document.execCommand("cut"):n.metaKey&&"KeyV"===n.code?document.execCommand("paste"):n.metaKey&&"KeyA"===n.code?document.execCommand("selectAll"):e("keydown",n):e("keydown",n)},t=n=>{e("keyup",n)},s=n=>{e("keypress",n)};return window.addEventListener("keydown",n),window.addEventListener("keyup",t),window.addEventListener("keypress",s),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",t),window.removeEventListener("keypress",s)}},[J,_]),(0,l.useEffect)(()=>{if(J){var e;null==J||null===(e=J.onLoaded)||void 0===e||e.call(J,{apiVersion:f}),a(!0)}},[J]),(0,l.useLayoutEffect)(()=>{if(e){if(D&&t&&c&&!M&&!F.current){var n;null===(n=A.current)||void 0===n||n.focus()}F.current=D}},[D,e]);let W=()=>{I([]),C(void 0),R(null)},G=async e=>{var n;return null!==(n=null==J?void 0:J.openInEditor(e))&&void 0!==n&&n},Q=async e=>null==J?void 0:J.openExternal(e),$=async()=>{var e;return null!==(e=null==J?void 0:J.getActiveEditorSelection())&&void 0!==e?e:null},Y=async()=>{var e,n;return null!==(n=null==J?void 0:null===(e=J.getActiveTerminalSelection)||void 0===e?void 0:e.call(J))&&void 0!==n?n:null},X=async()=>{var e,n;return null!==(n=null==J?void 0:null===(e=J.fetchSessionState)||void 0===e?void 0:e.call(J))&&void 0!==n?n:null},ee=async e=>{var n;return null==J?void 0:null===(n=J.storeSessionState)||void 0===n?void 0:n.call(J,e)},en=async()=>{E(!0),await (null==J?void 0:J.refresh()),E(!1)};function et(e){let{children:n}=e;return(0,s.jsxs)("div",{className:"h-screen w-screen",style:{padding:"intellij"==_?"20px":"5px 18px"},children:[(0,s.jsxs)("div",{className:"flex items-center",style:{marginBottom:"0.55em"},children:[(0,s.jsx)(r(),{src:o.Z,alt:"logo",className:"rounded-full",style:{background:"rgb(232, 226, 210)",marginRight:"0.375em",padding:"0.15em"},width:18}),(0,s.jsx)("p",{className:"font-semibold",children:"Tabby"})]}),n]})}if(M)return(0,s.jsx)(et,{children:(0,s.jsxs)(s.Fragment,{children:[M.title&&(0,s.jsx)("p",{className:"mb-1.5 mt-2 font-semibold",children:M.title}),(0,s.jsx)(ns.s,{className:"prose max-w-none break-words dark:prose-invert prose-p:leading-relaxed prose-pre:mt-1 prose-pre:p-0",remarkPlugins:[h.Z,x.Z],children:M.content}),(0,s.jsxs)(p.z,{className:"mt-5 flex items-center gap-x-2 text-sm leading-none",onClick:en,children:[T&&(0,s.jsx)(g.IconSpinner,{}),"Refresh"]})]})});if(!t||!c)return(0,s.jsx)(et,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"opacity-80",children:"Welcome to Tabby Chat! Just a moment while we get things ready..."}),(0,s.jsx)(g.IconSpinner,{className:"mx-auto",style:{marginTop:"1.25em",width:"0.875em",height:"0.875em"}})]})});let es=(null==J?void 0:J.storeSessionState)&&(null==J?void 0:J.fetchSessionState);return(0,s.jsxs)(m.SV,{FallbackComponent:function(e){let{error:n}=e;return(0,s.jsxs)(et,{children:[(0,s.jsx)("p",{className:"mb-1.5 mt-2 font-semibold",children:"Something went wrong"}),(0,s.jsx)("p",{children:n.message}),(0,s.jsxs)(p.z,{className:"mt-5 flex items-center gap-x-2 text-sm leading-none",onClick:en,children:[T&&(0,s.jsx)(g.IconSpinner,{}),"Refresh"]})]})},children:[j&&(0,s.jsx)(ni,{onClose:()=>y(!1),onNavigate:e=>b(e),onDeleted:e=>{if(e===N){var n;null===(n=A.current)||void 0===n||n.newChat()}}}),(0,s.jsx)(nt,{threadId:N,setThreadId:b,ref:A,chatInputRef:Z,onLoaded:()=>{let e=A.current;e&&(k.forEach(n=>{e.addRelevantContext(n)}),S&&e.updateActiveSelection(S),w&&e.executeCommand(w),W(),n(!0))},setShowHistory:y,onCopyContent:V&&(null==J?void 0:J.onCopy),onApplyInEditor:V&&((null==J?void 0:J.onApplyInEditorV2)?null==J?void 0:J.onApplyInEditorV2:null==J?void 0:J.onApplyInEditor),supportsOnApplyInEditorV2:!!(null==J?void 0:J.onApplyInEditorV2),onLookupSymbol:V&&(null==J?void 0:J.lookupSymbol),openInEditor:G,openExternal:Q,readWorkspaceGitRepositories:null==J?void 0:J.readWorkspaceGitRepositories,getActiveEditorSelection:$,getActiveTerminalSelection:Y,fetchSessionState:es?X:void 0,storeSessionState:es?ee:void 0,listFileInWorkspace:V&&(null==J?void 0:J.listFileInWorkspace),readFileContent:V&&(null==J?void 0:J.readFileContent),listSymbols:V&&(null==J?void 0:J.listSymbols),runShell:V&&(null==J?void 0:J.runShell),getChanges:V&&(null==J?void 0:J.getChanges)})]})}},17448:function(e,n,t){"use strict";t.d(n,{p:function(){return l}});var s=t(3546);let l=(0,s.createContext)({})},54173:function(e,n,t){"use strict";t.d(n,{d:function(){return d}});var s=t(36164),l=t(3546),a=t(76297),r=t(24449),i=t(73492);let o=e=>{let{onLoad:n,isFetching:t,itemCount:o,children:d,className:c,intersectionOptions:u}=e,{ref:m,inView:h}=(0,a.YD)(u),[x,f]=(0,l.useState)(!1),v=(0,r.S)(e=>{f(e)},150);return(0,l.useEffect)(()=>{h&&!x&&(f(!0),n())},[h,x,o]),(0,l.useEffect)(()=>{t||v.run(!1)},[t]),(0,s.jsx)("div",{className:(0,i.cn)("w-full",c),ref:m,children:null!=d?d:(0,s.jsx)("div",{children:"loading..."})})},d=e=>(0,s.jsx)(o,{...e})},6230:function(e,n,t){"use strict";var s=t(36164),l=t(3546),a=t(24449),r=t(90379);n.Z=e=>{let{triggerOnce:n=!0,loading:t,fallback:i,delay:o,children:d}=e,[c,u]=l.useState(!t),[m]=(0,a.n)(c,null!=o?o:200);return(l.useEffect(()=>{n?t||c||u(!0):u(!t)},[t]),m)?d:i||(0,s.jsx)(r.cg,{})}},73033:function(e,n,t){"use strict";t.d(n,{s:function(){return r}});var s=t(36164),l=t(3546),a=t(17003);let r=(0,l.memo)(e=>{let{className:n,...t}=e;return(0,s.jsx)("div",{className:n,children:(0,s.jsx)(a.D,{...t})})},(e,n)=>e.children===n.children&&e.className===n.className)},70834:function(e,n,t){"use strict";t.d(n,{q:function(){return c}});var s=t(36164),l=t(73492),a=t(62202),r=t(6230),i=t(31458),o=t(81565),d=t(3448);function c(e){let{models:n,value:t,onChange:c,isInitializing:u,triggerClassName:m}=e,h=e=>{c(e)};return(0,s.jsx)(r.Z,{loading:u,fallback:(0,s.jsx)("div",{className:"w-full pl-2",children:(0,s.jsx)(d.O,{className:"h-3 w-[20%]"})}),children:!!(null==n?void 0:n.length)&&(0,s.jsxs)(a.h_,{children:[(0,s.jsx)(a.$F,{asChild:!0,children:(0,s.jsxs)(i.z,{variant:"ghost",className:(0,l.cn)("gap-2 px-1.5 py-1 text-foreground/90",m),children:[(0,s.jsx)(o.IconBox,{}),t]})}),(0,s.jsx)(a.AW,{side:"bottom",align:"start",className:"dropdown-menu max-h-[30vh] min-w-[20rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-2 text-popover-foreground shadow animate-in",children:(0,s.jsx)(a._x,{value:t,onValueChange:c,children:n.map(e=>{let n=e===t;return(0,s.jsxs)(a.qB,{onClick:n=>{h(e),n.stopPropagation()},value:e,className:"cursor-pointer py-2 pl-3",children:[(0,s.jsx)(o.IconCheck,{className:(0,l.cn)("mr-2 shrink-0",e===t?"opacity-100":"opacity-0")}),(0,s.jsx)("span",{className:(0,l.cn)({"font-medium":n}),children:e})]},e)})})})]})})}},65858:function(e,n,t){"use strict";t.d(n,{Qd:function(){return d},UQ:function(){return o},o4:function(){return c},vF:function(){return u}});var s=t(36164),l=t(3546),a=t(43739),r=t(14079),i=t(73492);let o=a.fC,d=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)(a.ck,{ref:n,className:(0,i.cn)("border-b",t),...l})});d.displayName="AccordionItem";let c=l.forwardRef((e,n)=>{let{className:t,children:l,showChevron:o=!0,...d}=e;return(0,s.jsxs)(a.xz,{ref:n,className:(0,i.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...d,children:[l,o&&(0,s.jsx)(r.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})});c.displayName=a.xz.displayName;let u=l.forwardRef((e,n)=>{let{className:t,children:l,...r}=e;return(0,s.jsx)(a.VY,{ref:n,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:(0,s.jsx)("div",{className:(0,i.cn)("pb-4 pt-0",t),children:l})})});u.displayName=a.VY.displayName},63795:function(e,n,t){"use strict";t.d(n,{C:function(){return i}});var s=t(36164);t(3546);var l=t(98641),a=t(73492);let r=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",successful:"border-transparent bg-successful text-successful-foreground hover:bg-successful/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:n,variant:t,...l}=e;return(0,s.jsx)("div",{className:(0,a.cn)(r({variant:t}),n),...l})}},79972:function(e,n,t){"use strict";t.d(n,{Ol:function(){return i},Zb:function(){return r},aY:function(){return c},eW:function(){return u},ll:function(){return o}});var s=t(36164),l=t(3546),a=t(73492);let r=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:n,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...l})});r.displayName="Card";let i=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:n,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t),...l})});i.displayName="CardHeader";let o=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)("h3",{ref:n,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",t),...l})});o.displayName="CardTitle";let d=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)("p",{ref:n,className:(0,a.cn)("text-sm text-muted-foreground",t),...l})});d.displayName="CardDescription";let c=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:n,className:(0,a.cn)("p-6 pt-0",t),...l})});c.displayName="CardContent";let u=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)("div",{ref:n,className:(0,a.cn)("flex items-center p-6 pt-0",t),...l})});u.displayName="CardFooter"},62202:function(e,n,t){"use strict";t.d(n,{$F:function(){return o},AW:function(){return u},Ju:function(){return x},VD:function(){return f},Xi:function(){return m},_x:function(){return d},h_:function(){return i},qB:function(){return h}});var s=t(36164),l=t(3546),a=t(5605),r=t(73492);let i=a.fC,o=a.xz;a.ZA,a.Uv,a.Tr;let d=a.Ee;a.wU;let c=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)(a.tu,{ref:n,className:(0,r.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",t),...l})});c.displayName=a.tu.displayName;let u=l.forwardRef((e,n)=>{let{className:t,sideOffset:l=4,...i}=e;return(0,s.jsx)(a.Uv,{children:(0,s.jsx)(a.VY,{ref:n,sideOffset:l,className:(0,r.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow animate-in data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})})});u.displayName=a.VY.displayName;let m=l.forwardRef((e,n)=>{let{className:t,inset:l,...i}=e;return(0,s.jsx)(a.ck,{ref:n,className:(0,r.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",l&&"pl-8",t),...i})});m.displayName=a.ck.displayName;let h=l.forwardRef((e,n)=>{let{className:t,inset:l,...i}=e;return(0,s.jsx)(a.Rk,{ref:n,className:(0,r.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",l&&"pl-8",t),...i})});h.displayName=a.Rk.displayName;let x=l.forwardRef((e,n)=>{let{className:t,inset:l,...i}=e;return(0,s.jsx)(a.__,{ref:n,className:(0,r.cn)("px-2 py-1.5 text-sm font-semibold",l&&"pl-8",t),...i})});x.displayName=a.__.displayName;let f=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)(a.Z0,{ref:n,className:(0,r.cn)("-mx-1 my-1 h-px bg-muted",t),...l})});f.displayName=a.Z0.displayName},52569:function(e,n,t){"use strict";t.d(n,{SQ:function(){return N},Yt:function(){return y},nY:function(){return j}});var s=t(36164),l=t(3546),a=t(87782),r=t(21454),i=t(36327),o=t(98454),d=t(3765),c=t(73492),u=t(66612);let m=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)(u.fC,{ref:n,className:(0,c.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...l})});m.displayName=u.fC.displayName;let h=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)(u.Ee,{ref:n,className:(0,c.cn)("aspect-square h-full w-full",t),...l})});h.displayName=u.Ee.displayName;let x=l.forwardRef((e,n)=>{let{className:t,...l}=e;return(0,s.jsx)(u.NY,{ref:n,className:(0,c.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...l})});x.displayName=u.NY.displayName;var f=t(3448),v=t(30410).lW;let p="not_found",g=new Set,j=e=>{g.delete(e),(0,r.JG)("/avatar/".concat(e))};function y(e){var n;let{user:t,className:r,fallback:o}=e,u=null==t?void 0:t.id,j=u?"/avatar/".concat(u):null,{data:y,isLoading:N,error:b}=(0,i.Z)(j,e=>{if(!(!u||g.has(u)))return(0,d.Z)(e,{responseFormatter:async e=>{let n=await e.blob(),t=v.from(await n.arrayBuffer());return"data:image/png;base64,".concat(t.toString("base64"))},errorHandler:e=>{if(404===e.status)throw Error(p)}})}),w=l.useMemo(()=>{if(null==t?void 0:t.email)return(0,a.B)(t.email)},[null==t?void 0:t.email]);return N?(0,s.jsx)(f.O,{className:(0,c.cn)("h-16 w-16 rounded-full",r)}):((null==b?void 0:b.message)===p&&u&&g.add(u),y||w||!o)?!y&&w?(0,s.jsx)(a.Z,{className:(0,c.cn)("h-16 w-16",r),...w}):(0,s.jsxs)(m,{className:(0,c.cn)("h-16 w-16",r),children:[(0,s.jsx)(h,{src:y,alt:null==t?void 0:t.email,className:"object-cover"}),(0,s.jsx)(x,{children:null==t?void 0:null===(n=t.email)||void 0===n?void 0:n.substring(0,2)})]}):o}function N(e){let[{data:n}]=(0,o.P)();return(0,s.jsx)(y,{user:null==n?void 0:n.me,...e})}},93877:function(e,n,t){"use strict";t.d(n,{B2:function(){return c},m3:function(){return o},qB:function(){return m}});var s=t(3546);let l=(e,n)=>{let[t,l]=(0,s.useState)(n),[a,r]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let n=localStorage.getItem(e);n&&l(JSON.parse(n)),r(!1)},[]),[t,n=>{l(n),localStorage.setItem(e,JSON.stringify(n))},a]};class a{get value(){if("undefined"!=typeof localStorage){let e=localStorage.getItem(this.storageKey);if(e)return"true"===e}return this.defaultValue}constructor(e,n,t,s){this.storageKey=e,this.title=n,this.description=t,this.defaultValue=s}}class r{defineGlobalVar(){return new a(this.storageKey,this.title,this.description,this.defaultValue)}defineHook(){return()=>{let[e,n,t]=l(this.storageKey,this.defaultValue);return[{value:e,title:this.title,description:this.description,loading:t},()=>{n(!e)}]}}constructor(e,n,t,s){this.storageKey="EXP_".concat(e),this.title=n,this.description=t,this.defaultValue=null!=s&&s}}let i=new r("enable_developer_mode","Developer Mode","Enable the developer mode. This feature involved include the Answer Engine and the Page.",!1);i.defineGlobalVar();let o=i.defineHook(),d=new r("enable_page","Page","Enable creating page from scratch.",!1);d.defineGlobalVar();let c=d.defineHook(),u=new r("enable_search_pages","Search Pages","Enable searching pages. This feature allows you to use pages as context in Answer Engine and chat side panel.",!1);u.defineGlobalVar();let m=u.defineHook()},31159:function(e,n,t){"use strict";t.d(n,{Vq:function(){return o}});var s=t(3546),l=t(21454),a=t(27257),r=t(3765),i=t(17451);function o(){let{data:e,isLoading:n}=(0,l.ZP)("/v1beta/models",e=>(0,r.Z)(e,{errorHandler:()=>{throw Error("Fetch supported model failed.")}}),{shouldRetryOnError:!1}),t=(0,a.oR)(i.aK,e=>e.selectedModel);return(0,s.useEffect)(()=>{if(!n){let n=function(e,n){if(!(null==n?void 0:n.length))return;let t=!!e&&n.includes(e);return t?e:n[0]}(t,null==e?void 0:e.chat);(0,i.Eg)(n)}},[n]),{isFetchingModels:n,selectedModel:t,models:null==e?void 0:e.chat}}},64566:function(e,n,t){"use strict";t.d(n,{x:function(){return u}});var s=t(3546),l=t(43240),a=t(11634),r=t(16784);let i=(0,l.BX)("\n  subscription CreateThreadAndRun($input: CreateThreadAndRunInput!) {\n    createThreadAndRun(input: $input) {\n      __typename\n      ... on ThreadCreated {\n        id\n      }\n      ... on ThreadUserMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageReadingCode {\n        snippet\n        fileList\n      }\n      ... on ThreadAssistantMessageReadingDoc {\n        sourceIds\n      }\n      ... on ThreadRelevantQuestions {\n        questions\n      }\n      ... on ThreadAssistantMessageAttachmentsCodeFileList {\n        codeFileList: fileList\n        truncated\n      }\n      ... on ThreadAssistantMessageAttachmentsCode {\n        hits {\n          code {\n            gitUrl\n            commit\n            filepath\n            language\n            content\n            startLine\n          }\n          scores {\n            rrf\n            bm25\n            embedding\n          }\n        }\n      }\n      ... on ThreadAssistantMessageAttachmentsDoc {\n        hits {\n          doc {\n            __typename\n            ... on MessageAttachmentWebDoc {\n              title\n              link\n              content\n            }\n            ... on MessageAttachmentIssueDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              closed\n            }\n            ... on MessageAttachmentPullDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              merged\n            }\n            ... on MessageAttachmentCommitDoc {\n              sha\n              message\n              author {\n                id\n                email\n                name\n              }\n              authorAt\n            }\n            ... on MessageAttachmentPageDoc {\n              link\n              title\n              content\n            }\n            ... on MessageAttachmentIngestedDoc {\n              id\n              title\n              body\n              ingestedDocLink: link\n            }\n          }\n          score\n        }\n      }\n      ... on ThreadAssistantMessageContentDelta {\n        delta\n      }\n      ... on ThreadAssistantMessageCompleted {\n        debugData {\n          chatCompletionMessages {\n            role\n            content\n          }\n        }\n      }\n    }\n  }\n"),o=(0,l.BX)("\n  subscription CreateThreadRun($input: CreateThreadRunInput!) {\n    createThreadRun(input: $input) {\n      __typename\n      ... on ThreadCreated {\n        id\n      }\n      ... on ThreadUserMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageCreated {\n        id\n      }\n      ... on ThreadAssistantMessageReadingCode {\n        snippet\n        fileList\n      }\n      ... on ThreadAssistantMessageReadingDoc {\n        sourceIds\n      }\n      ... on ThreadRelevantQuestions {\n        questions\n      }\n      ... on ThreadAssistantMessageAttachmentsCodeFileList {\n        codeFileList: fileList\n        truncated\n      }\n      ... on ThreadAssistantMessageAttachmentsCode {\n        hits {\n          code {\n            gitUrl\n            commit\n            filepath\n            language\n            content\n            startLine\n          }\n          scores {\n            rrf\n            bm25\n            embedding\n          }\n        }\n      }\n      ... on ThreadAssistantMessageAttachmentsDoc {\n        hits {\n          doc {\n            __typename\n            ... on MessageAttachmentWebDoc {\n              title\n              link\n              content\n            }\n            ... on MessageAttachmentIssueDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              closed\n            }\n            ... on MessageAttachmentPullDoc {\n              title\n              link\n              author {\n                id\n                email\n                name\n              }\n              body\n              merged\n            }\n            ... on MessageAttachmentCommitDoc {\n              sha\n              message\n              author {\n                id\n                email\n                name\n              }\n              authorAt\n            }\n            ... on MessageAttachmentPageDoc {\n              link\n              title\n              content\n            }\n            ... on MessageAttachmentIngestedDoc {\n              id\n              title\n              body\n              ingestedDocLink: link\n            }\n          }\n          score\n        }\n      }\n      ... on ThreadAssistantMessageContentDelta {\n        delta\n      }\n      ... on ThreadAssistantMessageCompleted {\n        debugData {\n          chatCompletionMessages {\n            role\n            content\n          }\n        }\n      }\n    }\n  }\n"),d=(0,l.BX)("\n  mutation DeleteThreadMessagePair(\n    $threadId: ID!\n    $userMessageId: ID!\n    $assistantMessageId: ID!\n  ) {\n    deleteThreadMessagePair(\n      threadId: $threadId\n      userMessageId: $userMessageId\n      assistantMessageId: $assistantMessageId\n    )\n  }\n"),c=()=>({content:"",completed:!1,isReadingCode:!1,isReadingFileList:!1,isReadingDocs:!1});function u(e){let{threadId:n,onAssistantMessageCompleted:t}=e,[l,u]=s.useState(n),m=s.useRef(),[h,x]=s.useState(!1),[f,v]=s.useState(c()),[p,g]=s.useState(),j=(e,n)=>{let t={...e};switch(n.__typename){case"ThreadCreated":t.threadId=n.id;break;case"ThreadUserMessageCreated":t.userMessageId=n.id;break;case"ThreadAssistantMessageCreated":t.assistantMessageId=n.id;break;case"ThreadRelevantQuestions":t.relevantQuestions=n.questions;break;case"ThreadAssistantMessageReadingCode":t.isReadingCode=!0,t.isReadingFileList=!0,t.readingCode={fileList:n.fileList,snippet:n.snippet};break;case"ThreadAssistantMessageReadingDoc":n.sourceIds.length&&(t.isReadingDocs=!0),t.readingDoc=n;break;case"ThreadAssistantMessageAttachmentsCodeFileList":t.isReadingFileList=!1,t.attachmentsFileList=n;break;case"ThreadAssistantMessageAttachmentsCode":t.isReadingCode=!1,t.attachmentsCode=n.hits;break;case"ThreadAssistantMessageAttachmentsDoc":t.isReadingDocs=!1,t.attachmentsDoc=n.hits;break;case"ThreadAssistantMessageContentDelta":t.isReadingCode=!1,t.isReadingFileList=!1,t.isReadingDocs=!1,t.content+=n.delta;break;case"ThreadAssistantMessageCompleted":t.debugData=n.debugData,t.completed=!0}return t},y=(0,r.d)(e=>{var n;null===(n=m.current)||void 0===n||n.call(m),m.current=void 0,x(!1),v(e=>({...e,isReadingCode:!1,isReadingFileList:!1,isReadingDocs:!1,completed:!0})),!e&&l&&(null==t||t(f))});s.useEffect(()=>{n!==l&&u(n)},[n]);let N=(e,n)=>{let{unsubscribe:t}=a.Lp.subscription(i,{input:{thread:{userMessage:e},options:n}}).subscribe(e=>{var n;if(null==e?void 0:e.error){x(!1),g(e.error),t();return}let s=null===(n=e.data)||void 0===n?void 0:n.createThreadAndRun;s&&((null==s?void 0:s.__typename)==="ThreadAssistantMessageCompleted"&&y.current(),(null==s?void 0:s.__typename)==="ThreadCreated"&&s.id!==l&&u(s.id),v(e=>j(e,s)))});return t},b=(e,n)=>{if(!l)return;let{unsubscribe:t}=a.Lp.subscription(o,{input:{threadId:l,additionalUserMessage:e,options:n}}).subscribe(e=>{var n;if(null==e?void 0:e.error){x(!1),g(e.error),t();return}let s=null===(n=e.data)||void 0===n?void 0:n.createThreadRun;s&&("ThreadAssistantMessageCompleted"===s.__typename&&y.current(),v(e=>j(e,s)))});return t},w=(0,a.Db)(d),C=(e,n)=>{h||(x(!0),g(void 0),v(c()),l?m.current=b(e,n):m.current=N(e,n))},k=(e,n,t)=>w({threadId:e,userMessageId:n,assistantMessageId:t}).then(e=>{var n;if(!(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.deleteThreadMessagePair)){if(null==e?void 0:e.error)throw e.error;throw Error("Failed to fetch")}});return{isLoading:h,answer:f,error:p,sendUserMessage:C,stop:y.current,regenerate:e=>l?(x(!0),g(void 0),v(c()),k(e.threadId,e.userMessageId,e.assistantMessageId).then(()=>{C(e.userMessage,e.threadRunOptions)}).catch(e=>{let n=e instanceof Error?e:Error("Failed to fetch");g(n),x(!1)})):Promise.resolve(void 0),deleteThreadMessagePair:k}}},2596:function(){},67325:function(){}},function(e){e.O(0,[7565,8415,4648,6527,4691,55,436,340,9906,1283,3087,2429,8511,1454,4421,7070,1002,6805,4546,9275,5605,3721,7003,6968,6635,5723,2928,9860,2285,6092,3492,1565,410,6978,4526,1731,3375,5289,1744],function(){return e(e.s=36865)}),_N_E=e.O()}]);